<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Chapter 9 N Parameters | We R Who We R: Preceptor’s Primer for Bayesian Data Science" />
<meta property="og:type" content="book" />



<meta name="github-repo" content="davidkane9/PPBDS" />

<meta name="author" content="David Kane" />

<meta name="date" content="2020-08-02" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>

<meta name="description" content="Chapter 9 N Parameters | We R Who We R: Preceptor’s Primer for Bayesian Data Science">

<title>Chapter 9 N Parameters | We R Who We R: Preceptor’s Primer for Bayesian Data Science</title>

<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/envisioned.css" rel="stylesheet" />
<link href="libs/msmb-css-0/msmb.css" rel="stylesheet" />
<script>
function toggle_visibility(id1, id2) {
var e = document.getElementById(id1);
var f = document.getElementById(id2);

e.style.display = ((e.style.display!='none') ? 'none' : 'block');

if(f.classList.contains('fa-plus-square')) {
    f.classList.add('fa-minus-square')
    f.classList.remove('fa-plus-square')
} else {
    f.classList.add('fa-plus-square')
    f.classList.remove('fa-minus-square')
}

}
</script>
<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/str_view-0.1.0/str_view.css" rel="stylesheet" />
<script src="libs/str_view-binding-1.4.0/str_view.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }

code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />

</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul class="navbar">
<li class="msmb"><p class="title">We R Who We R: Preceptor's Primer for Bayesian Data Science<p><p class="author">David Kane</p>
<li class="dropdown" style="float:right">
<a href="javascript:void(0)" class="dropbtn">&#x25BE; Chapters</a>
<div class="dropdown-content">
<a href="index.html">Cover</a>
<a href="preamble.html">Preamble</a>
<a href="shopping-week.html">Shopping Week</a>
<a href="visualization.html"><span class="toc-section-number">1</span> Visualization</a>
<a href="tidyverse.html"><span class="toc-section-number">2</span> Tidyverse</a>
<a href="rubin-causal-model.html"><span class="toc-section-number">3</span> Rubin Causal Model</a>
<a href="functions.html"><span class="toc-section-number">4</span> Functions</a>
<a href="probability.html"><span class="toc-section-number">5</span> Probability</a>
<a href="sampling.html"><span class="toc-section-number">6</span> Sampling</a>
<a href="rubin-causal-model.html"><span class="toc-section-number">7</span> One Parameter</a>
<a href="rubin-causal-model.html"><span class="toc-section-number">8</span> Two Parameters</a>
<a id="active-page" href="n-parameters.html"><span class="toc-section-number">9</span> N Parameters</a><ul class="toc-sections">
<li class="toc"><a href="#explorator-data-analysis-of-shaming"> Explorator Data Analysis of <code>shaming</code></a></li>
<li class="toc"><a href="#causal-effects-of-treament"> Causal Effects of <code>treament</code></a></li>
<li class="toc"><a href="#formatting-linear-models-in-r"> Formatting Linear Models in R</a></li>
<li class="toc"><a href="#adding-parameters"> Adding parameters</a></li>
<li class="toc"><a href="#interaction-terms"> Interaction terms</a></li>
<li class="toc"><a href="#heterogeneous-treatment-effect"> heterogeneous treatment effect</a></li>
<li class="toc"><a href="#sources-of-uncertainty"> 5 sources of uncertainty</a></li>
<li class="toc"><a href="#rubin-causal-model-2"> Rubin Causal Model</a></li>
<li class="toc"><a href="#cces-data"> cces data</a></li>
<li class="toc"><a href="#presidential-approval-overall-by-year-by-state-by-state-x-year-x-educ"> presidential approval; overall; by year; by state; by state x year x educ</a></li>
<li class="toc"><a href="#need-rstanarm"> need rstanarm</a></li>
<li class="toc"><a href="#rubin-causal-model-3"> Rubin Causal Model</a></li>
</ul>
<a href="appendices.html">Appendices</a>
<a href="tools.html">Tools</a>
<a href="shiny.html">Shiny</a>
<a href="maps.html">Maps</a>
<a href="animation.html">Animation</a>
<a href="references-1.html">References</a>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body><div id="n-parameters" class="section level1">
<h1>
<span class="header-section-number">Chapter 9</span> N Parameters</h1>
<!-- Outline: -->
<!-- The goal of this chapter is to replicate all of the things we have learned in chapter 8, except with models that allow for more than two parameters, which mostly involves have more than one right-hand side variable. We go through all of themes.Rmd two more times, once with a causal data set and once with a predictive one. So far, nothing new or different. But we are also going to highlight three major problems. We aren't going to solve those problems, but we are going to hint at them. The problems are: a) How do you decide which model is "better?" (Not an easy question! But the ability to predict new data is certainly a big part of the answer. b) How do you avoid overfitting, not least because it makes your predictions horrible? c) How do you establish causality if you don't have a randomized experiment? -->
<!-- 0) Start with a problem-->
<!-- 1) EDA of `shaming`. I think that hh_size is a good variable to check for interactions with, especially with Control. One approach: Create a new variable called `solo` which is TRUE if the `hh_size` is equal to 1 and FALSE otherwise. In other words, does the state of living alone tell us anything? We will interact this term with treatment in our model. It is cool that the p value for the interaction with Self is 0.06. A perfect example for the evils of testing!  -->
<!-- It may be worth mentioning that general_04 is always "yes", unlike all the other voting history variables which have values of "yes" and "no". Why is that? I *think* that this is caused by their sampling plan. They found all the people who voted in the 2004 general election. Then, the authors found their history. As we would expect, those people had sometimes voted in the past and sometime not. Then, the authors sent the mailing. The key dependent variable, primary_06, is coding 0/1, since that makes doing the statistics easier. -->
<!-- 2) `primary_06` as a function of `treatment` and `solo` and of their interaction. We will build up this model step-by-step, very similar to how we explored the effect of treatment in chapter 8. But we go deeper because  we are learning about interactions. Key thing is to go through all the themes.Rmd issues, at least until prediction. Note that this situation is different from Chapter 8 in that fitted values and predicted values are not the same thing! The fitted value, for a combination of values for treatment and solo, is something 0.30, meaning that 30% of the people in this bucket votes. But the predicted value must be 0 or 1. Either you voted or you didn't. This example is clearly causal and so you need a Rubin Table with 4 potential outcome columns. The key difference in this chapter is that we are using lots of right hand side variables, both continuous and discrete. Unlike last chapter, we go through the entire process in this section, all the way through dgm and predictive uncertainty. -->
<!-- 3) EDA of `nes`. Or maybe something else? Let's discuss. This can be fairly quick. Again, we won't use all the variables. Only discuss the ones we do use. One of the variables should be year. We want to show off Gelman's trick by plotting things by year. -->
<!-- 4) We are making a predictive model of what as a function of what other stuff? Want to use a continuous variable and some discrete variables as well. Interactions too.  -->
<!-- 5) Discussion of the difference between predictive and causal, and how we can interpret a model as causal even if it uses observational data. Apply to the nes example model. -->
<!-- 6) Pitfalls. Discuss model selection and overfitting. Again, we are not solving these problems here. They are hard problems. Instead, we are motivating chapter 10, which should perhaps be re-titled.  -->
<!-- Thoughts -->
<!-- * Should we do any Bayesian stuff here. Maybe not? We build the dgm() function by hand, maybe simplifying things a bit by not taking parameter uncertainty seriously. We mentioned that there must be an easier way, and then we do that in chapter 10.  -->
<!-- * Should we discuss overfitting here? I think that the answer is Yes, that we at least have to mention it and why it is a problem. Indeed, we have at least two pages making sure the concepts are clear. Again, we hint at what solutions might look like and promise a resolution in chapter 10. Maybe we mention pooling. Maybe we mention cross-validation. But we don't yet solve the problem.  -->
<!-- * The key part of this chapter is showing the themes.Rmd all the way through two problems, one causal and one not. In that way, it is very similar to chapter 8. Indeed, perhaps we should make these two chapters as alike as possible. -->
<p>Having created models with one parameter in Chapter @ref(#one-parameter) and two parameters in Chapter @ref(#two-parameters), you are now ready to make the jump to <span class="math inline">\(N\)</span> parameters.</p>
<p>Imagine you are running for Governor and want to do a better job of getting your voters to vote. You recently read about a large-scale experiment showing the effect of sending out a voting reminder that “shames” citizens who do not vote. You are considering sending out a “shaming” voting reminder yourself. What will happen if you do? Will more voters show up to the polls? Additionally, on the day of the election a female citizen is randomly selected. What is the probability she will vote?</p>
<p>In this chapter, we will consider models with multiple parameters and the complexities that arise from these additions. We will also learn how to make more accurate predictions using Bayesian methods that will provide us with answers to the questions posed above.</p>
<div id="explorator-data-analysis-of-shaming" class="section level2">
<h2>
<span class="header-section-number">9.1</span> Explorator Data Analysis of <code>shaming</code>
</h2>
<p>Begin by loading the packages which we need.</p>
<div class="sourceCode" id="cb909"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb909-1"><a href="n-parameters.html#cb909-1"></a><span class="kw">library</span>(PPBDS.data)</span>
<span id="cb909-2"><a href="n-parameters.html#cb909-2"></a><span class="kw">library</span>(skimr)</span>
<span id="cb909-3"><a href="n-parameters.html#cb909-3"></a><span class="kw">library</span>(broom.mixed)</span>
<span id="cb909-4"><a href="n-parameters.html#cb909-4"></a><span class="kw">library</span>(rstanarm)</span>
<span id="cb909-5"><a href="n-parameters.html#cb909-5"></a><span class="kw">library</span>(tidyverse)</span></code></pre></div>
<p>We will start off this chapter introducing a new data set from the <strong>PPBDS.data</strong> package: <code>shaming</code>. This data set corresponds to an experiment carried out by Gerber, Green, and Larimer (2008) titled “Social Pressure and Voter Turnout: Evidence from a Large-Scale Field Experiment”. This experiment used several hundred thousand registered voters and a series of mailings to determine the effect of social pressure on voter turnout.</p>
<div class="sourceCode" id="cb910"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb910-1"><a href="n-parameters.html#cb910-1"></a><span class="kw">glimpse</span>(shaming)</span></code></pre></div>
<pre><code>## Rows: 344,084
## Columns: 10
## $ sex         &lt;chr&gt; "Male", "Female", "Male", "Female", "Female", "Male", "Fe…
## $ birth_year  &lt;int&gt; 1941, 1947, 1951, 1950, 1982, 1981, 1959, 1956, 1968, 196…
## $ primary_02  &lt;chr&gt; "Yes", "Yes", "Yes", "Yes", "Yes", "No", "Yes", "Yes", "Y…
## $ general_02  &lt;chr&gt; "Yes", "Yes", "Yes", "Yes", "Yes", "No", "Yes", "Yes", "N…
## $ primary_04  &lt;chr&gt; "No", "No", "No", "No", "No", "No", "No", "No", "No", "No…
## $ general_04  &lt;chr&gt; "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "…
## $ treatment   &lt;fct&gt; Civic Duty, Civic Duty, Hawthorne, Hawthorne, Hawthorne, …
## $ primary_06  &lt;int&gt; 0, 0, 1, 1, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 1, 1, 0, 0, 1, …
## $ hh_size     &lt;int&gt; 2, 2, 3, 3, 3, 3, 3, 3, 2, 2, 1, 2, 2, 1, 2, 2, 2, 2, 1, …
## $ no_of_names &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…</code></pre>
<p>There are 344,084 observations, with each row corresponding to a unique respondent.</p>
<p>Four types of treatments were used in the experiment, with voters receiving one type of mailing. All of the mailing treatments carried the message, “DO YOUR CIVIC DUTY - VOTE!”.</p>
<p>The first treatment, Civic Duty, also read, “Remember your rights and responsibilities as a citizen. Remember to vote.” This message acted as a baseline for the other treatments, since it carried a message very similar to the one displayed on all the mailings.</p>
<p>In the second treatment, Hawthorne, households received a mailing which told the voters that they were being studied and their voting behavior would be examined through public records. This adds a small amount of social pressure to the households receiving this mailing.</p>
<p>In the third treatment, Self, the mailing includes the recent voting record of each member of the household, placing the word “Voted” next to their name if they did in fact vote in the 2004 election or a blank space next to the name if they did not. In this mailing, the households were also told, “we intend to mail an updated chart” with the voting record of the household members after the 2006 primary. By emphasizing the public nature of voting records, this type of mailing exerts more social pressure on voting than the Hawthorne treatment.</p>
<p>The fourth treatment, Neighbors, provides the household members’ voting records, as well as the voting records of those who live nearby. This mailing also told recipients, “we intend to mail an updated chart” of who voted in the 2006 election.</p>
<p>In addition to the treatments, the data set also consists of variables such as <code>primary_02</code>, <code>general_02</code>, <code>primary_04</code>, and <code>general_04</code> which tell us whether or not respondents voted in these primary and general elections. We are also given information about the respondents’ backgrounds such as <code>sex</code>, <code>birth_year</code>, and household size (<code>hh_size</code>).</p>
<p>For now, let’s focus on a subset of the data.</p>
<div class="sourceCode" id="cb912"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb912-1"><a href="n-parameters.html#cb912-1"></a>ch9 &lt;-<span class="st"> </span>shaming <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb912-2"><a href="n-parameters.html#cb912-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">solo =</span> <span class="kw">ifelse</span>(hh_size <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb912-3"><a href="n-parameters.html#cb912-3"></a><span class="st">  </span><span class="kw">select</span>(primary_<span class="dv">06</span>, treatment, solo, sex)</span></code></pre></div>
<p>We create the variable <code>solo</code>, which is TRUE for voters who live along and FALSE for those that do not. We are curious to see if the treatment effect, if any, is the same for voters who live alone as it is for those who do not.</p>
<div class="sourceCode" id="cb913"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb913-1"><a href="n-parameters.html#cb913-1"></a>ch9 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb913-2"><a href="n-parameters.html#cb913-2"></a><span class="st">  </span><span class="kw">skim</span>()</span></code></pre></div>
<p><!--
<caption>--><span class="marginnote shownote"><span id="tab:unnamed-chunk-641">TABLE 9.1: </span>Data summary</span><!--</caption>--></p>
<table><tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">Piped data</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">344084</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">4</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">character</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="left">factor</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">logical</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody></table>
<p><strong>Variable type: character</strong></p>
<table>
<thead><tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">min</th>
<th align="right">max</th>
<th align="right">empty</th>
<th align="right">n_unique</th>
<th align="right">whitespace</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">sex</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr></tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table>
<thead><tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="left">ordered</th>
<th align="right">n_unique</th>
<th align="left">top_counts</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">treatment</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">5</td>
<td align="left">Con: 191243, Civ: 38218, Sel: 38218, Haw: 38204</td>
</tr></tbody>
</table>
<p><strong>Variable type: logical</strong></p>
<table>
<thead><tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="left">count</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">solo</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.14</td>
<td align="left">FAL: 296250, TRU: 47834</td>
</tr></tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead><tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">primary_06</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.32</td>
<td align="right">0.46</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">▇▁▁▁▃</td>
</tr></tbody>
</table>
<!-- DK: Add discussion of what you see here. No need to drop missing values since there aren't any. I think this next discussion can be dropped. --><p>While <code>glimpse()</code> gives us a good look at the possible values for the variables, it is difficult to read it in terms of individual observations. Recall that the <em>observational unit</em> is what is being measured. With the <code>shaming</code> data set, the observational unit would be the voter respondent. To get a better sense of some respondents’ information, let’s use <code>sample_n()</code> to gather a random sample of <em>n</em> observations from the data set.</p>
<div class="sourceCode" id="cb914"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb914-1"><a href="n-parameters.html#cb914-1"></a>shaming <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb914-2"><a href="n-parameters.html#cb914-2"></a><span class="st">  </span><span class="kw">sample_n</span>(<span class="dv">10</span>)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 10
##    sex   birth_year primary_02 general_02 primary_04 general_04 treatment
##    &lt;chr&gt;      &lt;int&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;      &lt;fct&gt;    
##  1 Male        1979 No         No         No         Yes        Civic Du…
##  2 Fema…       1937 Yes        Yes        No         Yes        Self     
##  3 Fema…       1964 Yes        Yes        No         Yes        Neighbors
##  4 Male        1948 Yes        Yes        No         Yes        Hawthorne
##  5 Male        1955 No         Yes        Yes        Yes        Control  
##  6 Male        1966 Yes        Yes        No         Yes        Control  
##  7 Fema…       1962 Yes        Yes        No         Yes        Control  
##  8 Male        1955 No         No         No         Yes        Control  
##  9 Fema…       1972 No         Yes        Yes        Yes        Control  
## 10 Male        1983 Yes        Yes        Yes        Yes        Control  
## # … with 3 more variables: primary_06 &lt;int&gt;, hh_size &lt;int&gt;, no_of_names &lt;int&gt;</code></pre>
<p>Now we have a table with 5 random observations and the respondents’ information in a regular table output. By taking a few random samples, we may start to see some patterns within the data. Do you notice anything in particular about the variable <code>treatment</code>?</p>
<!-- HV: Is it okay to pose these questions here? -->
<!-- HV: The no_of_names variable is supposed to give an integer with the number of names listed *IF* the respondent was in the "Neighbors" group but for all other treatments it is listed as 21. Should I just mutate this or have it dealt with in the data set as a whole? -->
<p>To get a more in-depth summary of the variables and their components, we can run <code>summary()</code> on the data set.</p>
<div class="sourceCode" id="cb916"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb916-1"><a href="n-parameters.html#cb916-1"></a><span class="kw">summary</span>(shaming)</span></code></pre></div>
<pre><code>##      sex              birth_year    primary_02         general_02       
##  Length:344084      Min.   :1900   Length:344084      Length:344084     
##  Class :character   1st Qu.:1947   Class :character   Class :character  
##  Mode  :character   Median :1956   Mode  :character   Mode  :character  
##                     Mean   :1956                                        
##                     3rd Qu.:1965                                        
##                     Max.   :1986                                        
##                                                                         
##   primary_04         general_04             treatment        primary_06  
##  Length:344084      Length:344084      Civic Duty: 38218   Min.   :0.00  
##  Class :character   Class :character   Hawthorne : 38204   1st Qu.:0.00  
##  Mode  :character   Mode  :character   Control   :191243   Median :0.00  
##                                        Self      : 38218   Mean   :0.32  
##                                        Neighbors : 38201   3rd Qu.:1.00  
##                                                            Max.   :1.00  
##                                                                          
##     hh_size     no_of_names    
##  Min.   :1.0   Min.   :10      
##  1st Qu.:2.0   1st Qu.:21      
##  Median :2.0   Median :21      
##  Mean   :2.2   Mean   :21      
##  3rd Qu.:2.0   3rd Qu.:21      
##  Max.   :8.0   Max.   :21      
##                NA's   :305883</code></pre>
<p>For numerical variables, the <code>summary()</code> output provides us with the minimum, maximum, mean, and quartiles. For variables such as <code>treatment</code>, we are given a list of the various treatments along with counts of how many observations are within each group. In this case, the character variables do not provide us with any information other than the number of observations for each.</p>
<p>One other helpful summarizing technique we can use is <code>skim()</code>. To make the information it contains simpler, we will only be looking at three variables: <code>primary_06</code>, <code>treatment</code>, and <code>sex</code>.</p>
<div class="sourceCode" id="cb918"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb918-1"><a href="n-parameters.html#cb918-1"></a>shaming <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb918-2"><a href="n-parameters.html#cb918-2"></a><span class="st">  </span><span class="kw">select</span>(primary_<span class="dv">06</span>, treatment, sex) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb918-3"><a href="n-parameters.html#cb918-3"></a><span class="st">  </span><span class="kw">skim</span>()</span></code></pre></div>
<p><!--
<caption>--><span class="marginnote shownote"><span id="tab:unnamed-chunk-644">TABLE 9.2: </span>Data summary</span><!--</caption>--></p>
<table><tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">Piped data</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">344084</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">3</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">character</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="left">factor</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">numeric</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody></table>
<p><strong>Variable type: character</strong></p>
<table>
<thead><tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">min</th>
<th align="right">max</th>
<th align="right">empty</th>
<th align="right">n_unique</th>
<th align="right">whitespace</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">sex</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr></tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table>
<thead><tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="left">ordered</th>
<th align="right">n_unique</th>
<th align="left">top_counts</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">treatment</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">5</td>
<td align="left">Con: 191243, Civ: 38218, Sel: 38218, Haw: 38204</td>
</tr></tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead><tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">primary_06</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.32</td>
<td align="right">0.46</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">▇▁▁▁▃</td>
</tr></tbody>
</table>
<p>By running the <code>skim()</code> command, we get a summary of the data set as a whole, as well as the types of variables and individual variable summaries. At the top we see the number of columns and rows within the selected data set. Below this we are given a list with the different types of variables, or columns, and how often they appear within the data we are skimming. Following this, the variables are then separated by their column type, and we are given individual summaries based on the type.</p>
<p>There are a few things to note while exploring this data set. You may – or may not – have noticed that the only response to the <code>general_04</code> variable is “Yes”. In their published article, the authors note that “Only registered voters who voted in November 2004 were selected for our sample” (Gerber, Green, Larimer, 2008). After this, the authors found their history then sent out the mailings.</p>
<p>It is also important to identify the dependent variable and its meaning. In this shaming experiment, the dependent variable is <code>primary_06</code>, which is a variable coded either 0 or 1 for whether or not the respondent voted in the 2006 primary election. This is the dependent variable because the authors are trying to measure the effect that the treatments have on the proportion of people who vote.</p>
<!-- HV: Should I include discussion of the left-hand variable (treatment?) here? Or wait until we move into the regressions? -->
<!-- It may be worth mentioning that general_04 is always "yes", unlike all the other voting history variables which have values of "yes" and "no". Why is that? I *think* that this is caused by their sampling plan. They found all the people who voted in the 2004 general election. Then, the authors found their history. As we would expect, those people had sometimes voted in the past and sometime not. Then, the authors sent the mailing. The key dependent variable, primary_06, is coding 0/1, since that makes doing the statistics easier. -->
<!-- 2) `primary_06` as a function of `treatment` and `solo` and of their interaction. We will build up this model step-by-step, very similar to how we explored the effect of treatment in chapter 8. But we go deeper because  we are learning about interactions. Key thing is to go through all the themes.Rmd issues, at least until prediction. Note that this situation is different from Chapter 8 in that fitted values and predicted values are not the same thing! The fitted value, for a combination of values for treatment and solo, is something 0.30, meaning that 30% of the people in this bucket votes. But the predicted value must be 0 or 1. Either you voted or you didn't. This example is clearly causal and so you need a Rubin Table with 4 potential outcome columns. The key difference in this chapter is that we are using lots of right hand side variables, both continuous and discrete. -->
<!-- 3) EDA of `nes`. This can be fairly quick. Again, we won't use all the variables. Only discuss the ones we do use. One of the variables should be year. We want to show off Gelman's trick by plotting things by year. -->
<!-- 4) We are making a predictive model of what as a function of what other stuff? Want to use a continuous variable and some discrete variables as well. Interactions to.  -->
<!-- 5) I don't think we bother with a scenario which requires a bootstrap. Or should we?  -->
<!-- 6) Prediction. How do we use our model to make predictions? Bring the discussion back to the way that we opened the chapter with a problem. -->
<p>Having created models with one parameter in Chapter @ref(#one-parameter) and two parameters in Chapter @ref(#two-parameters), you are now ready to make the jump to <span class="math inline">\(N\)</span> parameters. The more parameters we include in our models, the more flexible they can become. But we must be careful of <em>overfitting</em>, of making models which are inaccurate because they don’t use enough data to accurately estimate those parameters. The tension between overfitting and underfitting is central to the practice of data science.
<!-- HV: Where does this belong? --></p>
</div>
<div id="causal-effects-of-treament" class="section level2">
<h2>
<span class="header-section-number">9.2</span> Causal Effects of <code>treament</code>
</h2>
<div class="sourceCode" id="cb919"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb919-1"><a href="n-parameters.html#cb919-1"></a>obj<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="kw">stan_glm</span>(<span class="dt">data =</span> shaming, </span>
<span id="cb919-2"><a href="n-parameters.html#cb919-2"></a>                <span class="dt">formula =</span> primary_<span class="dv">06</span> <span class="op">~</span><span class="st"> </span>treatment <span class="op">-</span><span class="st"> </span><span class="dv">1</span>, </span>
<span id="cb919-3"><a href="n-parameters.html#cb919-3"></a>                <span class="dt">family =</span> <span class="kw">gaussian</span>(), </span>
<span id="cb919-4"><a href="n-parameters.html#cb919-4"></a>                <span class="dt">refresh =</span> <span class="dv">0</span>)</span></code></pre></div>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#mfgubmzphp .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#mfgubmzphp .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mfgubmzphp .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#mfgubmzphp .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#mfgubmzphp .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mfgubmzphp .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mfgubmzphp .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#mfgubmzphp .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#mfgubmzphp .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#mfgubmzphp .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#mfgubmzphp .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#mfgubmzphp .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#mfgubmzphp .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#mfgubmzphp .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#mfgubmzphp .gt_from_md > :first-child {
  margin-top: 0;
}

#mfgubmzphp .gt_from_md > :last-child {
  margin-bottom: 0;
}

#mfgubmzphp .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#mfgubmzphp .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#mfgubmzphp .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mfgubmzphp .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#mfgubmzphp .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mfgubmzphp .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#mfgubmzphp .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mfgubmzphp .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mfgubmzphp .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#mfgubmzphp .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mfgubmzphp .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#mfgubmzphp .gt_left {
  text-align: left;
}

#mfgubmzphp .gt_center {
  text-align: center;
}

#mfgubmzphp .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#mfgubmzphp .gt_font_normal {
  font-weight: normal;
}

#mfgubmzphp .gt_font_bold {
  font-weight: bold;
}

#mfgubmzphp .gt_font_italic {
  font-style: italic;
}

#mfgubmzphp .gt_super {
  font-size: 65%;
}

#mfgubmzphp .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="mfgubmzphp" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>Beta</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">
<strong>95% CI</strong><sup class="gt_footnote_marks">1</sup>
</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_left">treatment</td>
      <td class="gt_row gt_center"></td>
      <td class="gt_row gt_center"></td>
    </tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Civic Duty</td>
      <td class="gt_row gt_center">0.31</td>
      <td class="gt_row gt_center">0.31, 0.32</td>
    </tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Hawthorne</td>
      <td class="gt_row gt_center">0.32</td>
      <td class="gt_row gt_center">0.32, 0.33</td>
    </tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Control</td>
      <td class="gt_row gt_center">0.30</td>
      <td class="gt_row gt_center">0.29, 0.30</td>
    </tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Self</td>
      <td class="gt_row gt_center">0.35</td>
      <td class="gt_row gt_center">0.34, 0.35</td>
    </tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Neighbors</td>
      <td class="gt_row gt_center">0.38</td>
      <td class="gt_row gt_center">0.37, 0.38</td>
    </tr>
</tbody>
<tfoot><tr class="gt_footnotes">
<td colspan="3">
        <p class="gt_footnote">
          <sup class="gt_footnote_marks"><em>1</em>
          </sup>
           
          CI = Confidence Interval
          <br></p>
      </td>
    </tr></tfoot>
</table></div>
<!-- Talk about what these results mean.  Then, create the same model but with a different structure. -->
<div class="sourceCode" id="cb920"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb920-1"><a href="n-parameters.html#cb920-1"></a>obj<span class="fl">.2</span> &lt;-<span class="st"> </span><span class="kw">stan_glm</span>(<span class="dt">data =</span> shaming, </span>
<span id="cb920-2"><a href="n-parameters.html#cb920-2"></a>                <span class="dt">formula =</span> primary_<span class="dv">06</span> <span class="op">~</span><span class="st"> </span>treatment, </span>
<span id="cb920-3"><a href="n-parameters.html#cb920-3"></a>                <span class="dt">family =</span> <span class="kw">gaussian</span>(), </span>
<span id="cb920-4"><a href="n-parameters.html#cb920-4"></a>                <span class="dt">refresh =</span> <span class="dv">0</span>)</span></code></pre></div>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#wielckxvee .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#wielckxvee .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wielckxvee .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#wielckxvee .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#wielckxvee .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wielckxvee .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wielckxvee .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#wielckxvee .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#wielckxvee .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#wielckxvee .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#wielckxvee .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#wielckxvee .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#wielckxvee .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#wielckxvee .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#wielckxvee .gt_from_md > :first-child {
  margin-top: 0;
}

#wielckxvee .gt_from_md > :last-child {
  margin-bottom: 0;
}

#wielckxvee .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#wielckxvee .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#wielckxvee .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wielckxvee .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#wielckxvee .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wielckxvee .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#wielckxvee .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wielckxvee .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wielckxvee .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#wielckxvee .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wielckxvee .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#wielckxvee .gt_left {
  text-align: left;
}

#wielckxvee .gt_center {
  text-align: center;
}

#wielckxvee .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#wielckxvee .gt_font_normal {
  font-weight: normal;
}

#wielckxvee .gt_font_bold {
  font-weight: bold;
}

#wielckxvee .gt_font_italic {
  font-style: italic;
}

#wielckxvee .gt_super {
  font-size: 65%;
}

#wielckxvee .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="wielckxvee" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>Beta</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">
<strong>95% CI</strong><sup class="gt_footnote_marks">1</sup>
</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_left">treatment</td>
      <td class="gt_row gt_center"></td>
      <td class="gt_row gt_center"></td>
    </tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Civic Duty</td>
      <td class="gt_row gt_center">—</td>
      <td class="gt_row gt_center">—</td>
    </tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Hawthorne</td>
      <td class="gt_row gt_center">0.01</td>
      <td class="gt_row gt_center">0.00, 0.01</td>
    </tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Control</td>
      <td class="gt_row gt_center">-0.02</td>
      <td class="gt_row gt_center">-0.02, -0.01</td>
    </tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Self</td>
      <td class="gt_row gt_center">0.03</td>
      <td class="gt_row gt_center">0.02, 0.04</td>
    </tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Neighbors</td>
      <td class="gt_row gt_center">0.06</td>
      <td class="gt_row gt_center">0.06, 0.07</td>
    </tr>
</tbody>
<tfoot><tr class="gt_footnotes">
<td colspan="3">
        <p class="gt_footnote">
          <sup class="gt_footnote_marks"><em>1</em>
          </sup>
           
          CI = Confidence Interval
          <br></p>
      </td>
    </tr></tfoot>
</table></div>
<!-- Explain how these two models are the same, except in how they define the parameters. Show us the math like Gelman does. Write down the math. For simple. -->
<!-- Once we talk about these things --- and, again, this is exactly what we have talked about in chapter 8 --- we can do a bit more. Like discuss how we are using 99%, because there is nothing magical aboyt 95%, other than convention. I also think it would be fun to show a nice graphic of this, highlighting how the estimates for Civic and Hawthorne overlap.  -->
<div id="interactions" class="section level3">
<h3>
<span class="header-section-number">9.2.1</span> Interactions</h3>
<!-- This is new. With only two parameters, we can't really look at interaction effects. Need to discuss interaction effects in general. Also, note that heterogenous treatment effects are the same thing as interaction effects that involve a treatment effect as one of the variables.  -->
<!-- Feel free to build up this code, and other examples, more slowly than I am doing it here. -->
<div class="sourceCode" id="cb921"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb921-1"><a href="n-parameters.html#cb921-1"></a>obj<span class="fl">.3</span> &lt;-<span class="st"> </span><span class="kw">stan_glm</span>(<span class="dt">data =</span> shaming, </span>
<span id="cb921-2"><a href="n-parameters.html#cb921-2"></a>                <span class="dt">formula =</span> primary_<span class="dv">06</span> <span class="op">~</span><span class="st"> </span>sex <span class="op">+</span><span class="st"> </span>treatment <span class="op">+</span><span class="st"> </span>sex<span class="op">:</span>treatment, </span>
<span id="cb921-3"><a href="n-parameters.html#cb921-3"></a>                <span class="dt">family =</span> <span class="kw">gaussian</span>(), </span>
<span id="cb921-4"><a href="n-parameters.html#cb921-4"></a>                <span class="dt">refresh =</span> <span class="dv">0</span>)</span></code></pre></div>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#vddqmqcdhe .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#vddqmqcdhe .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vddqmqcdhe .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#vddqmqcdhe .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#vddqmqcdhe .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vddqmqcdhe .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vddqmqcdhe .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#vddqmqcdhe .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#vddqmqcdhe .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#vddqmqcdhe .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#vddqmqcdhe .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#vddqmqcdhe .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#vddqmqcdhe .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#vddqmqcdhe .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#vddqmqcdhe .gt_from_md > :first-child {
  margin-top: 0;
}

#vddqmqcdhe .gt_from_md > :last-child {
  margin-bottom: 0;
}

#vddqmqcdhe .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#vddqmqcdhe .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#vddqmqcdhe .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vddqmqcdhe .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#vddqmqcdhe .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vddqmqcdhe .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#vddqmqcdhe .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vddqmqcdhe .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vddqmqcdhe .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#vddqmqcdhe .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vddqmqcdhe .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#vddqmqcdhe .gt_left {
  text-align: left;
}

#vddqmqcdhe .gt_center {
  text-align: center;
}

#vddqmqcdhe .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#vddqmqcdhe .gt_font_normal {
  font-weight: normal;
}

#vddqmqcdhe .gt_font_bold {
  font-weight: bold;
}

#vddqmqcdhe .gt_font_italic {
  font-style: italic;
}

#vddqmqcdhe .gt_super {
  font-size: 65%;
}

#vddqmqcdhe .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="vddqmqcdhe" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>Beta</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">
<strong>95% CI</strong><sup class="gt_footnote_marks">1</sup>
</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_left">sex</td>
      <td class="gt_row gt_center"></td>
      <td class="gt_row gt_center"></td>
    </tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Female</td>
      <td class="gt_row gt_center">—</td>
      <td class="gt_row gt_center">—</td>
    </tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Male</td>
      <td class="gt_row gt_center">0.02</td>
      <td class="gt_row gt_center">0.01, 0.03</td>
    </tr>
<tr>
<td class="gt_row gt_left">treatment</td>
      <td class="gt_row gt_center"></td>
      <td class="gt_row gt_center"></td>
    </tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Civic Duty</td>
      <td class="gt_row gt_center">—</td>
      <td class="gt_row gt_center">—</td>
    </tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Hawthorne</td>
      <td class="gt_row gt_center">0.01</td>
      <td class="gt_row gt_center">0.00, 0.02</td>
    </tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Control</td>
      <td class="gt_row gt_center">-0.02</td>
      <td class="gt_row gt_center">-0.02, -0.01</td>
    </tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Self</td>
      <td class="gt_row gt_center">0.04</td>
      <td class="gt_row gt_center">0.03, 0.04</td>
    </tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Neighbors</td>
      <td class="gt_row gt_center">0.06</td>
      <td class="gt_row gt_center">0.06, 0.07</td>
    </tr>
<tr>
<td class="gt_row gt_left">sex * treatment</td>
      <td class="gt_row gt_center"></td>
      <td class="gt_row gt_center"></td>
    </tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Male * Hawthorne</td>
      <td class="gt_row gt_center">-0.01</td>
      <td class="gt_row gt_center">-0.02, 0.01</td>
    </tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Male * Control</td>
      <td class="gt_row gt_center">0.00</td>
      <td class="gt_row gt_center">-0.01, 0.01</td>
    </tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Male * Self</td>
      <td class="gt_row gt_center">-0.01</td>
      <td class="gt_row gt_center">-0.02, 0.00</td>
    </tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Male * Neighbors</td>
      <td class="gt_row gt_center">0.00</td>
      <td class="gt_row gt_center">-0.02, 0.01</td>
    </tr>
</tbody>
<tfoot><tr class="gt_footnotes">
<td colspan="3">
        <p class="gt_footnote">
          <sup class="gt_footnote_marks"><em>1</em>
          </sup>
           
          CI = Confidence Interval
          <br></p>
      </td>
    </tr></tfoot>
</table></div>
<!-- Takes a while to explain what all this means. -->
<!-- Two key issues: 1) Interpreting lots of parameters in a model. interactions, heterogenous treatment effects. shaming using lm(). 




2) Estimate support for the president among small demographic. How do female, Hispanics in Alabama feel about Obama? You don't want to just use the overall mean, which would underfitting. You don't want to use the mean for just that small group, which would be overfitting.  Using nes data, for 2012, approval for Obama and stan_glm().  -->
<!-- 
intercept

Interactions --- use: income ~ party*something

heterogeneous treatment effects --- use:  att_start ~ treatment*something 
just a fancy way of saying interaction effects, but with a variable which us causal


What problems do we face? All the things that make modeling difficult. Why is this so hard? -->
<!-- Centering. -->
<!-- Might naively just take the value for each bucket. But that overfits! Need to put down some structure, like ordering. -->
<!-- income category, party id, pooling, age, -->
<!-- overfitting/underfitting bias/variance -->
<!-- We must have left bootstrapping behind by now. No more bootstraps, at least for the purpose of calculating uncertainty. (We will use it later for the purpose of out-of-sample testing and avoiding overfitting.) Key lesson is that overfitting is easy. You can't just estimate a value for each cell. You need to smooth and borrow strength. Of course, the only way to do that is with a Bayesian approach. Right? We don't want to get into hacked likelihood approaches. -->
<!-- cces looks perfect for this project. There are 400,000 rows, so it seems like you ought to have plenty of data for anything you want, but once you realize there are 51 states and 10 years, things get sparse fast. We only have 15 observations, for example, for Wyoming in 2007. Once you start subsetting by race and education, you have no choice but to start borrowing strength.  -->
<!-- So, just what will we use? rstanarm(). If so (and if we have not introduced it earlier), we can begin with seeing how it is similar to lm() and then expand. This means that, in one paramter chapter, we should be doing lm( ~ 1). In two parameter, lm( ~ treatment) --- if treatment is zero one --- or, perhaps better, lm( ~ -1 + treatment) if treatment is a factor/character with two levels. We might also have introduced  -->
</div>
</div>
<div id="formatting-linear-models-in-r" class="section level2">
<h2>
<span class="header-section-number">9.3</span> Formatting Linear Models in R</h2>
<p>In the previous chapter, linear models were created using the general format of <code>dependent variable ~ -1 + independent variable</code>. After running the regression on a model of this type, the resulting table would show coefficients for both parameters of the independent variable, for example Democrat and Republican. This method works fine when there are only one or two parameters in consideration, however now we will be moving onto <em>n</em> parameters and we will have to change the formula we use; specifically, we will be removing the -1 from the lm formula.</p>
<p>In order to remove the -1, we first have to understand the function of it in the linear regression formulas that you have seen previously. Using the Enos (2014) <code>trains</code> data, when we use -1 in our formula and regress party on income, the table output lists both parameters and estimates their mean income values.</p>
<div class="sourceCode" id="cb922"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb922-1"><a href="n-parameters.html#cb922-1"></a><span class="kw">lm</span>(<span class="dt">data =</span> trains, income <span class="op">~</span><span class="st"> </span><span class="dv">-1</span> <span class="op">+</span><span class="st"> </span>party) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tidy</span>(<span class="dt">conf.int =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 7
##   term            estimate std.error statistic  p.value conf.low conf.high
##   &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1 partyDemocrat    136755.     7545.     18.1  3.12e-35  121808.   151702.
## 2 partyRepublican  167368.    16959.      9.87 6.08e-17  133770.   200967.</code></pre>
<!-- HV: Is there a way to make this output neater in the knit document? More of a typical regression table? -->
<!-- HV: Should I start off introducing rstanarm and use stan_glm for all models in this chapter? -->
<p>This table tells us that Democrats have an average income of $136,755.20, while Republicans have an average income of $167,368.40.</p>
<p>Once we remove the -1 from the formula, the the regression table replaces one of the parameter terms with “(Intercept)”. For example, if we use the same regression as above but remove the -1, the output table changes to this:</p>
<div class="sourceCode" id="cb924"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb924-1"><a href="n-parameters.html#cb924-1"></a><span class="kw">lm</span>(<span class="dt">data =</span> trains, income <span class="op">~</span><span class="st"> </span>party) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tidy</span>(<span class="dt">conf.int =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 7
##   term            estimate std.error statistic  p.value conf.low conf.high
##   &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1 (Intercept)      136755.     7545.     18.1  3.12e-35  121808.   151702.
## 2 partyRepublican   30613.    18561.      1.65 1.02e- 1   -6160.    67386.</code></pre>
<p>Although the coefficients in this regression table are different than the ones above, the interpretation stays the same. The intercept still represents the average income of democrats, the default parameter, however the partyRepulican coefficient is now the difference between the mean income of republicans and democrats. The value of the mean republican income remains the same, however, but it is now calculated by adding the partyRepublican coefficient to the intercept estimate.</p>
<div class="sourceCode" id="cb926"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb926-1"><a href="n-parameters.html#cb926-1"></a><span class="fl">136755.21</span> <span class="op">+</span><span class="st"> </span><span class="fl">30613.21</span></span></code></pre></div>
<pre><code>## [1] 167368</code></pre>
</div>
<div id="adding-parameters" class="section level2">
<h2>
<span class="header-section-number">9.4</span> Adding parameters</h2>
<p>We will now begin adding parameters to our regression models. The simplest way to do so is by adding another independent variable to the regression formula. For example, we can add gender to the same formula we used previously.</p>
<div class="sourceCode" id="cb928"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb928-1"><a href="n-parameters.html#cb928-1"></a><span class="kw">lm</span>(<span class="dt">data =</span> trains, income <span class="op">~</span><span class="st"> </span>party <span class="op">+</span><span class="st"> </span>gender) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tidy</span>(<span class="dt">conf.int =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 7
##   term            estimate std.error statistic  p.value conf.low conf.high
##   &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1 (Intercept)      121086.    10710.     11.3  3.10e-20   99867.   142306.
## 2 partyRepublican   31621.    18315.      1.73 8.70e- 2   -4668.    67910.
## 3 genderMale        27856.    13691.      2.03 4.43e- 2     728.    54983.</code></pre>
<div id="understanding-the-model" class="section level3">
<h3>
<span class="header-section-number">9.4.1</span> Understanding the Model</h3>
<p>Models with multiple predictors can become complicated to interpret, since the interpretation of a coefficient somewhat relies on the other variables of the model. The model we have just created summarizes the difference in average income of subjects based on both their political party affiliation and their gender. Using just these two predictors and their coefficients, we have three parameters to describe four types of people: democratic females, democratic males, republican females, and republican males.</p>
<p>We can start off by converting the resulting output into mathematical notation using the simple linear regression equation of $Y =<em>{1}x</em>{1} + <em>{2}x</em>{2} + + $. Using this notation, this model could be written as Income = 121086.46 + 31621.14<em>Republican + 27855.54</em>Male. Both of these predictors, party and gender, are binary and given the output coefficient terms, if a person is Republican it is coded as 1, whereas if they are a Democrat it is coded as 0. The same intuition applies to gender, with male coded as 1 and female coded as 0. Now, we must interpret this model.</p>
<p><em>Intercept</em>: If we think about the intercept in terms of the linear equation we formulated above, it is the value of Y when x is zero, or the income when Republican and Male are both coded zero. Therefore in this model, the intercept represents female democrats and tells us that the mean income for female democrats is $121,086.46.</p>
<p><em>Party coefficient</em>: Alone, this variable compares the incomes of people with different political affiliations. It tells us that Republicans have a mean income that is $31,621.14 more than Democrats. If we look at the model altogether and want the mean income for a female republican, we would add the partyRepublican coefficient to the intercept estimate by coding a 1 to the Republican variable. This gives us a mean income of $152,707.60 for female republicans, compared to the mean income of $121,086.46 for female democrats.</p>
<p><em>Gender coefficient</em>: The genderMale coefficient tells us the difference between the income of a female and a male. If we take out the partyRepublican term, the genderMale coefficient looks specifically at the difference in income of a female democrat versus a male democrat. By adding this coefficient to the intercept value, we find that male democrats have a mean income of $148,942, or $27,855.54 more than female democrats.</p>
<p><em>Using both coefficients</em>: In order to find the mean income of a male republican, we would have to code a 1 to both variables which would lead us to add both the partyRepublican coefficient <em>and</em> the genderMale coefficient to the intercept, since both parameters apply. From this we find the mean income of a republican male is $180,563.10.
<!-- Fix choppy writing in this whole section. Maybe change formatting. --></p>
<p>It is important to note, however, that adding predictors brings about a range of complexities, including which predictors to omit and which to include, interpretations of multiple coefficients, and the uncertainty associated with our models.</p>
</div>
</div>
<div id="interaction-terms" class="section level2">
<h2>
<span class="header-section-number">9.5</span> Interaction terms</h2>
<p>Another way to add parameters to a linear regression formula is by incorporating interaction terms.</p>
</div>
<div id="heterogeneous-treatment-effect" class="section level2">
<h2>
<span class="header-section-number">9.6</span> heterogeneous treatment effect</h2>
<p>fancy way of saying interactions but with a variable that you believe is causal</p>
</div>
<div id="sources-of-uncertainty" class="section level2">
<h2>
<span class="header-section-number">9.7</span> 5 sources of uncertainty</h2>
<p>style.Rmd</p>
<div id="parameter-uncertainty-4" class="section level4">
<h4>
<span class="header-section-number">9.7.0.1</span> 3. Parameter Uncertainty</h4>
<p>estimate of income coefficient
confidence interval gives the range of uncertainty
- when dealing with a new observation, it is not the confidence interval
- this is where you use posterior predict
- difference between uncertainty about parameyer mean estimate but confidence interval for the mean is not equal to the estimate for the new observation</p>
</div>
<div id="unmodeled-variation-3" class="section level4">
<h4>
<span class="header-section-number">9.7.0.2</span> 4. Unmodeled Variation</h4>
</div>
</div>
<div id="rubin-causal-model-2" class="section level2">
<h2>
<span class="header-section-number">9.8</span> Rubin Causal Model</h2>
<p>new female democrat shows up</p>
</div>
<div id="cces-data" class="section level2">
<h2>
<span class="header-section-number">9.9</span> cces data</h2>
<p>In this chapter we will be using the cces data, or Cooperative Congress Election Survey. The CCES is a 50,000+ person national stratified sample survey that consists of a pre- and post- election wave. In the pre-election wave, respondents complete two-thirds of the survey that asks about general political attitudes, various demographic factors, assessment of roll call voting choices, political information, and vote intentions. In the post-election wave, respondents complete the final third of the survey that consists mostly of items related to the election that just occurred.</p>
<p>Some of the key variables that are included in the data set are approval ratings of the elected officials, from the governor to the president, on a scale from “Strongly Disapprove” to “Strongly Approve”. To quantify this data, the new variables <code>approval_pres_num</code>, <code>approval_rep_num</code>, <code>approval_sen1_num</code>, <code>approval_sen2_num</code>, and <code>approval_gov_num</code> have all been created and quantify the approval scale by ordering the responses from a 1 to a 5. Those who answered with “Strongly Disapprove” are a 1 on the approval scale, while those who answered with “Strongly Approve” are a 5 on the numerical approval scale. Those who are neutral answered with “Neither Approve Nor Disapprove” and are quantified as a 3 on the scale. Respondents who answered with “Never Heard / Not Sure” have been removed in order to improve the accuracy of the approval ratings.</p>
<p>Other variables in the cces data include state, race, age, education level, gender, and ideology. The data taken spans from 2006 to 2018, although it should be noted that there are more observations in years with general elections.</p>
</div>
<div id="presidential-approval-overall-by-year-by-state-by-state-x-year-x-educ" class="section level2">
<h2>
<span class="header-section-number">9.10</span> presidential approval; overall; by year; by state; by state x year x educ</h2>
</div>
<div id="need-rstanarm" class="section level2">
<h2>
<span class="header-section-number">9.11</span> need rstanarm</h2>
</div>
<div id="rubin-causal-model-3" class="section level2">
<h2>
<span class="header-section-number">9.12</span> Rubin Causal Model</h2>
<!-- create numeric `rating` 1 to 4. Leave out Never heard. Might use percentage strongly approve. -->
<!-- discuss overall rating for entire date set. One parameter. Discuss. For each year. For each state. -->
<!-- basic lm -->
<!-- lm(data = cces, age ~ 1) %>% tidy(conf.int = TRUE) -->
<!-- lm(data = cces, age ~ -1 + state) %>% tidy(conf.int = TRUE) -->
<!-- lm(data = cces, age ~ -1 + as.factor(year)) %>% tidy(conf.int = TRUE) -->
<!-- obj <- lm(data = cces, age ~ -1 + state*as.factor(year)) %>% tidy(conf.int = TRUE) -->
<!-- Connecting parameters to real world concepts. What are we measuring? validity. -->
<!-- estimands -->

</div>
</div></body></html>

<p style="text-align: center;">
<a href="two-parameters.html"><button class="btn btn-default">Previous</button></a>
<a href="appendices.html"><button class="btn btn-default">Next</button></a>
</p>
<p class="build-date">Page built: 
2020-08-03
</p>
</div>
</div>



</body>
</html>
