<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Chapter 12 Discrete Response | Preceptor’s Primer for Bayesian Data Science" />
<meta property="og:type" content="book" />



<meta name="github-repo" content="davidkane9/PPBDS" />

<meta name="author" content="David Kane" />

<meta name="date" content="2020-07-19" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>

<meta name="description" content="Chapter 12 Discrete Response | Preceptor’s Primer for Bayesian Data Science">

<title>Chapter 12 Discrete Response | Preceptor’s Primer for Bayesian Data Science</title>

<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/envisioned.css" rel="stylesheet" />
<link href="libs/msmb-css-0/msmb.css" rel="stylesheet" />
<script>
function toggle_visibility(id1, id2) {
var e = document.getElementById(id1);
var f = document.getElementById(id2);

e.style.display = ((e.style.display!='none') ? 'none' : 'block');

if(f.classList.contains('fa-plus-square')) {
    f.classList.add('fa-minus-square')
    f.classList.remove('fa-plus-square')
} else {
    f.classList.add('fa-plus-square')
    f.classList.remove('fa-minus-square')
}

}
</script>
<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/str_view-0.1.0/str_view.css" rel="stylesheet" />
<script src="libs/str_view-binding-1.4.0/str_view.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }

code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />

</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul class="navbar">
<li class="msmb"><p class="title">Preceptor's Primer for Bayesian Data Science<p><p class="author">David Kane</p>
<li class="dropdown" style="float:right">
<a href="javascript:void(0)" class="dropbtn">&#x25BE; Chapters</a>
<div class="dropdown-content">
<a href="index.html">Cover</a>
<a href="preamble.html">Preamble</a>
<a href="shopping-week.html">Shopping Week</a>
<a href="visualization.html"><span class="toc-section-number">1</span> Visualization</a>
<a href="tidyverse.html"><span class="toc-section-number">2</span> Tidyverse</a>
<a href="rubin-causal-model.html"><span class="toc-section-number">3</span> Rubin Causal Model</a>
<a href="functions.html"><span class="toc-section-number">4</span> Functions</a>
<a href="probability.html"><span class="toc-section-number">5</span> Probability</a>
<a href="sampling.html"><span class="toc-section-number">6</span> Sampling</a>
<a href="one-parameter.html"><span class="toc-section-number">7</span> One Parameter</a>
<a href="two-parameters.html"><span class="toc-section-number">8</span> Two Parameters</a>
<a href="n-parameters.html"><span class="toc-section-number">9</span> N Parameters</a>
<a href="pitfalls.html"><span class="toc-section-number">10</span> Pitfalls</a>
<a href="continuous-response.html"><span class="toc-section-number">11</span> Continuous Response</a>
<a id="active-page" href="discrete-response.html"><span class="toc-section-number">12</span> Discrete Response</a><ul class="toc-sections">
<li class="toc"><a href="#logistic-regression"> Logistic regression</a></li>
<li class="toc"><a href="#classification-and-regression-trees-cart"> Classification and regression trees (CART)</a></li>
<li class="toc"><a href="#random-forests"> Random forests</a></li>
<li class="toc"><a href="#comparing-the-three-approaches"> Comparing the three approaches</a></li>
</ul>
<a href="appendices.html">Appendices</a>
<a href="tools.html">Tools</a>
<a href="shiny.html">Shiny</a>
<a href="maps.html">Maps</a>
<a href="animation.html">Animation</a>
<a href="references-1.html">References</a>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body><div id="discrete-response" class="section level1">
<h1>
<span class="header-section-number">Chapter 12</span> Discrete Response</h1>
<p>Many questions have binary answers. These questions can be answered by any pair of two answers (such as yes/no). Two examples of these questions include:
a. Are students with below average grades more likely to binge drink?
b. Is exposure to a particular chemical associated with a cancer diagnosis?</p>
<p><strong>Binary responses</strong> take on only two values: success (<span class="math inline">\(Y=1\)</span>) or failure (<span class="math inline">\(Y=0\)</span>), yes (<span class="math inline">\(Y=1\)</span>) or no (<span class="math inline">\(Y=0\)</span>), et cetera. Examples (a) and (b) above have binary responses (Does a student binge drink? Was a patient diagnosed with cancer?). Binary responses are one of the most common types of data that statisticians encounter. We are often interested in modeling the probability of success, <span class="math inline">\(p\)</span>, based on a set of covariates. As with regression, there are two broad categories of problems: <em>modeling for explanation</em> and <em>modeling for prediction</em>. Although terminology varies across fields, “regression” is generally used for situations in which our <em>dependent variable</em> is continuous. “Classification” applies to cases in which the dependent variable is binary.</p>
<p>All of the new models touched upon in this chapter speak to the wider discussion of fitting our model structures to better fit what is being measured in the world. Using logistical regressions of any type more accurately describe the measured effect when dealing with binary variables.</p>
<p>In this chapter, we will look at three common techniques of <strong>classification</strong> of binary data. First, we will consider logistic regression, which is similar conceptually to the linear regression models we considered in Chapters <a href="pitfalls.html#pitfalls">10</a> and <a href="continuous-response.html#continuous-response">11</a>. Second, we will consider classification and regression trees (CART). Third, we will discuss random forests.</p>
<!-- Deal with the ref() thing.  -->
<!-- Only include this section if it uses new/unique packages -->
<!-- tidymodels everywhere -->
<div id="needed-packages" class="section level3 unnumbered">
<h3>Needed packages</h3>
<p>Start with the <strong>tidyverse</strong> as usual.</p>
</div>
<div id="logistic-regression" class="section level2">
<h2>
<span class="header-section-number">12.1</span> Logistic regression</h2>
<div id="what-is-logistic-regression" class="section level3">
<h3>
<span class="header-section-number">12.1.1</span> What is logistic regression?</h3>
<p>Figure <a href="discrete-response.html#fig:OLSlogistic">12.1</a> illustrates a data set with a binary (0 or 1) response (<span class="math inline">\(Y\)</span>) and a single continuous predictor (<span class="math inline">\(X\)</span>). The blue line is a linear regression to model the probability of a success (<span class="math inline">\(Y=1\)</span>) for a given value of <span class="math inline">\(X\)</span>. With a binary response, the linear regression has an obvious problem: it can produce predicted probabilities below 0 and above 1. Probabilities can only range from 0 up to and including 1 as these represent a 0% and 100% chance of an event happening, respectively.</p>
<p>The red curve is the <em>logistic regression</em> curve. Note that its characteristic “S” shape always produces predicted probabilities between 0 and 1. Here is the formula for a logistic regression:</p>
<p>Where <span class="math inline">\(p\)</span> is the probability of a “yes” or “success” for a given set of predictors <span class="math inline">\(X\)</span>.</p>
<!-- Revisit nomenclature after chapter 5 -->
<div class="figure" style="text-align: center">
<span id="fig:OLSlogistic"></span>
<p class="caption marginnote shownote">
FIGURE 12.1: Linear vs. logistic regression models for binary response data.
</p>
<img src="book_temp_files/figure-html/OLSlogistic-1.png" alt="Linear vs. logistic regression models for binary response data." width="60%">
</div>
<!-- DK: How does the math work here? log(p/1-p) seems, to me, to map 0,1 to 0,infinity. -->
<!-- MB: I also need to do more research to understand this -->
<p>The mathematical function <span class="math inline">\(log\left(\frac{p}{1 - p}\right)\)</span> is called the <em>logit function</em> and it transforms variables from the space <span class="math inline">\((0, 1)\)</span> (like probabilities) to <span class="math inline">\((-\infty, \infty)\)</span>. The inverse of that function, the <em>standard logistic function</em>, is <span class="math inline">\(\frac{1}{1 + e^{-x}}\)</span> and transforms variables from the space <span class="math inline">\((-\infty, \infty)\)</span> to <span class="math inline">\((0, 1)\)</span>. From that latter function’s name we get the terminology of <em>logistic regression</em>.</p>
</div>
<div id="house-elections-exploratory-data-analysis" class="section level3">
<h3>
<span class="header-section-number">12.1.2</span> House elections: exploratory data analysis</h3>
<p>What affects whether a Democrat or Republican wins a race in the U.S. House of Representatives? This is an example of a binary response: either a Democrat wins (and a Republican loses) or a Republican wins (and a Democrat loses).<label for="tufte-sn-16" class="margin-toggle sidenote-number">16</label><input type="checkbox" id="tufte-sn-16" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">16</span> It is rare that third party candidates mount serious bids in U.S. House elections, so it isn’t a much of an oversimplication to think of the variable as binary.</span> In this section, we are going to consider several models predicting Democratic victory in House races. First, we will consider a single categorical variable as a predictor, the region in which a district lies: Midwest, Northeast, South, or West. Second, we will consider a single continuous variable: year. Finally, we fill fit a model that contains both separately, and than also an interaction between the two.</p>
<!-- DK: Too much cognitive load to create these datasets on the fly. They need to be ready to go. -->
<p>The data on House election results from 1976 to 2018 can be found in the <code>house_results</code> data frame in <strong>politicaldata</strong> package. We’ll create a version of this data frame called <code>house_ch12</code> that creates a new column <code>dem_win</code> that notes for each state if the Democratic candidate in a congressional district received more votes than the other candidates. We’ll also join it with the <code>state_info</code> data frame in the <strong>fivethirtyeight</strong> package to add the <code>region</code> of each state.</p>
<div class="sourceCode" id="cb913"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb913-1"><a href="discrete-response.html#cb913-1"></a><span class="kw">library</span>(politicaldata)</span>
<span id="cb913-2"><a href="discrete-response.html#cb913-2"></a></span>
<span id="cb913-3"><a href="discrete-response.html#cb913-3"></a>house_ch12 &lt;-<span class="st"> </span>house_results <span class="op">%&gt;%</span></span>
<span id="cb913-4"><a href="discrete-response.html#cb913-4"></a><span class="st">  </span></span>
<span id="cb913-5"><a href="discrete-response.html#cb913-5"></a><span class="st">  </span><span class="co"># Create dem_win variable</span></span>
<span id="cb913-6"><a href="discrete-response.html#cb913-6"></a><span class="st">  </span></span>
<span id="cb913-7"><a href="discrete-response.html#cb913-7"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dem =</span> <span class="kw">ifelse</span>(<span class="kw">is.na</span>(dem), <span class="dv">0</span>, dem),</span>
<span id="cb913-8"><a href="discrete-response.html#cb913-8"></a>         <span class="dt">other =</span> <span class="kw">ifelse</span>(<span class="kw">is.na</span>(other), <span class="dv">0</span>, other),</span>
<span id="cb913-9"><a href="discrete-response.html#cb913-9"></a>         <span class="dt">rep =</span> <span class="kw">ifelse</span>(<span class="kw">is.na</span>(rep), <span class="dv">0</span>, rep),</span>
<span id="cb913-10"><a href="discrete-response.html#cb913-10"></a>         <span class="dt">dem_win =</span> <span class="kw">ifelse</span>(dem <span class="op">&gt;</span><span class="st"> </span>rep <span class="op">&amp;</span><span class="st"> </span>dem <span class="op">&gt;</span><span class="st"> </span>other, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="op">%&gt;%</span></span>
<span id="cb913-11"><a href="discrete-response.html#cb913-11"></a><span class="st">  </span></span>
<span id="cb913-12"><a href="discrete-response.html#cb913-12"></a><span class="st">  </span><span class="co"># Rename to join with state_info</span></span>
<span id="cb913-13"><a href="discrete-response.html#cb913-13"></a><span class="st">  </span></span>
<span id="cb913-14"><a href="discrete-response.html#cb913-14"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">state_abbrev =</span> state_abb) <span class="op">%&gt;%</span></span>
<span id="cb913-15"><a href="discrete-response.html#cb913-15"></a><span class="st">  </span><span class="kw">left_join</span>(state_info) <span class="op">%&gt;%</span></span>
<span id="cb913-16"><a href="discrete-response.html#cb913-16"></a><span class="st">  </span><span class="kw">select</span>(region, state, district, year, dem_win)</span></code></pre></div>
<pre><code>## Joining, by = "state_abbrev"</code></pre>
<!-- DK: We use same dataset from other chapter, we need to modify this. But we won't have looked at everything! So, look at other stuff. Some is obvious, especially our new Y variable. But we can also look at stuff like number of elections per state, per year. Which state had the biggest districting rise and when? Indeed, the data exploration section in each chapter provides an occasion to learn more advanced R tricks. -->
<p>Recall the three common steps in an exploratory data analysis we saw in Subsection <a href="pitfalls.html#model1EDA">10.1.1</a>:</p>
<ol style="list-style-type: decimal">
<li>Looking at the raw data values.</li>
<li>Computing summary statistics.</li>
<li>Creating data visualizations.</li>
</ol>
<p>Let’s first look at the raw data values by either looking at <code>house_ch12</code> using RStudio’s spreadsheet viewer or by using the <code>glimpse()</code> function from the <strong>dplyr</strong> package:</p>
<div class="sourceCode" id="cb915"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb915-1"><a href="discrete-response.html#cb915-1"></a><span class="kw">glimpse</span>(house_ch12)</span></code></pre></div>
<pre><code>## Rows: 9,557
## Columns: 5
## $ region   &lt;chr&gt; "West", "South", "South", "South", "South", "South", "South"…
## $ state    &lt;chr&gt; "Alaska", "Alabama", "Alabama", "Alabama", "Alabama", "Alaba…
## $ district &lt;chr&gt; "AK-AL", "AL-01", "AL-02", "AL-03", "AL-04", "AL-05", "AL-06…
## $ year     &lt;dbl&gt; 1976, 1976, 1976, 1976, 1976, 1976, 1976, 1976, 1976, 1976, …
## $ dem_win  &lt;dbl&gt; 0, 0, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1, 0, 1, 1, 0, 1, 0, 1, 1, …</code></pre>
<p>Let’s also display a random sample of 5 rows of the 9,557 rows corresponding to different district-years. Remember due to the random nature of the sampling, you will likely end up with a different subset of 5 rows.</p>
<div class="sourceCode" id="cb917"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb917-1"><a href="discrete-response.html#cb917-1"></a>house_ch12 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb917-2"><a href="discrete-response.html#cb917-2"></a><span class="st">  </span><span class="kw">sample_n</span>(<span class="dt">size =</span> <span class="dv">5</span>)</span></code></pre></div>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#tpbmcjfgqa .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#tpbmcjfgqa .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#tpbmcjfgqa .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#tpbmcjfgqa .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#tpbmcjfgqa .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tpbmcjfgqa .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#tpbmcjfgqa .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#tpbmcjfgqa .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#tpbmcjfgqa .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#tpbmcjfgqa .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#tpbmcjfgqa .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#tpbmcjfgqa .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#tpbmcjfgqa .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#tpbmcjfgqa .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#tpbmcjfgqa .gt_from_md > :first-child {
  margin-top: 0;
}

#tpbmcjfgqa .gt_from_md > :last-child {
  margin-bottom: 0;
}

#tpbmcjfgqa .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#tpbmcjfgqa .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#tpbmcjfgqa .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#tpbmcjfgqa .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#tpbmcjfgqa .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#tpbmcjfgqa .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#tpbmcjfgqa .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tpbmcjfgqa .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#tpbmcjfgqa .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#tpbmcjfgqa .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#tpbmcjfgqa .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#tpbmcjfgqa .gt_left {
  text-align: left;
}

#tpbmcjfgqa .gt_center {
  text-align: center;
}

#tpbmcjfgqa .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#tpbmcjfgqa .gt_font_normal {
  font-weight: normal;
}

#tpbmcjfgqa .gt_font_bold {
  font-weight: bold;
}

#tpbmcjfgqa .gt_font_italic {
  font-style: italic;
}

#tpbmcjfgqa .gt_super {
  font-size: 65%;
}

#tpbmcjfgqa .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="tpbmcjfgqa" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">Region</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">State</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">Distrct</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Year</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Democrat Win?</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_left">West</td>
      <td class="gt_row gt_left">California</td>
      <td class="gt_row gt_left">CA-50</td>
      <td class="gt_row gt_right">2012</td>
      <td class="gt_row gt_right">0</td>
    </tr>
<tr>
<td class="gt_row gt_left">Northeast</td>
      <td class="gt_row gt_left">New York</td>
      <td class="gt_row gt_left">NY-27</td>
      <td class="gt_row gt_right">1984</td>
      <td class="gt_row gt_right">0</td>
    </tr>
<tr>
<td class="gt_row gt_left">Northeast</td>
      <td class="gt_row gt_left">New York</td>
      <td class="gt_row gt_left">NY-34</td>
      <td class="gt_row gt_right">1978</td>
      <td class="gt_row gt_right">0</td>
    </tr>
<tr>
<td class="gt_row gt_left">South</td>
      <td class="gt_row gt_left">Florida</td>
      <td class="gt_row gt_left">FL-06</td>
      <td class="gt_row gt_right">2008</td>
      <td class="gt_row gt_right">0</td>
    </tr>
<tr>
<td class="gt_row gt_left">Midwest</td>
      <td class="gt_row gt_left">Michigan</td>
      <td class="gt_row gt_left">MI-15</td>
      <td class="gt_row gt_right">1988</td>
      <td class="gt_row gt_right">1</td>
    </tr>
</tbody>
<tfoot class="gt_sourcenotes"><tr>
<td class="gt_sourcenote" colspan="5">A random sample of 5 out of the 4,201 district-years</td>
    </tr></tfoot>
</table></div>
<p>Now that we’ve looked at the raw values in our <code>house_ch12</code> data frame and got a sense of the data, let’s compute summary statistics. As we’ve done in our exploratory data analyses before, let’s use the <code>skim()</code> function from the <code>skimr</code> package, being sure to only select() the variables of interest in our model:</p>
<div class="sourceCode" id="cb918"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb918-1"><a href="discrete-response.html#cb918-1"></a>house_ch12 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb918-2"><a href="discrete-response.html#cb918-2"></a><span class="st">  </span><span class="kw">select</span>(dem_win, region, year) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb918-3"><a href="discrete-response.html#cb918-3"></a><span class="st">  </span><span class="kw">skim</span>()</span></code></pre></div>
<table style="width: auto;" class="table table-condensed">
<caption>
<span id="tab:unnamed-chunk-697">TABLE 12.1: </span>Data summary
</caption>
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Name
</td>
<td style="text-align:left;">
Piped data
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of rows
</td>
<td style="text-align:left;">
9557
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of columns
</td>
<td style="text-align:left;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
_______________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Column type frequency:
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
character
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
________________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Group variables
</td>
<td style="text-align:left;">
None
</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table>
<thead><tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:right;">
min
</th>
<th style="text-align:right;">
max
</th>
<th style="text-align:right;">
empty
</th>
<th style="text-align:right;">
n_unique
</th>
<th style="text-align:right;">
whitespace
</th>
</tr></thead>
<tbody><tr>
<td style="text-align:left;">
region
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0
</td>
</tr></tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead><tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
p0
</th>
<th style="text-align:right;">
p25
</th>
<th style="text-align:right;">
p50
</th>
<th style="text-align:right;">
p75
</th>
<th style="text-align:right;">
p100
</th>
<th style="text-align:left;">
hist
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
dem_win
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.54
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
▇▁▁▁▇
</td>
</tr>
<tr>
<td style="text-align:left;">
year
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1997.00
</td>
<td style="text-align:right;">
12.7
</td>
<td style="text-align:right;">
1976
</td>
<td style="text-align:right;">
1986
</td>
<td style="text-align:right;">
1998
</td>
<td style="text-align:right;">
2008
</td>
<td style="text-align:right;">
2018
</td>
<td style="text-align:left;">
▇▆▆▆▇
</td>
</tr>
</tbody>
</table>
<p>Observe that we have no missing data, that we have 9,557 observations, and that the mean of <code>dem_win</code> is 0.54, indicating that Democrats won 54% of the House elections in this period (1976–2018).</p>
<p>Let’s now perform the last of the three common steps in an exploratory data analysis: creating data visualizations.</p>
<p>For our categorical variable, we’ll look at histograms of <code>dem_win</code> faceted by <code>region</code>:</p>
<div class="sourceCode" id="cb919"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb919-1"><a href="discrete-response.html#cb919-1"></a>house_ch12 <span class="op">%&gt;%</span></span>
<span id="cb919-2"><a href="discrete-response.html#cb919-2"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> dem_win)) <span class="op">+</span></span>
<span id="cb919-3"><a href="discrete-response.html#cb919-3"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">10</span>, <span class="dt">color =</span> <span class="st">"white"</span>) <span class="op">+</span></span>
<span id="cb919-4"><a href="discrete-response.html#cb919-4"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">"Democratic victory percentage, 1976-2018"</span>, </span>
<span id="cb919-5"><a href="discrete-response.html#cb919-5"></a>       <span class="dt">y =</span> <span class="st">"Number of districts"</span>,</span>
<span id="cb919-6"><a href="discrete-response.html#cb919-6"></a>       <span class="dt">title =</span> <span class="st">"Histogram of distribution of Democratic victories by House district"</span>) <span class="op">+</span></span>
<span id="cb919-7"><a href="discrete-response.html#cb919-7"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>region) <span class="op">+</span></span>
<span id="cb919-8"><a href="discrete-response.html#cb919-8"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<p><img src="book_temp_files/figure-html/unnamed-chunk-698-1.png" width="672"></p>
<p>Wait! That doesn’t tell us very much, because our outcome variable only takes two values, 0 and 1. Let’s instead <code>group_by(district)</code> and <code>summarize()</code> to get a better sense of the distributions:</p>
<div class="sourceCode" id="cb920"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb920-1"><a href="discrete-response.html#cb920-1"></a>house_ch12 <span class="op">%&gt;%</span></span>
<span id="cb920-2"><a href="discrete-response.html#cb920-2"></a><span class="st">  </span><span class="kw">group_by</span>(region, district) <span class="op">%&gt;%</span></span>
<span id="cb920-3"><a href="discrete-response.html#cb920-3"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">dem_win =</span> <span class="kw">mean</span>(dem_win)) <span class="op">%&gt;%</span></span>
<span id="cb920-4"><a href="discrete-response.html#cb920-4"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> dem_win)) <span class="op">+</span></span>
<span id="cb920-5"><a href="discrete-response.html#cb920-5"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">10</span>, <span class="dt">color =</span> <span class="st">"white"</span>) <span class="op">+</span></span>
<span id="cb920-6"><a href="discrete-response.html#cb920-6"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">"Democratic victory percentage, 1976-2018"</span>, </span>
<span id="cb920-7"><a href="discrete-response.html#cb920-7"></a>       <span class="dt">y =</span> <span class="st">"Number of districts"</span>,</span>
<span id="cb920-8"><a href="discrete-response.html#cb920-8"></a>       <span class="dt">title =</span> <span class="st">"Histogram of distribution of Democratic victories by House district"</span>) <span class="op">+</span></span>
<span id="cb920-9"><a href="discrete-response.html#cb920-9"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>region) <span class="op">+</span><span class="st"> </span></span>
<span id="cb920-10"><a href="discrete-response.html#cb920-10"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<pre><code>## `summarise()` regrouping output by 'region' (override with `.groups` argument)</code></pre>
<p><img src="book_temp_files/figure-html/unnamed-chunk-699-1.png" width="672"></p>
<p>This is much more informative! We can see that the Midwest is highly bimodal, with many districts either electing Democrats for every year in this period or for none. The Northeast and West have many districts that always elect Democrats but few that never do. The South is the only region with a peak in the middle, indicating that there are many districts in the South that elected Democrats for about half the time during 1976-2018.</p>
<p>What happens if we create a scatterplot of our outcome variable <code>dem_win</code> and a continuous predictor, <code>year</code>?</p>
<div class="sourceCode" id="cb922"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb922-1"><a href="discrete-response.html#cb922-1"></a>house_ch12 <span class="op">%&gt;%</span></span>
<span id="cb922-2"><a href="discrete-response.html#cb922-2"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> dem_win)) <span class="op">+</span></span>
<span id="cb922-3"><a href="discrete-response.html#cb922-3"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb922-4"><a href="discrete-response.html#cb922-4"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">"Year"</span>, <span class="dt">y =</span> <span class="st">"Democratic Victory"</span>) <span class="op">+</span></span>
<span id="cb922-5"><a href="discrete-response.html#cb922-5"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">"lm"</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula 'y ~ x'</code></pre>
<p><img src="book_temp_files/figure-html/unnamed-chunk-700-1.png" width="672"></p>
<!-- DK: The below seems like good stuff, but I don't really understand it. Needs more words. Why is log(p/1-p) an interesting thing. Is it really? -->
<!-- MB: I think I clarified it more, but may need more explaining. p/1-p is just the function that transforms data into logit form, which is why it's so frequently mentioned. Could be abstracted out some more though. -->
<p>This is incomprehensible! When dealing with binary data, it is more helpful to construct an <em>empirical logit</em> plot instead of a regular scatterplot. An <em>empirical logit</em> is a linear model on logit-trasnformed data rather than a generalized linear model. The steps for constructing such a plot are as follows:</p>
<ol style="list-style-type: decimal">
<li>
<code>group_by</code> your continuous variable.</li>
<li>
<code>summarize</code> the percentage of successes in your outcome variable.</li>
<li>Calculate the <em>empirical logit</em> for each group, using the logit function: <span class="math inline">\(log\left(\frac{p}{1 - p}\right)\)</span>. This step transforms the data to fit the form of a logistical regression with a binary outcome.</li>
<li>Plot the results.</li>
</ol>
<p>The logit function exists in base R as <code>qlogis()</code>. Let’s look at the empirical logit plot:</p>
<div class="sourceCode" id="cb924"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb924-1"><a href="discrete-response.html#cb924-1"></a>house_ch12 <span class="op">%&gt;%</span></span>
<span id="cb924-2"><a href="discrete-response.html#cb924-2"></a><span class="st">  </span><span class="kw">group_by</span>(year) <span class="op">%&gt;%</span></span>
<span id="cb924-3"><a href="discrete-response.html#cb924-3"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">perc_dem_win =</span> <span class="kw">mean</span>(dem_win),</span>
<span id="cb924-4"><a href="discrete-response.html#cb924-4"></a>            <span class="dt">emplogit =</span> <span class="kw">qlogis</span>(perc_dem_win)) <span class="op">%&gt;%</span></span>
<span id="cb924-5"><a href="discrete-response.html#cb924-5"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> emplogit)) <span class="op">+</span></span>
<span id="cb924-6"><a href="discrete-response.html#cb924-6"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb924-7"><a href="discrete-response.html#cb924-7"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">"lm"</span>) <span class="op">+</span></span>
<span id="cb924-8"><a href="discrete-response.html#cb924-8"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb924-9"><a href="discrete-response.html#cb924-9"></a>       <span class="dt">y =</span> <span class="st">"Empirical logits"</span>) <span class="op">+</span></span>
<span id="cb924-10"><a href="discrete-response.html#cb924-10"></a><span class="st">  </span><span class="kw">theme_classic</span>()</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## `geom_smooth()` using formula 'y ~ x'</code></pre>
<p><img src="book_temp_files/figure-html/unnamed-chunk-701-1.png" width="672"></p>
<p>Now we see that after the logit transformation, there is roughly a linear relationship between our outcome variable and our explanatory variable <code>year</code>. This means that a logistic regression model makes sense. Some of the most visually apparent outliers will be familiar to students of American politics: 1994 (the “Republican Revolution”), 2008 (Obama’s first election), and 2018. Yet in general it appears that over time the Democrats have performed worse in House elections.</p>
<p>We can follow the same steps to look at this relationship within Census regions (Midwest, Northeast, South and West):</p>
<div class="sourceCode" id="cb927"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb927-1"><a href="discrete-response.html#cb927-1"></a>house_ch12 <span class="op">%&gt;%</span></span>
<span id="cb927-2"><a href="discrete-response.html#cb927-2"></a><span class="st">  </span><span class="kw">group_by</span>(region, year) <span class="op">%&gt;%</span></span>
<span id="cb927-3"><a href="discrete-response.html#cb927-3"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">perc_dem_win =</span> <span class="kw">mean</span>(dem_win),</span>
<span id="cb927-4"><a href="discrete-response.html#cb927-4"></a>            <span class="dt">emplogit =</span> <span class="kw">qlogis</span>(perc_dem_win)) <span class="op">%&gt;%</span></span>
<span id="cb927-5"><a href="discrete-response.html#cb927-5"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> emplogit)) <span class="op">+</span></span>
<span id="cb927-6"><a href="discrete-response.html#cb927-6"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb927-7"><a href="discrete-response.html#cb927-7"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">"lm"</span>) <span class="op">+</span></span>
<span id="cb927-8"><a href="discrete-response.html#cb927-8"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb927-9"><a href="discrete-response.html#cb927-9"></a>       <span class="dt">y =</span> <span class="st">"Empirical logits"</span>) <span class="op">+</span></span>
<span id="cb927-10"><a href="discrete-response.html#cb927-10"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>region) <span class="op">+</span></span>
<span id="cb927-11"><a href="discrete-response.html#cb927-11"></a><span class="st">  </span><span class="kw">theme_classic</span>()</span></code></pre></div>
<pre><code>## `summarise()` regrouping output by 'region' (override with `.groups` argument)</code></pre>
<pre><code>## `geom_smooth()` using formula 'y ~ x'</code></pre>
<p><img src="book_temp_files/figure-html/unnamed-chunk-702-1.png" width="672"></p>
<p>We see roughly linear relationships after the logit transformation within-region as well, although the relationship looks more linear in the Midwest and South than in the Northeast and West. We see that the Democratic Party’s overall decline in House races is driven by the South and to a lesser extent the Midwest; Democratic performance has on average improved in the Northeast and West. The sharp negative slope in the South will not be surprising if one is familiar with the collapse of the “Solid South.”</p>
</div>
<div id="one-categorical-explanatory-variable" class="section level3">
<h3>
<span class="header-section-number">12.1.3</span> One categorical explanatory variable</h3>
<p>Let’s start our modeling by predicting <code>dem_win</code> with a single categorical explanatory variable. We’ll start with a binary variable for whether an observation is in the South and we will progress to the categorical variable <code>region</code>. As we’ll see, the syntax for running a logistic regression in R is very similar to that for running a linear regression. In fact, we’ll follow the same basic steps:</p>
<ol style="list-style-type: decimal">
<li>We first “fit” the logistic regression model using the <code>glm(y ~ x, family, data)</code> function and save it in <code>house_region_model</code>.</li>
<li>We get the regression table by applying the <code>tidy()</code> function from the <strong>broom</strong> package to <code>house_region_model</code>. We’ll print the <code>term</code>, <code>estimate</code>, <code>conf.low</code>, and <code>conf.high</code> columns.</li>
</ol>
<p>Note that the key difference is that instead of using <code>lm()</code>, we are now using <code>glm()</code>. <code>glm()</code> operates very similarly to <code>lm()</code>, but it has an additional argument: <code>family</code>. To run a logistic regression, we use <code>family = binomial</code>.</p>
<p>Let’s create a binary variable for whether an observation is in the South:</p>
<div class="sourceCode" id="cb930"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb930-1"><a href="discrete-response.html#cb930-1"></a>house_ch12 &lt;-<span class="st"> </span>house_ch12 <span class="op">%&gt;%</span></span>
<span id="cb930-2"><a href="discrete-response.html#cb930-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">south =</span> <span class="dv">1</span> <span class="op">*</span><span class="st"> </span>(region <span class="op">==</span><span class="st"> "South"</span>))</span></code></pre></div>
<p>Next, let’s fit a model and <code>tidy()</code> it:</p>
<div class="sourceCode" id="cb931"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb931-1"><a href="discrete-response.html#cb931-1"></a>house_south_model &lt;-<span class="st"> </span><span class="kw">glm</span>(dem_win <span class="op">~</span><span class="st"> </span>south, <span class="dt">family =</span> binomial, <span class="dt">data =</span> house_ch12)</span>
<span id="cb931-2"><a href="discrete-response.html#cb931-2"></a>house_south_model <span class="op">%&gt;%</span></span>
<span id="cb931-3"><a href="discrete-response.html#cb931-3"></a><span class="st">  </span><span class="kw">tidy</span>(<span class="dt">conf.int =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb931-4"><a href="discrete-response.html#cb931-4"></a><span class="st">  </span><span class="kw">select</span>(term, estimate)</span></code></pre></div>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#wackmwrezz .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#wackmwrezz .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wackmwrezz .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#wackmwrezz .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#wackmwrezz .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wackmwrezz .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wackmwrezz .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#wackmwrezz .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#wackmwrezz .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#wackmwrezz .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#wackmwrezz .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#wackmwrezz .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#wackmwrezz .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#wackmwrezz .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#wackmwrezz .gt_from_md > :first-child {
  margin-top: 0;
}

#wackmwrezz .gt_from_md > :last-child {
  margin-bottom: 0;
}

#wackmwrezz .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#wackmwrezz .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#wackmwrezz .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wackmwrezz .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#wackmwrezz .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wackmwrezz .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#wackmwrezz .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wackmwrezz .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wackmwrezz .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#wackmwrezz .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wackmwrezz .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#wackmwrezz .gt_left {
  text-align: left;
}

#wackmwrezz .gt_center {
  text-align: center;
}

#wackmwrezz .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#wackmwrezz .gt_font_normal {
  font-weight: normal;
}

#wackmwrezz .gt_font_bold {
  font-weight: bold;
}

#wackmwrezz .gt_font_italic {
  font-style: italic;
}

#wackmwrezz .gt_super {
  font-size: 65%;
}

#wackmwrezz .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="wackmwrezz" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">term</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">estimate</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_left">(Intercept)</td>
      <td class="gt_row gt_right">0.23</td>
    </tr>
<tr>
<td class="gt_row gt_left">south</td>
      <td class="gt_row gt_right">-0.25</td>
    </tr>
</tbody>
</table></div>
<p>How can we interpret the coefficients? Unlike linear regressions, these coefficients aren’t directly interpretable. Recall our logistic regression model equation:</p>
<p><span class="math display">\[
\log\left(\frac{p}{1 - p}\right)=\beta_0+\beta_1X 
\]</span></p>
<p>A one-unit change in <span class="math inline">\(X\)</span> thus is associated with a one-unit change in <span class="math inline">\(log\left(\frac{p}{1 - p}\right)\)</span>, where <span class="math inline">\(p\)</span> is the predicted probability of success. It is hard to understand intuitively what this means.</p>
<p>However, with only two possible values for the predictors (<code>south</code> = 0 or <code>south</code> = 1), we can directly calculate all the possible values of <span class="math inline">\(p\)</span> this model by using the <em>standard logistic function</em>:</p>
<p><span class="math display">\[
p = \frac{1}{1 + e^{-(\beta_0+\beta_1X)}} 
\]</span></p>
<p>This can easily be done using the <code>plogis()</code> function in R.</p>
<p>Thus, for our example, we have:</p>
<p><span class="math display">\[
p_{dem\_win} = \frac{1}{1 + e^{-(0.230 - 0.249 \times south)}} 
\]</span></p>
<p>Therefore, the predicted probability for an observation in the South is <span class="math inline">\(\frac{1}{1 + e^{-(0.230 - 0.249)}}\)</span> (0.5) and the predicted probability for an observation outside the South is <span class="math inline">\(\frac{1}{1 + e^{-(0.230)}}\)</span> (0.56) a difference of -0.06. Thus, an observation being the South is associated with a -0.06 decrease in the predicted probability of a Democratic victory.</p>
<p>Note that you could also estimate this value through the so-called <strong>“divide by 4” rule</strong>: <span class="math inline">\(-0.249 / 4 \approx 0.062\)</span>. We’ll discuss this further when we talk about interpreting the coefficiences of continuous predictors in logistic regression models.</p>
<!-- Here would be a good place to begin a discusssion of validity -->
<p>Let’s now estimate the uncertainty around our coefficients. We’ll start by showing how you can do this through the bootstrap. We’ll begin by loading the <strong>infer</strong> package. We’re going to use the function <code>rep_sample_n()</code> to resample from our data 1,000 times:</p>
<div class="sourceCode" id="cb932"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb932-1"><a href="discrete-response.html#cb932-1"></a><span class="kw">library</span>(infer)</span>
<span id="cb932-2"><a href="discrete-response.html#cb932-2"></a></span>
<span id="cb932-3"><a href="discrete-response.html#cb932-3"></a>x &lt;-<span class="st"> </span>house_ch12 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb932-4"><a href="discrete-response.html#cb932-4"></a><span class="st">  </span><span class="kw">select</span>(dem_win, south) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb932-5"><a href="discrete-response.html#cb932-5"></a><span class="st">  </span><span class="kw">rep_sample_n</span>(<span class="dt">size =</span> <span class="kw">nrow</span>(house_ch12), <span class="dt">replace =</span> <span class="ot">TRUE</span>, <span class="dt">reps =</span> <span class="dv">1000</span>)</span>
<span id="cb932-6"><a href="discrete-response.html#cb932-6"></a></span>
<span id="cb932-7"><a href="discrete-response.html#cb932-7"></a>x</span></code></pre></div>
<pre><code>## # A tibble: 9,557,000 x 3
## # Groups:   replicate [1,000]
##    replicate dem_win south
##        &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt;
##  1         1       0     0
##  2         1       1     0
##  3         1       0     0
##  4         1       1     1
##  5         1       0     0
##  6         1       0     0
##  7         1       1     0
##  8         1       1     1
##  9         1       0     0
## 10         1       0     0
## # … with 9,556,990 more rows</code></pre>
<p>For each <code>replicate</code>, we have 9557 resamples of <code>dem_win</code> and <code>south</code>.</p>
<p>Next, we are going to <code>nest()</code> our data by <code>replicate</code>:</p>
<div class="sourceCode" id="cb934"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb934-1"><a href="discrete-response.html#cb934-1"></a>x &lt;-<span class="st"> </span>x <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb934-2"><a href="discrete-response.html#cb934-2"></a><span class="st">  </span><span class="kw">group_by</span>(replicate) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb934-3"><a href="discrete-response.html#cb934-3"></a><span class="st">  </span><span class="kw">nest</span>()</span>
<span id="cb934-4"><a href="discrete-response.html#cb934-4"></a></span>
<span id="cb934-5"><a href="discrete-response.html#cb934-5"></a>x</span></code></pre></div>
<pre><code>## # A tibble: 1,000 x 2
## # Groups:   replicate [1,000]
##    replicate data                
##        &lt;int&gt; &lt;list&gt;              
##  1         1 &lt;tibble [9,557 × 2]&gt;
##  2         2 &lt;tibble [9,557 × 2]&gt;
##  3         3 &lt;tibble [9,557 × 2]&gt;
##  4         4 &lt;tibble [9,557 × 2]&gt;
##  5         5 &lt;tibble [9,557 × 2]&gt;
##  6         6 &lt;tibble [9,557 × 2]&gt;
##  7         7 &lt;tibble [9,557 × 2]&gt;
##  8         8 &lt;tibble [9,557 × 2]&gt;
##  9         9 &lt;tibble [9,557 × 2]&gt;
## 10        10 &lt;tibble [9,557 × 2]&gt;
## # … with 990 more rows</code></pre>
<p>After grouping by <code>replicate</code> and using <code>nest()</code>, we now have a dataset of 1,000 rows and a list column named <code>data</code>. Each element of <code>data</code> is a tibble consisting of one of the resampled datasets we created using <code>rep_sample_n()</code>.</p>
<p>Now, we can use <code>map()</code> to run our logistic regression for each dataset:</p>
<div class="sourceCode" id="cb936"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb936-1"><a href="discrete-response.html#cb936-1"></a>x &lt;-<span class="st"> </span>x <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb936-2"><a href="discrete-response.html#cb936-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mod =</span> <span class="kw">map</span>(data, <span class="op">~</span><span class="st"> </span><span class="kw">glm</span>(dem_win <span class="op">~</span><span class="st"> </span>south, <span class="dt">family =</span> binomial, <span class="dt">data =</span> .)))</span>
<span id="cb936-3"><a href="discrete-response.html#cb936-3"></a></span>
<span id="cb936-4"><a href="discrete-response.html#cb936-4"></a>x</span></code></pre></div>
<pre><code>## # A tibble: 1,000 x 3
## # Groups:   replicate [1,000]
##    replicate data                 mod   
##        &lt;int&gt; &lt;list&gt;               &lt;list&gt;
##  1         1 &lt;tibble [9,557 × 2]&gt; &lt;glm&gt; 
##  2         2 &lt;tibble [9,557 × 2]&gt; &lt;glm&gt; 
##  3         3 &lt;tibble [9,557 × 2]&gt; &lt;glm&gt; 
##  4         4 &lt;tibble [9,557 × 2]&gt; &lt;glm&gt; 
##  5         5 &lt;tibble [9,557 × 2]&gt; &lt;glm&gt; 
##  6         6 &lt;tibble [9,557 × 2]&gt; &lt;glm&gt; 
##  7         7 &lt;tibble [9,557 × 2]&gt; &lt;glm&gt; 
##  8         8 &lt;tibble [9,557 × 2]&gt; &lt;glm&gt; 
##  9         9 &lt;tibble [9,557 × 2]&gt; &lt;glm&gt; 
## 10        10 &lt;tibble [9,557 × 2]&gt; &lt;glm&gt; 
## # … with 990 more rows</code></pre>
<p>Now we have a new list column, <code>mod</code>, that contains the model objects created by <code>glm()</code>. We will now want to <code>tidy()</code> the object created by <code>glm()</code>:</p>
<div class="sourceCode" id="cb938"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb938-1"><a href="discrete-response.html#cb938-1"></a>x &lt;-<span class="st"> </span>x <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb938-2"><a href="discrete-response.html#cb938-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">reg_results =</span> <span class="kw">map</span>(mod, <span class="op">~</span><span class="st"> </span><span class="kw">tidy</span>(.)))</span>
<span id="cb938-3"><a href="discrete-response.html#cb938-3"></a></span>
<span id="cb938-4"><a href="discrete-response.html#cb938-4"></a>x</span></code></pre></div>
<pre><code>## # A tibble: 1,000 x 4
## # Groups:   replicate [1,000]
##    replicate data                 mod    reg_results     
##        &lt;int&gt; &lt;list&gt;               &lt;list&gt; &lt;list&gt;          
##  1         1 &lt;tibble [9,557 × 2]&gt; &lt;glm&gt;  &lt;tibble [2 × 5]&gt;
##  2         2 &lt;tibble [9,557 × 2]&gt; &lt;glm&gt;  &lt;tibble [2 × 5]&gt;
##  3         3 &lt;tibble [9,557 × 2]&gt; &lt;glm&gt;  &lt;tibble [2 × 5]&gt;
##  4         4 &lt;tibble [9,557 × 2]&gt; &lt;glm&gt;  &lt;tibble [2 × 5]&gt;
##  5         5 &lt;tibble [9,557 × 2]&gt; &lt;glm&gt;  &lt;tibble [2 × 5]&gt;
##  6         6 &lt;tibble [9,557 × 2]&gt; &lt;glm&gt;  &lt;tibble [2 × 5]&gt;
##  7         7 &lt;tibble [9,557 × 2]&gt; &lt;glm&gt;  &lt;tibble [2 × 5]&gt;
##  8         8 &lt;tibble [9,557 × 2]&gt; &lt;glm&gt;  &lt;tibble [2 × 5]&gt;
##  9         9 &lt;tibble [9,557 × 2]&gt; &lt;glm&gt;  &lt;tibble [2 × 5]&gt;
## 10        10 &lt;tibble [9,557 × 2]&gt; &lt;glm&gt;  &lt;tibble [2 × 5]&gt;
## # … with 990 more rows</code></pre>
<p><code>tidy()</code> stores the coefficients in the <code>estimate</code> column, with each coefficient named in the <code>term</code> column. Thus, if we <code>filter()</code> by <code>term</code> and <code>pull(estimate)</code>, we can get the logistic regression coefficient for each bootstrap sample:</p>
<div class="sourceCode" id="cb940"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb940-1"><a href="discrete-response.html#cb940-1"></a>x &lt;-<span class="st"> </span>x <span class="op">%&gt;%</span></span>
<span id="cb940-2"><a href="discrete-response.html#cb940-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">disp_coef =</span> <span class="kw">map_dbl</span>(reg_results, <span class="op">~</span><span class="st"> </span><span class="kw">filter</span>(., term <span class="op">==</span><span class="st"> "south"</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(estimate)))</span>
<span id="cb940-3"><a href="discrete-response.html#cb940-3"></a></span>
<span id="cb940-4"><a href="discrete-response.html#cb940-4"></a>x</span></code></pre></div>
<pre><code>## # A tibble: 1,000 x 5
## # Groups:   replicate [1,000]
##    replicate data                 mod    reg_results      disp_coef
##        &lt;int&gt; &lt;list&gt;               &lt;list&gt; &lt;list&gt;               &lt;dbl&gt;
##  1         1 &lt;tibble [9,557 × 2]&gt; &lt;glm&gt;  &lt;tibble [2 × 5]&gt;    -0.247
##  2         2 &lt;tibble [9,557 × 2]&gt; &lt;glm&gt;  &lt;tibble [2 × 5]&gt;    -0.289
##  3         3 &lt;tibble [9,557 × 2]&gt; &lt;glm&gt;  &lt;tibble [2 × 5]&gt;    -0.205
##  4         4 &lt;tibble [9,557 × 2]&gt; &lt;glm&gt;  &lt;tibble [2 × 5]&gt;    -0.223
##  5         5 &lt;tibble [9,557 × 2]&gt; &lt;glm&gt;  &lt;tibble [2 × 5]&gt;    -0.207
##  6         6 &lt;tibble [9,557 × 2]&gt; &lt;glm&gt;  &lt;tibble [2 × 5]&gt;    -0.201
##  7         7 &lt;tibble [9,557 × 2]&gt; &lt;glm&gt;  &lt;tibble [2 × 5]&gt;    -0.222
##  8         8 &lt;tibble [9,557 × 2]&gt; &lt;glm&gt;  &lt;tibble [2 × 5]&gt;    -0.316
##  9         9 &lt;tibble [9,557 × 2]&gt; &lt;glm&gt;  &lt;tibble [2 × 5]&gt;    -0.248
## 10        10 &lt;tibble [9,557 × 2]&gt; &lt;glm&gt;  &lt;tibble [2 × 5]&gt;    -0.225
## # … with 990 more rows</code></pre>
<p>Now that we have 1,000 estimates from our bootstrap samples, we can construct a percentile-based confidence interval easily:</p>
<div class="sourceCode" id="cb942"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb942-1"><a href="discrete-response.html#cb942-1"></a>x <span class="op">%&gt;%</span></span>
<span id="cb942-2"><a href="discrete-response.html#cb942-2"></a><span class="st"> </span><span class="kw">pull</span>(disp_coef) <span class="op">%&gt;%</span></span>
<span id="cb942-3"><a href="discrete-response.html#cb942-3"></a><span class="st"> </span><span class="kw">quantile</span>(<span class="kw">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span>))</span></code></pre></div>
<pre><code>##  2.5%   50%   98% 
## -0.33 -0.25 -0.17</code></pre>
<p>As we’ve seen before, these are very similar to what we observe using <code>tidy(conf.int = TRUE)</code>:</p>
<div class="sourceCode" id="cb944"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb944-1"><a href="discrete-response.html#cb944-1"></a>house_south_model <span class="op">%&gt;%</span></span>
<span id="cb944-2"><a href="discrete-response.html#cb944-2"></a><span class="st">  </span><span class="kw">tidy</span>(<span class="dt">conf.int =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb944-3"><a href="discrete-response.html#cb944-3"></a><span class="st">  </span><span class="kw">select</span>(term, estimate, conf.low, conf.high)</span></code></pre></div>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#wrddfubeth .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#wrddfubeth .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wrddfubeth .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#wrddfubeth .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#wrddfubeth .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wrddfubeth .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wrddfubeth .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#wrddfubeth .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#wrddfubeth .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#wrddfubeth .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#wrddfubeth .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#wrddfubeth .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#wrddfubeth .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#wrddfubeth .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#wrddfubeth .gt_from_md > :first-child {
  margin-top: 0;
}

#wrddfubeth .gt_from_md > :last-child {
  margin-bottom: 0;
}

#wrddfubeth .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#wrddfubeth .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#wrddfubeth .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wrddfubeth .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#wrddfubeth .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wrddfubeth .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#wrddfubeth .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wrddfubeth .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wrddfubeth .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#wrddfubeth .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wrddfubeth .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#wrddfubeth .gt_left {
  text-align: left;
}

#wrddfubeth .gt_center {
  text-align: center;
}

#wrddfubeth .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#wrddfubeth .gt_font_normal {
  font-weight: normal;
}

#wrddfubeth .gt_font_bold {
  font-weight: bold;
}

#wrddfubeth .gt_font_italic {
  font-style: italic;
}

#wrddfubeth .gt_super {
  font-size: 65%;
}

#wrddfubeth .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="wrddfubeth" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">term</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">estimate</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">conf.low</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">conf.high</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_left">(Intercept)</td>
      <td class="gt_row gt_right">0.23</td>
      <td class="gt_row gt_right">0.18</td>
      <td class="gt_row gt_right">0.28</td>
    </tr>
<tr>
<td class="gt_row gt_left">south</td>
      <td class="gt_row gt_right">-0.25</td>
      <td class="gt_row gt_right">-0.33</td>
      <td class="gt_row gt_right">-0.16</td>
    </tr>
</tbody>
<tfoot class="gt_sourcenotes"><tr>
<td class="gt_sourcenote" colspan="4">Logistical Regression Table</td>
    </tr></tfoot>
</table></div>
<p>Thus, from now on, we’ll just use <code>tidy(conf.int = TRUE)</code> when working with <code>glm()</code>, just as we did with <code>lm()</code>.</p>
<p>Let’s try running a slightly more complicated version of the above model, where we use <code>region</code> as a predictor instead of <code>south</code>.</p>
<div class="sourceCode" id="cb945"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb945-1"><a href="discrete-response.html#cb945-1"></a>house_region_model &lt;-<span class="st"> </span><span class="kw">glm</span>(dem_win <span class="op">~</span><span class="st"> </span>region, <span class="dt">family =</span> binomial, <span class="dt">data =</span> house_ch12)</span>
<span id="cb945-2"><a href="discrete-response.html#cb945-2"></a>house_region_model <span class="op">%&gt;%</span></span>
<span id="cb945-3"><a href="discrete-response.html#cb945-3"></a><span class="st">  </span><span class="kw">tidy</span>(<span class="dt">conf.int =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb945-4"><a href="discrete-response.html#cb945-4"></a><span class="st">  </span><span class="kw">select</span>(term, estimate, conf.low, conf.high)</span></code></pre></div>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#mpfvyenqpp .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#mpfvyenqpp .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mpfvyenqpp .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#mpfvyenqpp .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#mpfvyenqpp .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mpfvyenqpp .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mpfvyenqpp .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#mpfvyenqpp .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#mpfvyenqpp .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#mpfvyenqpp .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#mpfvyenqpp .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#mpfvyenqpp .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#mpfvyenqpp .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#mpfvyenqpp .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#mpfvyenqpp .gt_from_md > :first-child {
  margin-top: 0;
}

#mpfvyenqpp .gt_from_md > :last-child {
  margin-bottom: 0;
}

#mpfvyenqpp .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#mpfvyenqpp .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#mpfvyenqpp .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mpfvyenqpp .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#mpfvyenqpp .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mpfvyenqpp .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#mpfvyenqpp .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mpfvyenqpp .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mpfvyenqpp .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#mpfvyenqpp .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mpfvyenqpp .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#mpfvyenqpp .gt_left {
  text-align: left;
}

#mpfvyenqpp .gt_center {
  text-align: center;
}

#mpfvyenqpp .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#mpfvyenqpp .gt_font_normal {
  font-weight: normal;
}

#mpfvyenqpp .gt_font_bold {
  font-weight: bold;
}

#mpfvyenqpp .gt_font_italic {
  font-style: italic;
}

#mpfvyenqpp .gt_super {
  font-size: 65%;
}

#mpfvyenqpp .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="mpfvyenqpp" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">term</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">estimate</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">conf.low</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">conf.high</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_left">(Intercept)</td>
      <td class="gt_row gt_right">-0.076</td>
      <td class="gt_row gt_right">-0.16</td>
      <td class="gt_row gt_right">0.0057</td>
    </tr>
<tr>
<td class="gt_row gt_left">regionNortheast</td>
      <td class="gt_row gt_right">0.657</td>
      <td class="gt_row gt_right">0.53</td>
      <td class="gt_row gt_right">0.7803</td>
    </tr>
<tr>
<td class="gt_row gt_left">regionSouth</td>
      <td class="gt_row gt_right">0.056</td>
      <td class="gt_row gt_right">-0.05</td>
      <td class="gt_row gt_right">0.1629</td>
    </tr>
<tr>
<td class="gt_row gt_left">regionWest</td>
      <td class="gt_row gt_right">0.333</td>
      <td class="gt_row gt_right">0.21</td>
      <td class="gt_row gt_right">0.4528</td>
    </tr>
</tbody>
<tfoot class="gt_sourcenotes"><tr>
<td class="gt_sourcenote" colspan="4">Logistical Regression Table</td>
    </tr></tfoot>
</table></div>
<p>The intercept here is the omitted category, the Midwest. We can calculate the predicted probabilities for each category:</p>
<ul>
<li>Midwest: <span class="math inline">\(\frac{1}{1 + e^{-(-0.076)}} = 0.481\)</span>
</li>
<li>Northeast: <span class="math inline">\(\frac{1}{1 + e^{-(-0.076 + 0.657)}} = 0.641\)</span>
</li>
<li>South: <span class="math inline">\(\frac{1}{1 + e^{-(-0.076 + 0.056)}} = 0.495\)</span>
</li>
<li>West: <span class="math inline">\(\frac{1}{1 + e^{-(-0.076 + 0.333)}} = 0.564\)</span>
</li>
</ul>
<p>We can then interpret the effect of moving from one category to another. For example, the effect of being in the Northeast as opposed to the Midwest is 0.16; the predicted probability of a Democratic victory in the Northeast is 0.16 greater than in the Midwest. Note too that we could have obtained this through the “divide by 4” rule: <span class="math inline">\(0.657 / 4 \approx 0.16\)</span>.</p>
</div>
<div id="observedfitted-values-and-residuals" class="section level3">
<h3>
<span class="header-section-number">12.1.4</span> Observed/fitted values and residuals</h3>
<p>We have previously defined the following three concepts for a linear regression:</p>
<ol style="list-style-type: decimal">
<li>Observed values <span class="math inline">\(y\)</span>, or the observed value of the outcome variable</li>
<li>Fitted values <span class="math inline">\(\widehat{y}\)</span>, or the value on the regression line for a given <span class="math inline">\(x\)</span> value</li>
<li>Residuals <span class="math inline">\(y - \widehat{y}\)</span>, or the error between the observed value and the fitted value</li>
</ol>
<p>We obtained these values and other values using the <code>augment()</code> function from the <strong>broom</strong> package. Recall too that we used the <code>.se.fit</code> column to construct confidence intervals. We’ll see here how we can apply these same concepts to logistic regression.</p>
<div class="sourceCode" id="cb946"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb946-1"><a href="discrete-response.html#cb946-1"></a>regression_points &lt;-<span class="st"> </span>house_region_model <span class="op">%&gt;%</span></span>
<span id="cb946-2"><a href="discrete-response.html#cb946-2"></a><span class="st">  </span><span class="kw">augment</span>(<span class="dt">se_fit =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb946-3"><a href="discrete-response.html#cb946-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">conf.low =</span> .fitted <span class="op">-</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>.se.fit,</span>
<span id="cb946-4"><a href="discrete-response.html#cb946-4"></a>         <span class="dt">conf.high =</span> .fitted <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>.se.fit) <span class="op">%&gt;%</span></span>
<span id="cb946-5"><a href="discrete-response.html#cb946-5"></a><span class="st">  </span><span class="kw">select</span>(dem_win, region, .fitted, conf.low, conf.high, .resid)</span>
<span id="cb946-6"><a href="discrete-response.html#cb946-6"></a>regression_points</span></code></pre></div>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#nqikjmqeqb .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#nqikjmqeqb .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#nqikjmqeqb .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#nqikjmqeqb .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#nqikjmqeqb .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nqikjmqeqb .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#nqikjmqeqb .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#nqikjmqeqb .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#nqikjmqeqb .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#nqikjmqeqb .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#nqikjmqeqb .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#nqikjmqeqb .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#nqikjmqeqb .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#nqikjmqeqb .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#nqikjmqeqb .gt_from_md > :first-child {
  margin-top: 0;
}

#nqikjmqeqb .gt_from_md > :last-child {
  margin-bottom: 0;
}

#nqikjmqeqb .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#nqikjmqeqb .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#nqikjmqeqb .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#nqikjmqeqb .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#nqikjmqeqb .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#nqikjmqeqb .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#nqikjmqeqb .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nqikjmqeqb .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#nqikjmqeqb .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#nqikjmqeqb .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#nqikjmqeqb .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#nqikjmqeqb .gt_left {
  text-align: left;
}

#nqikjmqeqb .gt_center {
  text-align: center;
}

#nqikjmqeqb .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#nqikjmqeqb .gt_font_normal {
  font-weight: normal;
}

#nqikjmqeqb .gt_font_bold {
  font-weight: bold;
}

#nqikjmqeqb .gt_font_italic {
  font-style: italic;
}

#nqikjmqeqb .gt_super {
  font-size: 65%;
}

#nqikjmqeqb .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="nqikjmqeqb" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">dem_win</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">region</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">.fitted</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">conf.low</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">conf.high</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">.resid</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_right">0</td>
      <td class="gt_row gt_left">West</td>
      <td class="gt_row gt_right">0.257</td>
      <td class="gt_row gt_right">0.168</td>
      <td class="gt_row gt_right">0.347</td>
      <td class="gt_row gt_right">-1.3</td>
    </tr>
<tr>
<td class="gt_row gt_right">0</td>
      <td class="gt_row gt_left">South</td>
      <td class="gt_row gt_right">-0.019</td>
      <td class="gt_row gt_right">-0.089</td>
      <td class="gt_row gt_right">0.051</td>
      <td class="gt_row gt_right">-1.2</td>
    </tr>
<tr>
<td class="gt_row gt_right">0</td>
      <td class="gt_row gt_left">South</td>
      <td class="gt_row gt_right">-0.019</td>
      <td class="gt_row gt_right">-0.089</td>
      <td class="gt_row gt_right">0.051</td>
      <td class="gt_row gt_right">-1.2</td>
    </tr>
<tr>
<td class="gt_row gt_right">1</td>
      <td class="gt_row gt_left">South</td>
      <td class="gt_row gt_right">-0.019</td>
      <td class="gt_row gt_right">-0.089</td>
      <td class="gt_row gt_right">0.051</td>
      <td class="gt_row gt_right">1.2</td>
    </tr>
<tr>
<td class="gt_row gt_right">1</td>
      <td class="gt_row gt_left">South</td>
      <td class="gt_row gt_right">-0.019</td>
      <td class="gt_row gt_right">-0.089</td>
      <td class="gt_row gt_right">0.051</td>
      <td class="gt_row gt_right">1.2</td>
    </tr>
<tr>
<td class="gt_row gt_right">1</td>
      <td class="gt_row gt_left">South</td>
      <td class="gt_row gt_right">-0.019</td>
      <td class="gt_row gt_right">-0.089</td>
      <td class="gt_row gt_right">0.051</td>
      <td class="gt_row gt_right">1.2</td>
    </tr>
<tr>
<td class="gt_row gt_right">0</td>
      <td class="gt_row gt_left">South</td>
      <td class="gt_row gt_right">-0.019</td>
      <td class="gt_row gt_right">-0.089</td>
      <td class="gt_row gt_right">0.051</td>
      <td class="gt_row gt_right">-1.2</td>
    </tr>
<tr>
<td class="gt_row gt_right">1</td>
      <td class="gt_row gt_left">South</td>
      <td class="gt_row gt_right">-0.019</td>
      <td class="gt_row gt_right">-0.089</td>
      <td class="gt_row gt_right">0.051</td>
      <td class="gt_row gt_right">1.2</td>
    </tr>
<tr>
<td class="gt_row gt_right">1</td>
      <td class="gt_row gt_left">South</td>
      <td class="gt_row gt_right">-0.019</td>
      <td class="gt_row gt_right">-0.089</td>
      <td class="gt_row gt_right">0.051</td>
      <td class="gt_row gt_right">1.2</td>
    </tr>
<tr>
<td class="gt_row gt_right">1</td>
      <td class="gt_row gt_left">South</td>
      <td class="gt_row gt_right">-0.019</td>
      <td class="gt_row gt_right">-0.089</td>
      <td class="gt_row gt_right">0.051</td>
      <td class="gt_row gt_right">1.2</td>
    </tr>
</tbody>
<tfoot class="gt_sourcenotes"><tr>
<td class="gt_sourcenote" colspan="6">Regression points (First 10 out of 4,201 district-years)</td>
    </tr></tfoot>
</table></div>
<p>The syntax is the same, but the interpretation has to change, since the <code>.fitted</code>, <code>conf.low</code>, and <code>conf.high</code> columns are all on the logit scale. While we could try to interpret these values, <code>augment()</code> has the argument <code>type.predict = "response"</code> that allow us to present the results in terms of <em>predicted probabilities</em>:</p>
<div class="sourceCode" id="cb947"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb947-1"><a href="discrete-response.html#cb947-1"></a>regression_points &lt;-<span class="st"> </span>house_region_model <span class="op">%&gt;%</span></span>
<span id="cb947-2"><a href="discrete-response.html#cb947-2"></a><span class="st">  </span><span class="kw">augment</span>(<span class="dt">type.predict =</span> <span class="st">"response"</span>, <span class="dt">se_fit =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb947-3"><a href="discrete-response.html#cb947-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">conf.low =</span> .fitted <span class="op">-</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>.se.fit,</span>
<span id="cb947-4"><a href="discrete-response.html#cb947-4"></a>         <span class="dt">conf.high =</span> .fitted <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>.se.fit) <span class="op">%&gt;%</span></span>
<span id="cb947-5"><a href="discrete-response.html#cb947-5"></a><span class="st">  </span><span class="kw">select</span>(dem_win, region, .fitted, conf.low, conf.high, .resid)</span>
<span id="cb947-6"><a href="discrete-response.html#cb947-6"></a>regression_points</span></code></pre></div>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#srjrvvkatz .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#srjrvvkatz .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#srjrvvkatz .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#srjrvvkatz .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#srjrvvkatz .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#srjrvvkatz .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#srjrvvkatz .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#srjrvvkatz .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#srjrvvkatz .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#srjrvvkatz .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#srjrvvkatz .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#srjrvvkatz .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#srjrvvkatz .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#srjrvvkatz .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#srjrvvkatz .gt_from_md > :first-child {
  margin-top: 0;
}

#srjrvvkatz .gt_from_md > :last-child {
  margin-bottom: 0;
}

#srjrvvkatz .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#srjrvvkatz .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#srjrvvkatz .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#srjrvvkatz .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#srjrvvkatz .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#srjrvvkatz .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#srjrvvkatz .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#srjrvvkatz .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#srjrvvkatz .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#srjrvvkatz .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#srjrvvkatz .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#srjrvvkatz .gt_left {
  text-align: left;
}

#srjrvvkatz .gt_center {
  text-align: center;
}

#srjrvvkatz .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#srjrvvkatz .gt_font_normal {
  font-weight: normal;
}

#srjrvvkatz .gt_font_bold {
  font-weight: bold;
}

#srjrvvkatz .gt_font_italic {
  font-style: italic;
}

#srjrvvkatz .gt_super {
  font-size: 65%;
}

#srjrvvkatz .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="srjrvvkatz" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">dem_win</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">region</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">.fitted</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">conf.low</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">conf.high</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">.resid</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_right">0</td>
      <td class="gt_row gt_left">West</td>
      <td class="gt_row gt_right">0.56</td>
      <td class="gt_row gt_right">0.54</td>
      <td class="gt_row gt_right">0.59</td>
      <td class="gt_row gt_right">-1.3</td>
    </tr>
<tr>
<td class="gt_row gt_right">0</td>
      <td class="gt_row gt_left">South</td>
      <td class="gt_row gt_right">0.50</td>
      <td class="gt_row gt_right">0.48</td>
      <td class="gt_row gt_right">0.51</td>
      <td class="gt_row gt_right">-1.2</td>
    </tr>
<tr>
<td class="gt_row gt_right">0</td>
      <td class="gt_row gt_left">South</td>
      <td class="gt_row gt_right">0.50</td>
      <td class="gt_row gt_right">0.48</td>
      <td class="gt_row gt_right">0.51</td>
      <td class="gt_row gt_right">-1.2</td>
    </tr>
<tr>
<td class="gt_row gt_right">1</td>
      <td class="gt_row gt_left">South</td>
      <td class="gt_row gt_right">0.50</td>
      <td class="gt_row gt_right">0.48</td>
      <td class="gt_row gt_right">0.51</td>
      <td class="gt_row gt_right">1.2</td>
    </tr>
<tr>
<td class="gt_row gt_right">1</td>
      <td class="gt_row gt_left">South</td>
      <td class="gt_row gt_right">0.50</td>
      <td class="gt_row gt_right">0.48</td>
      <td class="gt_row gt_right">0.51</td>
      <td class="gt_row gt_right">1.2</td>
    </tr>
<tr>
<td class="gt_row gt_right">1</td>
      <td class="gt_row gt_left">South</td>
      <td class="gt_row gt_right">0.50</td>
      <td class="gt_row gt_right">0.48</td>
      <td class="gt_row gt_right">0.51</td>
      <td class="gt_row gt_right">1.2</td>
    </tr>
<tr>
<td class="gt_row gt_right">0</td>
      <td class="gt_row gt_left">South</td>
      <td class="gt_row gt_right">0.50</td>
      <td class="gt_row gt_right">0.48</td>
      <td class="gt_row gt_right">0.51</td>
      <td class="gt_row gt_right">-1.2</td>
    </tr>
<tr>
<td class="gt_row gt_right">1</td>
      <td class="gt_row gt_left">South</td>
      <td class="gt_row gt_right">0.50</td>
      <td class="gt_row gt_right">0.48</td>
      <td class="gt_row gt_right">0.51</td>
      <td class="gt_row gt_right">1.2</td>
    </tr>
<tr>
<td class="gt_row gt_right">1</td>
      <td class="gt_row gt_left">South</td>
      <td class="gt_row gt_right">0.50</td>
      <td class="gt_row gt_right">0.48</td>
      <td class="gt_row gt_right">0.51</td>
      <td class="gt_row gt_right">1.2</td>
    </tr>
<tr>
<td class="gt_row gt_right">1</td>
      <td class="gt_row gt_left">South</td>
      <td class="gt_row gt_right">0.50</td>
      <td class="gt_row gt_right">0.48</td>
      <td class="gt_row gt_right">0.51</td>
      <td class="gt_row gt_right">1.2</td>
    </tr>
</tbody>
<tfoot class="gt_sourcenotes"><tr>
<td class="gt_sourcenote" colspan="6">Regression points (First 10 out of 4,201 district-years)</td>
    </tr></tfoot>
</table></div>
<p>Now each of the <code>.fitted</code> values is a <em>predicted probability</em> of a Democratic victory from our model for a particular district and the confidence intervals are confidence intervals around that predicted probability.</p>
<p>You may be wondering how to interpret the residuals. The residuals reported by <code>augment()</code> for a logistic regression are called <em>deviance residuals</em>. A deviance residual can be calculated for each observation using:</p>
<p><span class="math display">\[
\textrm{d}_i = 
\textrm{sign}(Y_i-\hat{p_i})\sqrt{-2 [ Y_i \text{log} \hat{p_i} + (1 - Y_i) \text{log} (1 - \hat{p_i}) ]}
\]</span></p>
<p>where <span class="math inline">\(Y_i\)</span> is the actual outcome and <span class="math inline">\(p_i\)</span> is the predicted probability from the logistic regression model.</p>
<p>The sum of the individual deviance residuals is referred to as the <strong>deviance</strong> or <strong>residual deviance</strong>. The deviance is used to assess the model. As the name suggests, a model with a small deviance is preferred.</p>
<p>However, you can also have <code>augment()</code> report residuals as differences between the observed outcome and the predicted probabilities by using <code>type.residuals = "pearson"</code>:</p>
<div class="sourceCode" id="cb948"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb948-1"><a href="discrete-response.html#cb948-1"></a>regression_points &lt;-<span class="st"> </span>house_region_model <span class="op">%&gt;%</span></span>
<span id="cb948-2"><a href="discrete-response.html#cb948-2"></a><span class="st">  </span><span class="kw">augment</span>(<span class="dt">se_fit =</span> <span class="ot">TRUE</span>,</span>
<span id="cb948-3"><a href="discrete-response.html#cb948-3"></a>          <span class="dt">type.predict =</span> <span class="st">"response"</span>,</span>
<span id="cb948-4"><a href="discrete-response.html#cb948-4"></a>          <span class="dt">type.residuals =</span> <span class="st">"pearson"</span>) <span class="op">%&gt;%</span></span>
<span id="cb948-5"><a href="discrete-response.html#cb948-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">conf.low =</span> .fitted <span class="op">-</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>.se.fit,</span>
<span id="cb948-6"><a href="discrete-response.html#cb948-6"></a>         <span class="dt">conf.high =</span> .fitted <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>.se.fit) <span class="op">%&gt;%</span></span>
<span id="cb948-7"><a href="discrete-response.html#cb948-7"></a><span class="st">  </span><span class="kw">select</span>(dem_win, region, .fitted, conf.low, conf.high, .resid)</span>
<span id="cb948-8"><a href="discrete-response.html#cb948-8"></a>regression_points</span></code></pre></div>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#uwcrsujnqm .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#uwcrsujnqm .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#uwcrsujnqm .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#uwcrsujnqm .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#uwcrsujnqm .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#uwcrsujnqm .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#uwcrsujnqm .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#uwcrsujnqm .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#uwcrsujnqm .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#uwcrsujnqm .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#uwcrsujnqm .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#uwcrsujnqm .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#uwcrsujnqm .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#uwcrsujnqm .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#uwcrsujnqm .gt_from_md > :first-child {
  margin-top: 0;
}

#uwcrsujnqm .gt_from_md > :last-child {
  margin-bottom: 0;
}

#uwcrsujnqm .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#uwcrsujnqm .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#uwcrsujnqm .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#uwcrsujnqm .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#uwcrsujnqm .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#uwcrsujnqm .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#uwcrsujnqm .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#uwcrsujnqm .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#uwcrsujnqm .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#uwcrsujnqm .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#uwcrsujnqm .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#uwcrsujnqm .gt_left {
  text-align: left;
}

#uwcrsujnqm .gt_center {
  text-align: center;
}

#uwcrsujnqm .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#uwcrsujnqm .gt_font_normal {
  font-weight: normal;
}

#uwcrsujnqm .gt_font_bold {
  font-weight: bold;
}

#uwcrsujnqm .gt_font_italic {
  font-style: italic;
}

#uwcrsujnqm .gt_super {
  font-size: 65%;
}

#uwcrsujnqm .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="uwcrsujnqm" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">dem_win</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">region</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">.fitted</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">conf.low</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">conf.high</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">.resid</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_right">0</td>
      <td class="gt_row gt_left">West</td>
      <td class="gt_row gt_right">0.56</td>
      <td class="gt_row gt_right">0.54</td>
      <td class="gt_row gt_right">0.59</td>
      <td class="gt_row gt_right">-1.14</td>
    </tr>
<tr>
<td class="gt_row gt_right">0</td>
      <td class="gt_row gt_left">South</td>
      <td class="gt_row gt_right">0.50</td>
      <td class="gt_row gt_right">0.48</td>
      <td class="gt_row gt_right">0.51</td>
      <td class="gt_row gt_right">-0.99</td>
    </tr>
<tr>
<td class="gt_row gt_right">0</td>
      <td class="gt_row gt_left">South</td>
      <td class="gt_row gt_right">0.50</td>
      <td class="gt_row gt_right">0.48</td>
      <td class="gt_row gt_right">0.51</td>
      <td class="gt_row gt_right">-0.99</td>
    </tr>
<tr>
<td class="gt_row gt_right">1</td>
      <td class="gt_row gt_left">South</td>
      <td class="gt_row gt_right">0.50</td>
      <td class="gt_row gt_right">0.48</td>
      <td class="gt_row gt_right">0.51</td>
      <td class="gt_row gt_right">1.01</td>
    </tr>
<tr>
<td class="gt_row gt_right">1</td>
      <td class="gt_row gt_left">South</td>
      <td class="gt_row gt_right">0.50</td>
      <td class="gt_row gt_right">0.48</td>
      <td class="gt_row gt_right">0.51</td>
      <td class="gt_row gt_right">1.01</td>
    </tr>
<tr>
<td class="gt_row gt_right">1</td>
      <td class="gt_row gt_left">South</td>
      <td class="gt_row gt_right">0.50</td>
      <td class="gt_row gt_right">0.48</td>
      <td class="gt_row gt_right">0.51</td>
      <td class="gt_row gt_right">1.01</td>
    </tr>
<tr>
<td class="gt_row gt_right">0</td>
      <td class="gt_row gt_left">South</td>
      <td class="gt_row gt_right">0.50</td>
      <td class="gt_row gt_right">0.48</td>
      <td class="gt_row gt_right">0.51</td>
      <td class="gt_row gt_right">-0.99</td>
    </tr>
<tr>
<td class="gt_row gt_right">1</td>
      <td class="gt_row gt_left">South</td>
      <td class="gt_row gt_right">0.50</td>
      <td class="gt_row gt_right">0.48</td>
      <td class="gt_row gt_right">0.51</td>
      <td class="gt_row gt_right">1.01</td>
    </tr>
<tr>
<td class="gt_row gt_right">1</td>
      <td class="gt_row gt_left">South</td>
      <td class="gt_row gt_right">0.50</td>
      <td class="gt_row gt_right">0.48</td>
      <td class="gt_row gt_right">0.51</td>
      <td class="gt_row gt_right">1.01</td>
    </tr>
<tr>
<td class="gt_row gt_right">1</td>
      <td class="gt_row gt_left">South</td>
      <td class="gt_row gt_right">0.50</td>
      <td class="gt_row gt_right">0.48</td>
      <td class="gt_row gt_right">0.51</td>
      <td class="gt_row gt_right">1.01</td>
    </tr>
</tbody>
<tfoot class="gt_sourcenotes"><tr>
<td class="gt_sourcenote" colspan="6">Regression points (First 10 out of 4,201 district-years)</td>
    </tr></tfoot>
</table></div>
<p>Now, the <code>.resid</code> value is the difference between the actual outcome (<code>dem_win</code>) and the predicted probability.</p>
</div>
<div id="one-numerical-explanatory-variable" class="section level3">
<h3>
<span class="header-section-number">12.1.5</span> One numerical explanatory variable</h3>
<p>We’ll now predict <code>dem_win</code> with a single numerical explanatory variable, <code>year</code>.</p>
<ol style="list-style-type: decimal">
<li>We first “fit” the logistic regression model using the <code>glm(y ~ x, family, data)</code> function and save it in <code>house_year_model</code>.</li>
<li>We get the regression table by applying the <code>tidy()</code> function from the <strong>broom</strong> package to <code>house_year_model</code>. We’ll print the <code>term</code>, <code>estimate</code>, <code>conf.low</code>, and <code>conf.high</code> columns.</li>
</ol>
<div class="sourceCode" id="cb949"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb949-1"><a href="discrete-response.html#cb949-1"></a>house_year_model &lt;-<span class="st"> </span><span class="kw">glm</span>(dem_win <span class="op">~</span><span class="st"> </span>year, <span class="dt">family =</span> binomial, <span class="dt">data =</span> house_ch12)</span>
<span id="cb949-2"><a href="discrete-response.html#cb949-2"></a>house_year_model <span class="op">%&gt;%</span></span>
<span id="cb949-3"><a href="discrete-response.html#cb949-3"></a><span class="st">  </span><span class="kw">tidy</span>(<span class="dt">conf.int =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb949-4"><a href="discrete-response.html#cb949-4"></a><span class="st">  </span><span class="kw">select</span>(term, estimate, conf.low, conf.high)</span></code></pre></div>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#pfgslkdwdk .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#pfgslkdwdk .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#pfgslkdwdk .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#pfgslkdwdk .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#pfgslkdwdk .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pfgslkdwdk .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#pfgslkdwdk .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#pfgslkdwdk .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#pfgslkdwdk .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#pfgslkdwdk .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#pfgslkdwdk .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#pfgslkdwdk .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#pfgslkdwdk .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#pfgslkdwdk .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#pfgslkdwdk .gt_from_md > :first-child {
  margin-top: 0;
}

#pfgslkdwdk .gt_from_md > :last-child {
  margin-bottom: 0;
}

#pfgslkdwdk .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#pfgslkdwdk .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#pfgslkdwdk .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#pfgslkdwdk .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#pfgslkdwdk .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#pfgslkdwdk .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#pfgslkdwdk .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pfgslkdwdk .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#pfgslkdwdk .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#pfgslkdwdk .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#pfgslkdwdk .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#pfgslkdwdk .gt_left {
  text-align: left;
}

#pfgslkdwdk .gt_center {
  text-align: center;
}

#pfgslkdwdk .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#pfgslkdwdk .gt_font_normal {
  font-weight: normal;
}

#pfgslkdwdk .gt_font_bold {
  font-weight: bold;
}

#pfgslkdwdk .gt_font_italic {
  font-style: italic;
}

#pfgslkdwdk .gt_super {
  font-size: 65%;
}

#pfgslkdwdk .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="pfgslkdwdk" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">term</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">estimate</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">conf.low</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">conf.high</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_left">(Intercept)</td>
      <td class="gt_row gt_right">34.487</td>
      <td class="gt_row gt_right">28.10</td>
      <td class="gt_row gt_right">40.888</td>
    </tr>
<tr>
<td class="gt_row gt_left">year</td>
      <td class="gt_row gt_right">-0.017</td>
      <td class="gt_row gt_right">-0.02</td>
      <td class="gt_row gt_right">-0.014</td>
    </tr>
</tbody>
<tfoot class="gt_sourcenotes"><tr>
<td class="gt_sourcenote" colspan="4">Logistical Regression Table</td>
    </tr></tfoot>
</table></div>
<p>How do we interpret the coefficients in this model? Since the <code>year</code> coefficient is negative, that means that each additional year is associated with a reduction in the chances of a Democratic victory.</p>
<p>If we wanted to learn the predicted probabilities for any given value of <code>year</code>, we can plug in our values of <code>year</code> into the standard logistic function, like so:</p>
<p><span class="math display">\[
p_{dem\_win} = \frac{1}{1 + e^{-(34.487 - 0.017 \times year)}} 
\]</span></p>
<p>Note that since this is not a linear function, a one-unit change in <code>year</code> will be associated with various one-unit changes in <code>dem_win</code>, depending on what <code>year</code> you are starting from. Recall the figure we used to start the chapter:</p>
<p><img src="book_temp_files/figure-html/unnamed-chunk-724-1.png" width="672"></p>
<p>A linear regression line (in blue) has a constant slope, which means that no matter what <span class="math inline">\(x\)</span> you start with, the effect of going from <span class="math inline">\(x\)</span> to <span class="math inline">\(x + 1\)</span> on <span class="math inline">\(y\)</span> is the same number.</p>
<p>However, take a look at the logistic regression curve (in red). The value of the slope for very high or very low values of <span class="math inline">\(x\)</span> is smaller (approaching 0 as <span class="math inline">\(x\)</span> tends to negative or positive infinity), while the slope in the middle of the curve is highest. The steepest part of the curve corresponds to that part of the curve where the predicted probability equals 0.5. That is, the effect of a one-unit change in <span class="math inline">\(x\)</span> is the highest when the predicted probability for that <span class="math inline">\(x\)</span> is close to 0.5 and smallest when the predicted probability for that <span class="math inline">\(x\)</span> is close to 0 or 1.</p>
<p>You can always use R to calculate the predicted probabilities for any value of <span class="math inline">\(x\)</span> and thus calculate the effect of moving from a particular <span class="math inline">\(x\)</span> to <span class="math inline">\(x + 1\)</span>. But this can get complicated. In particular, once you start employing logistic regression with multiple predictors, the effect of a one-unit change in a predictor <span class="math inline">\(x\)</span> depends not only on <span class="math inline">\(x\)</span>, but on the values of all the other predictors in your model! You can always plug in all the coefficients and values of your predictors into the logistic function to calculate predicted probabilities, but if you don’t do that, how can you interpret the coefficients?</p>
<p>Here is where we can use the <em>divide by 4 rule</em> that we discussed before. A logistic regression coefficient divided by 4 is the effect of that variable at the steepest part of the logistic regression curve, which, as we saw, corresponds to where the predicted probability is 0.5.</p>
<p>Therefore, you can divide a logistic regression coefficient by 4 to get an upper bound on the effect a one-unit change in that predictor will have on the predicted probability of your outcome. In this case, the approximation tells us that each additional year is associated with about a <span class="math inline">\(-0.004\)</span> decrease in the predicted probability of a Democratic victory. Since the predicted probability of a Democratic victory in this model never strays far from 0.5, this is a pretty good approximation.<label for="tufte-sn-17" class="margin-toggle sidenote-number">17</label><input type="checkbox" id="tufte-sn-17" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">17</span> Indeed, it is almost identical to the coefficient you would obtain in a linear regression–try it out!</span></p>
<p>While <code>house_region_model</code> and <code>house_year_model</code> both tell us something interesting, we could learn more with an <em>interaction model</em> that includes both of our predictors.</p>
</div>
<div id="one-numerical-and-one-categorical-explanatory-variable" class="section level3">
<h3>
<span class="header-section-number">12.1.6</span> One numerical and one categorical explanatory variable</h3>
<p>We’ll now predict <code>dem_win</code> with a two variable, <code>region</code> and <code>year</code>, as well as the interaction between the two</p>
<ol style="list-style-type: decimal">
<li>We first “fit” the logistic regression model using the <code>glm(y ~ x1 * x2, family, data)</code> function and save it in <code>house_interact_model</code>.</li>
<li>We get the regression table by applying the <code>tidy()</code> function from the <strong>broom</strong> package to <code>house_interact_model</code>. We’ll print the <code>term</code>, <code>estimate</code>, <code>conf.low</code>, and <code>conf.high</code> columns.</li>
</ol>
<div class="sourceCode" id="cb950"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb950-1"><a href="discrete-response.html#cb950-1"></a>house_interact_model &lt;-<span class="st"> </span><span class="kw">glm</span>(dem_win <span class="op">~</span><span class="st"> </span>region <span class="op">*</span><span class="st"> </span>year, <span class="dt">family =</span> binomial <span class="dt">data =</span> house_ch12)</span>
<span id="cb950-2"><a href="discrete-response.html#cb950-2"></a>house_interact_model <span class="op">%&gt;%</span></span>
<span id="cb950-3"><a href="discrete-response.html#cb950-3"></a><span class="st">  </span><span class="kw">tidy</span>(<span class="dt">conf.int =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb950-4"><a href="discrete-response.html#cb950-4"></a><span class="st">  </span><span class="kw">select</span>(term, estimate, conf.low, conf.high)</span></code></pre></div>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#vfsncsoicm .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#vfsncsoicm .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vfsncsoicm .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#vfsncsoicm .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#vfsncsoicm .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vfsncsoicm .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vfsncsoicm .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#vfsncsoicm .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#vfsncsoicm .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#vfsncsoicm .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#vfsncsoicm .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#vfsncsoicm .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#vfsncsoicm .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#vfsncsoicm .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#vfsncsoicm .gt_from_md > :first-child {
  margin-top: 0;
}

#vfsncsoicm .gt_from_md > :last-child {
  margin-bottom: 0;
}

#vfsncsoicm .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#vfsncsoicm .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#vfsncsoicm .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vfsncsoicm .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#vfsncsoicm .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vfsncsoicm .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#vfsncsoicm .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vfsncsoicm .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vfsncsoicm .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#vfsncsoicm .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vfsncsoicm .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#vfsncsoicm .gt_left {
  text-align: left;
}

#vfsncsoicm .gt_center {
  text-align: center;
}

#vfsncsoicm .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#vfsncsoicm .gt_font_normal {
  font-weight: normal;
}

#vfsncsoicm .gt_font_bold {
  font-weight: bold;
}

#vfsncsoicm .gt_font_italic {
  font-style: italic;
}

#vfsncsoicm .gt_super {
  font-size: 65%;
}

#vfsncsoicm .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="vfsncsoicm" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">term</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">estimate</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">conf.low</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">conf.high</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_left">(Intercept)</td>
      <td class="gt_row gt_right">36.395</td>
      <td class="gt_row gt_right">23.504</td>
      <td class="gt_row gt_right">49.361</td>
    </tr>
<tr>
<td class="gt_row gt_left">regionNortheast</td>
      <td class="gt_row gt_right">-56.548</td>
      <td class="gt_row gt_right">-76.099</td>
      <td class="gt_row gt_right">-37.066</td>
    </tr>
<tr>
<td class="gt_row gt_left">regionSouth</td>
      <td class="gt_row gt_right">61.388</td>
      <td class="gt_row gt_right">43.926</td>
      <td class="gt_row gt_right">78.877</td>
    </tr>
<tr>
<td class="gt_row gt_left">regionWest</td>
      <td class="gt_row gt_right">-51.520</td>
      <td class="gt_row gt_right">-70.633</td>
      <td class="gt_row gt_right">-32.457</td>
    </tr>
<tr>
<td class="gt_row gt_left">year</td>
      <td class="gt_row gt_right">-0.018</td>
      <td class="gt_row gt_right">-0.025</td>
      <td class="gt_row gt_right">-0.012</td>
    </tr>
<tr>
<td class="gt_row gt_left">regionNortheast:year</td>
      <td class="gt_row gt_right">0.029</td>
      <td class="gt_row gt_right">0.019</td>
      <td class="gt_row gt_right">0.038</td>
    </tr>
<tr>
<td class="gt_row gt_left">regionSouth:year</td>
      <td class="gt_row gt_right">-0.031</td>
      <td class="gt_row gt_right">-0.039</td>
      <td class="gt_row gt_right">-0.022</td>
    </tr>
<tr>
<td class="gt_row gt_left">regionWest:year</td>
      <td class="gt_row gt_right">0.026</td>
      <td class="gt_row gt_right">0.016</td>
      <td class="gt_row gt_right">0.036</td>
    </tr>
</tbody>
<tfoot class="gt_sourcenotes"><tr>
<td class="gt_sourcenote" colspan="4">Logistical Regression Table</td>
    </tr></tfoot>
</table></div>
<p>Now we can see how the effect of <code>year</code> varies by <code>region</code>. While the passage of time is associated with more Democratic victories in the Northeast and the West, <code>year</code> is associated with declining Democratic fortunes in the Midwest (<code>year</code>) and the South (<code>regionSouth:year</code>).</p>
<p>Looking at predicted probabilities can also put this model in perspective. Let’s use <code>augment()</code> to generate the predictions. Remember that <code>type.predict = "response"</code> and <code>type.residuals = "pearson"</code> put the fitted values and the residuals on the probability scale.</p>
<div class="sourceCode" id="cb951"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb951-1"><a href="discrete-response.html#cb951-1"></a>regression_points &lt;-<span class="st"> </span>house_interact_model <span class="op">%&gt;%</span></span>
<span id="cb951-2"><a href="discrete-response.html#cb951-2"></a><span class="st">  </span><span class="kw">augment</span>(<span class="dt">se_fit =</span> <span class="ot">TRUE</span>,</span>
<span id="cb951-3"><a href="discrete-response.html#cb951-3"></a>          <span class="dt">type.predict =</span> <span class="st">"response"</span>,</span>
<span id="cb951-4"><a href="discrete-response.html#cb951-4"></a>          <span class="dt">type.residuals =</span> <span class="st">"pearson"</span>) <span class="op">%&gt;%</span></span>
<span id="cb951-5"><a href="discrete-response.html#cb951-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">conf.low =</span> .fitted <span class="op">-</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>.se.fit,</span>
<span id="cb951-6"><a href="discrete-response.html#cb951-6"></a>         <span class="dt">conf.high =</span> .fitted <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>.se.fit) <span class="op">%&gt;%</span></span>
<span id="cb951-7"><a href="discrete-response.html#cb951-7"></a><span class="st">  </span><span class="kw">select</span>(dem_win, region, .fitted, conf.low, conf.high, .resid)</span>
<span id="cb951-8"><a href="discrete-response.html#cb951-8"></a>regression_points</span></code></pre></div>
<table class="table" style="font-size: 16px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-728">TABLE 12.2: </span>Regression points (First 10 out of 4,201 district-years)
</caption>
<thead><tr>
<th style="text-align:right;">
dem_win
</th>
<th style="text-align:left;">
region
</th>
<th style="text-align:right;">
.fitted
</th>
<th style="text-align:right;">
conf.low
</th>
<th style="text-align:right;">
conf.high
</th>
<th style="text-align:right;">
.resid
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
West
</td>
<td style="text-align:right;">
0.52
</td>
<td style="text-align:right;">
0.48
</td>
<td style="text-align:right;">
0.57
</td>
<td style="text-align:right;">
-1.04
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
South
</td>
<td style="text-align:right;">
0.74
</td>
<td style="text-align:right;">
0.71
</td>
<td style="text-align:right;">
0.77
</td>
<td style="text-align:right;">
-1.69
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
South
</td>
<td style="text-align:right;">
0.74
</td>
<td style="text-align:right;">
0.71
</td>
<td style="text-align:right;">
0.77
</td>
<td style="text-align:right;">
-1.69
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
South
</td>
<td style="text-align:right;">
0.74
</td>
<td style="text-align:right;">
0.71
</td>
<td style="text-align:right;">
0.77
</td>
<td style="text-align:right;">
0.59
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
South
</td>
<td style="text-align:right;">
0.74
</td>
<td style="text-align:right;">
0.71
</td>
<td style="text-align:right;">
0.77
</td>
<td style="text-align:right;">
0.59
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
South
</td>
<td style="text-align:right;">
0.74
</td>
<td style="text-align:right;">
0.71
</td>
<td style="text-align:right;">
0.77
</td>
<td style="text-align:right;">
0.59
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
South
</td>
<td style="text-align:right;">
0.74
</td>
<td style="text-align:right;">
0.71
</td>
<td style="text-align:right;">
0.77
</td>
<td style="text-align:right;">
-1.69
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
South
</td>
<td style="text-align:right;">
0.74
</td>
<td style="text-align:right;">
0.71
</td>
<td style="text-align:right;">
0.77
</td>
<td style="text-align:right;">
0.59
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
South
</td>
<td style="text-align:right;">
0.74
</td>
<td style="text-align:right;">
0.71
</td>
<td style="text-align:right;">
0.77
</td>
<td style="text-align:right;">
0.59
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
South
</td>
<td style="text-align:right;">
0.74
</td>
<td style="text-align:right;">
0.71
</td>
<td style="text-align:right;">
0.77
</td>
<td style="text-align:right;">
0.59
</td>
</tr>
</tbody>
</table>
<p>We can also use <code>augment</code> to make predictions for years that aren’t in our data. What would our model predict for the 2020 elections? We use the <code>newdata</code> argument in <code>augment()</code> to make these predictions.</p>
<div class="sourceCode" id="cb952"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb952-1"><a href="discrete-response.html#cb952-1"></a>house_interact_model <span class="op">%&gt;%</span></span>
<span id="cb952-2"><a href="discrete-response.html#cb952-2"></a><span class="st">  </span><span class="kw">augment</span>(<span class="dt">newdata =</span> <span class="kw">tibble</span>(<span class="dt">year =</span> <span class="kw">rep</span>(<span class="dv">2020</span>, <span class="dv">4</span>),</span>
<span id="cb952-3"><a href="discrete-response.html#cb952-3"></a>                           <span class="dt">region =</span> <span class="kw">c</span>(<span class="st">"Midwest"</span>, <span class="st">"Northeast"</span>, <span class="st">"South"</span>, <span class="st">"West"</span>)),</span>
<span id="cb952-4"><a href="discrete-response.html#cb952-4"></a>          <span class="dt">se_fit =</span> <span class="ot">TRUE</span>,</span>
<span id="cb952-5"><a href="discrete-response.html#cb952-5"></a>          <span class="dt">type.predict =</span> <span class="st">"response"</span>) <span class="op">%&gt;%</span></span>
<span id="cb952-6"><a href="discrete-response.html#cb952-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">conf.low =</span> .fitted <span class="op">-</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>.se.fit,</span>
<span id="cb952-7"><a href="discrete-response.html#cb952-7"></a>         <span class="dt">conf.high =</span> .fitted <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>.se.fit)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 6
##    year region    .fitted .se.fit conf.low conf.high
##   &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1  2020 Midwest     0.374  0.0211    0.332     0.416
## 2  2020 Northeast   0.697  0.0218    0.654     0.741
## 3  2020 South       0.248  0.0142    0.219     0.276
## 4  2020 West        0.605  0.0217    0.562     0.648</code></pre>
<p>These can easily be plotted using <code>ggplot()</code>:</p>
<div class="sourceCode" id="cb954"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb954-1"><a href="discrete-response.html#cb954-1"></a>house_interact_model <span class="op">%&gt;%</span></span>
<span id="cb954-2"><a href="discrete-response.html#cb954-2"></a><span class="st">  </span><span class="kw">augment</span>(<span class="dt">newdata =</span> <span class="kw">tibble</span>(<span class="dt">year =</span> <span class="kw">rep</span>(<span class="dv">2020</span>, <span class="dv">4</span>),</span>
<span id="cb954-3"><a href="discrete-response.html#cb954-3"></a>                           <span class="dt">region =</span> <span class="kw">c</span>(<span class="st">"Midwest"</span>, <span class="st">"Northeast"</span>, <span class="st">"South"</span>, <span class="st">"West"</span>)),</span>
<span id="cb954-4"><a href="discrete-response.html#cb954-4"></a>          <span class="dt">se_fit =</span> <span class="ot">TRUE</span>,</span>
<span id="cb954-5"><a href="discrete-response.html#cb954-5"></a>          <span class="dt">type.predict =</span> <span class="st">"response"</span>) <span class="op">%&gt;%</span></span>
<span id="cb954-6"><a href="discrete-response.html#cb954-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">conf.low =</span> .fitted <span class="op">-</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>.se.fit,</span>
<span id="cb954-7"><a href="discrete-response.html#cb954-7"></a>         <span class="dt">conf.high =</span> .fitted <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>.se.fit) <span class="op">%&gt;%</span></span>
<span id="cb954-8"><a href="discrete-response.html#cb954-8"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> .fitted,</span>
<span id="cb954-9"><a href="discrete-response.html#cb954-9"></a>             <span class="dt">ymin =</span> conf.low,</span>
<span id="cb954-10"><a href="discrete-response.html#cb954-10"></a>             <span class="dt">ymax =</span> conf.high,</span>
<span id="cb954-11"><a href="discrete-response.html#cb954-11"></a>             <span class="dt">x =</span> region)) <span class="op">+</span></span>
<span id="cb954-12"><a href="discrete-response.html#cb954-12"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb954-13"><a href="discrete-response.html#cb954-13"></a><span class="st">  </span><span class="kw">geom_errorbar</span>() <span class="op">+</span></span>
<span id="cb954-14"><a href="discrete-response.html#cb954-14"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">"Predicted probability of a Democratic victory (2020)"</span>,</span>
<span id="cb954-15"><a href="discrete-response.html#cb954-15"></a>       <span class="dt">x =</span> <span class="st">""</span>) <span class="op">+</span></span>
<span id="cb954-16"><a href="discrete-response.html#cb954-16"></a><span class="st">  </span><span class="kw">theme_classic</span>()</span></code></pre></div>
<p><img src="book_temp_files/figure-html/unnamed-chunk-730-1.png" width="672"></p>
<!-- Here is a great place to discuss unknown unknowns -->
</div>
<div id="fitting-many-models-using-map-1" class="section level3">
<h3>
<span class="header-section-number">12.1.7</span> Fitting many models using <code>map()</code>
</h3>
<p>While it is interesting to see how Democrats perform by region over time, it would also be interesting to see how each state has changed in its partisan voting from 1976–2018. Have any seen particularly large increases (or decreases) in the probability of a Democratic candidate winning?</p>
<p>The code to do this is very similar to the code we used for the gubernatorial forecasts in Chapter <a href="pitfalls.html#pitfalls">10</a> and the Seattle house prices in Chapter <a href="continuous-response.html#continuous-response">11</a>. However, we will use <code>glm()</code> instead of <code>lm()</code>.</p>
<p>First, we’ll filter to the states that have at least 50 district-years in the dataset. Next, let’s use <code>map()</code> to learn about these districts:</p>
<div class="sourceCode" id="cb955"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb955-1"><a href="discrete-response.html#cb955-1"></a>infreq_states &lt;-<span class="st"> </span>house_ch12 <span class="op">%&gt;%</span></span>
<span id="cb955-2"><a href="discrete-response.html#cb955-2"></a><span class="st">  </span><span class="kw">count</span>(state) <span class="op">%&gt;%</span></span>
<span id="cb955-3"><a href="discrete-response.html#cb955-3"></a><span class="st">  </span><span class="kw">filter</span>(n <span class="op">&lt;</span><span class="st"> </span><span class="dv">50</span>) <span class="op">%&gt;%</span></span>
<span id="cb955-4"><a href="discrete-response.html#cb955-4"></a><span class="st">  </span><span class="kw">pull</span>(state)</span>
<span id="cb955-5"><a href="discrete-response.html#cb955-5"></a></span>
<span id="cb955-6"><a href="discrete-response.html#cb955-6"></a>house_state_model &lt;-<span class="st"> </span>house_ch12 <span class="op">%&gt;%</span></span>
<span id="cb955-7"><a href="discrete-response.html#cb955-7"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="st"> </span>state <span class="op">%in%</span><span class="st">  </span>infreq_states) <span class="op">%&gt;%</span></span>
<span id="cb955-8"><a href="discrete-response.html#cb955-8"></a><span class="st">  </span><span class="kw">group_by</span>(state) <span class="op">%&gt;%</span></span>
<span id="cb955-9"><a href="discrete-response.html#cb955-9"></a><span class="st">  </span><span class="kw">nest</span>() <span class="op">%&gt;%</span></span>
<span id="cb955-10"><a href="discrete-response.html#cb955-10"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mod =</span> <span class="kw">map</span>(data, <span class="op">~</span><span class="st"> </span><span class="kw">glm</span>(dem_win <span class="op">~</span><span class="st"> </span>year, <span class="dt">family =</span> binomial, <span class="dt">data =</span> .)),</span>
<span id="cb955-11"><a href="discrete-response.html#cb955-11"></a>         <span class="dt">reg_results =</span> <span class="kw">map</span>(mod, <span class="op">~</span><span class="st"> </span><span class="kw">tidy</span>(., <span class="dt">conf.int =</span> <span class="ot">TRUE</span>)),</span>
<span id="cb955-12"><a href="discrete-response.html#cb955-12"></a>         <span class="dt">year_coef =</span> <span class="kw">map_dbl</span>(reg_results, <span class="op">~</span><span class="st"> </span><span class="kw">filter</span>(., term <span class="op">==</span><span class="st"> "year"</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(estimate)),</span>
<span id="cb955-13"><a href="discrete-response.html#cb955-13"></a>         <span class="dt">year_low =</span> <span class="kw">map_dbl</span>(reg_results, <span class="op">~</span><span class="st"> </span><span class="kw">filter</span>(., term <span class="op">==</span><span class="st"> "year"</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(conf.low)),</span>
<span id="cb955-14"><a href="discrete-response.html#cb955-14"></a>         <span class="dt">year_high =</span> <span class="kw">map_dbl</span>(reg_results, <span class="op">~</span><span class="st"> </span><span class="kw">filter</span>(., term <span class="op">==</span><span class="st"> "year"</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(conf.high)))</span>
<span id="cb955-15"><a href="discrete-response.html#cb955-15"></a></span>
<span id="cb955-16"><a href="discrete-response.html#cb955-16"></a><span class="kw">glimpse</span>(house_state_model)</span></code></pre></div>
<pre><code>## Rows: 38
## Columns: 7
## Groups: state [38]
## $ state       &lt;chr&gt; "Alabama", "Arkansas", "Arizona", "California", "Colorado…
## $ data        &lt;list&gt; [&lt;tbl_df[154 x 5]&gt;, &lt;tbl_df[88 x 5]&gt;, &lt;tbl_df[143 x 5]&gt;,…
## $ mod         &lt;list&gt; [&lt;134.362, -0.067, -3.9, -3.9, 1.4, 1.4, 1.4, -3.9, 1.4,…
## $ reg_results &lt;list&gt; [&lt;tbl_df[2 x 7]&gt;, &lt;tbl_df[2 x 7]&gt;, &lt;tbl_df[2 x 7]&gt;, &lt;tbl…
## $ year_coef   &lt;dbl&gt; -0.0675, -0.0554, 0.0208, 0.0167, -0.0027, 0.0472, -0.035…
## $ year_low    &lt;dbl&gt; -0.0981, -0.0938, -0.0071, 0.0068, -0.0295, 0.0152, -0.05…
## $ year_high   &lt;dbl&gt; -0.0392, -0.0202, 0.0498, 0.0266, 0.0241, 0.0819, -0.0208…</code></pre>
<p>The easiest way to see the results of these models is to plot the coefficients:</p>
<div class="sourceCode" id="cb957"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb957-1"><a href="discrete-response.html#cb957-1"></a>house_state_model <span class="op">%&gt;%</span></span>
<span id="cb957-2"><a href="discrete-response.html#cb957-2"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></span>
<span id="cb957-3"><a href="discrete-response.html#cb957-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">state =</span> <span class="kw">fct_reorder</span>(state, year_coef)) <span class="op">%&gt;%</span></span>
<span id="cb957-4"><a href="discrete-response.html#cb957-4"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> state, <span class="dt">y =</span> year_coef, <span class="dt">ymin =</span> year_low, <span class="dt">ymax =</span> year_high)) <span class="op">+</span></span>
<span id="cb957-5"><a href="discrete-response.html#cb957-5"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb957-6"><a href="discrete-response.html#cb957-6"></a><span class="st">  </span><span class="kw">geom_errorbar</span>() <span class="op">+</span></span>
<span id="cb957-7"><a href="discrete-response.html#cb957-7"></a><span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span></span>
<span id="cb957-8"><a href="discrete-response.html#cb957-8"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">""</span>,</span>
<span id="cb957-9"><a href="discrete-response.html#cb957-9"></a>       <span class="dt">y =</span> <span class="st">"Coefficients of </span><span class="ch">\"</span><span class="st">year</span><span class="ch">\"</span><span class="st">"</span>,</span>
<span id="cb957-10"><a href="discrete-response.html#cb957-10"></a>       <span class="dt">title =</span> <span class="st">"Predicting Democratic victories in the U.S. House over time by state"</span>,</span>
<span id="cb957-11"><a href="discrete-response.html#cb957-11"></a>       <span class="dt">subtitle =</span> <span class="st">"Logistic regression coefficients for year plotted by state"</span>) <span class="op">+</span></span>
<span id="cb957-12"><a href="discrete-response.html#cb957-12"></a><span class="st">  </span><span class="kw">coord_flip</span>()</span></code></pre></div>
<p><img src="book_temp_files/figure-html/unnamed-chunk-732-1.png" width="672"></p>
<p>Consistent with the account we saw when looking at the effect of <code>year</code> overall, there are more states where the odds of a Democratic victory have been decreasing by year than ones where they have been increasing.</p>
</div>
<div id="professional-models" class="section level3">
<h3>
<span class="header-section-number">12.1.8</span> Professional models</h3>
<p>So far, we have been fitting linear regressions and logistic regressions using <code>lm()</code> and <code>glm()</code>. While these functions are well-known and easy to use, what if we wanted to fit another model? We’d have to learn a new function, which may have new syntax. It’d be much easier if we could use the same syntax for every model we fit.</p>
<p>A collection of packages that helps address this issue is called <strong>tidymodels</strong>:</p>
<div class="sourceCode" id="cb958"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb958-1"><a href="discrete-response.html#cb958-1"></a><span class="kw">library</span>(tidymodels)</span></code></pre></div>
<p><strong>tidymodels</strong> includes many packages, but we’ll start by showing how to use <strong>parsnip</strong> to fit a logistic regression.</p>
<p>First, in the <strong>tidymodels</strong> workflow, we have to save the <em>model specification</em>. We do that using two functions: <code>logistic_reg()</code> and <code>set_engine()</code>.</p>
<div class="sourceCode" id="cb959"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb959-1"><a href="discrete-response.html#cb959-1"></a>logistic_mod &lt;-<span class="st"> </span><span class="kw">logistic_reg</span>() <span class="op">%&gt;%</span></span>
<span id="cb959-2"><a href="discrete-response.html#cb959-2"></a><span class="st">  </span><span class="kw">set_engine</span>(<span class="st">"glm"</span>)</span></code></pre></div>
<p><code>logistic_reg()</code> says that we want to fit a logistic regression, and <code>set_engine("glm")</code> specifies that we want to do it using <code>glm()</code>. Behind the scenes, <strong>parsnip</strong> uses many other packages to fit its models, but by unifying the syntax, it means that you don’t have to memorize how a lot of different functions work.</p>
<p>Note that our new object, <code>logistic_mod</code>, doesn’t contain our data or a formula. In order actually to fit our model, we need to feed <code>logistic_mod</code> to a function called <code>fit()</code>. <code>fit()</code> is the general purpose function in <strong>parsnip</strong> for fitting any model specification. It takes as its first argument the model specification, but otherwise it operates similarly to <code>lm()</code> and <code>glm()</code>:</p>
<div class="sourceCode" id="cb960"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb960-1"><a href="discrete-response.html#cb960-1"></a>logistic_fit &lt;-<span class="st"> </span><span class="kw">fit</span>(logistic_mod,</span>
<span id="cb960-2"><a href="discrete-response.html#cb960-2"></a>                    <span class="kw">factor</span>(dem_win) <span class="op">~</span><span class="st"> </span>region <span class="op">*</span><span class="st"> </span>year,</span>
<span id="cb960-3"><a href="discrete-response.html#cb960-3"></a>                    <span class="dt">data =</span> house_ch12)</span></code></pre></div>
<p>(We have to wrap <code>dem_win</code> in <code>factor()</code>, because <code>fit()</code> is more careful than <code>glm()</code> in requiring that classification models actually have categorical outcomes.)</p>
<p>One we have fit the model, how can we use it? The <code>glm</code> object is still stored in <code>logistic_fit$fit</code>, so we can access that and use <code>tidy()</code>, just like we did before:</p>
<div class="sourceCode" id="cb961"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb961-1"><a href="discrete-response.html#cb961-1"></a>logistic_fit<span class="op">$</span>fit <span class="op">%&gt;%</span></span>
<span id="cb961-2"><a href="discrete-response.html#cb961-2"></a><span class="st">  </span><span class="kw">tidy</span>(<span class="dt">conf.int =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb961-3"><a href="discrete-response.html#cb961-3"></a><span class="st">  </span><span class="kw">select</span>(term, estimate, conf.low, conf.high)</span></code></pre></div>
<pre><code>## # A tibble: 8 x 4
##   term                 estimate conf.low conf.high
##   &lt;chr&gt;                   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1 (Intercept)           36.4     23.5      49.4   
## 2 regionNortheast      -56.5    -76.1     -37.1   
## 3 regionSouth           61.4     43.9      78.9   
## 4 regionWest           -51.5    -70.6     -32.5   
## 5 year                  -0.0183  -0.0248   -0.0118
## 6 regionNortheast:year   0.0287   0.0189    0.0385
## 7 regionSouth:year      -0.0307  -0.0394   -0.0219
## 8 regionWest:year        0.0260   0.0164    0.0355</code></pre>
<p>As you can see, this generates the same results as when we used <code>glm()</code> directly.</p>
<p>We’ll use <strong>tidymodels</strong> when introducing CART and random forests in this chapter and machine learning in the next chapter. While the models will change, the basic code structure will be very similar to how we fit the logistic regression above.</p>
</div>
</div>
<div id="classification-and-regression-trees-cart" class="section level2">
<h2>
<span class="header-section-number">12.2</span> Classification and regression trees (CART)</h2>
<div id="what-is-cart" class="section level3">
<h3>
<span class="header-section-number">12.2.1</span> What is CART?</h3>
<p>We have learned how to fit models for binary responses using logistic regression. However, logistic regression is just one of many methods we can use to model binary responses. CART is another approach, which we’ll learn about in this section. In the next section, we’ll learn about random forests.</p>
<!-- Validity/model fitting the world. bias/variance  overfitting/underfitting. goal of the model -->
<p>A <strong>tree</strong> is basically a flow chart of yes or no questions. The general idea of the methods we are describing is to define an algorithm that uses data to create these trees with predictions at the ends, referred to as <em>nodes</em>. Decision trees predict an outcome variable <span class="math inline">\(Y\)</span> by <em>partitioning</em> the predictors.</p>
<p>Decision trees like this are often used in practice. For example, to decide on a person’s risk of poor outcome after having a heart attack, doctors use the following:</p>
<p><img src="12-discrete-response/images/Decision-Tree-for-Heart-Attack-Victim-adapted-from-Gigerenzer-et-al-1999-4.png" width="50%"></p>
<p>(Source: Walton 2010 Informal Logic, Vol. 30, No. 2, pp. 159-184<label for="tufte-sn-18" class="margin-toggle sidenote-number">18</label><input type="checkbox" id="tufte-sn-18" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">18</span> <a href="https://papers.ssrn.com/sol3/Delivery.cfm/SSRN_ID1759289_code1486039.pdf?abstractid=1759289&amp;mirid=1&amp;type=2" class="uri">https://papers.ssrn.com/sol3/Delivery.cfm/SSRN_ID1759289_code1486039.pdf?abstractid=1759289&amp;mirid=1&amp;type=2</a></span>.)</p>
<p>Here, the binary outcome is whether a patient is “High Risk” or “Low Risk.” We have three predictors: minimum systolic blood pressure over the initial 24-hour period, age, and presence of sinus tachycardia. The tree presents a series of yes or no questions that allow us to use the predictors to classify a patient’s risk level.</p>
<p><strong>Classification trees</strong>, or decision trees, are used in prediction problems where the outcome is categorical. (When the outcome is numerical, they are called <strong>regression trees</strong>; hence the acronym <strong>CART</strong>, standing for Classification and Regression Trees.) The general idea here is to build a decision tree and, at the end of each <em>node</em>, obtain a predictor <span class="math inline">\(\hat{y}\)</span>. A mathematical way to describe this is to say that we are partitioning the <em>predictor space</em> into <span class="math inline">\(J\)</span> non-overlapping regions, <span class="math inline">\(R_1, R_2, \ldots, R_J\)</span>, and then for any predictor <span class="math inline">\(x\)</span> that falls within region <span class="math inline">\(R_j\)</span>, we estimate <span class="math inline">\(f(x)\)</span> with the class that is the most common among the data within the partition for which the associated predictor <span class="math inline">\(x_i\)</span> is also in <span class="math inline">\(R_j\)</span>.</p>
<p>But how do we decide on which partitions to make (<span class="math inline">\(R_1, R_2, \ldots, R_J\)</span>) and how do we choose <span class="math inline">\(J\)</span>, the total number of partitions? Here is where the algorithm gets a bit complicated.</p>
<p>Classification trees create partitions recursively. We start the algorithm with one partition, the entire predictor space (i.e., every observation is classified as 0 or 1). But after the first step we will have two partitions. After the second step we will split one of these partitions into two and will have three partitions, then four, then five, and so on. (We will describe how we decide when to stop later.)</p>
<p>Once we select a partition <span class="math inline">\(\mathbf{x}\)</span> to split in order to create the new partitions, we find a predictor <span class="math inline">\(j\)</span> and value <span class="math inline">\(s\)</span> that define two new partitions, which we will call <span class="math inline">\(R_1(j,s)\)</span> and <span class="math inline">\(R_2(j,s)\)</span>, that split our observations in the current partition by asking if <span class="math inline">\(x_j\)</span> is bigger than <span class="math inline">\(s\)</span> (or if <span class="math inline">\(x_j\)</span> falls into a particular category <span class="math inline">\(s\)</span>, if the predictor <span class="math inline">\(j\)</span> is categorical):</p>
<p><span class="math display">\[
R_1(j,s) = \{\mathbf{x} \mid x_j &lt; s\} \mbox{  and  } R_2(j,s) = \{\mathbf{x} \mid x_j \geq s\}
\]</span></p>
<p>Now, after we define the new partitions <span class="math inline">\(R_1\)</span> and <span class="math inline">\(R_2\)</span>, and we decide to stop the partitioning process, we compute predictors by taking the most common category of all the observations <span class="math inline">\(y\)</span> for which the associated <span class="math inline">\(\mathbf{x}\)</span> is in <span class="math inline">\(R_1\)</span> and <span class="math inline">\(R_2\)</span>. We refer to these two as <span class="math inline">\(\hat{y}_{R_1}\)</span> and <span class="math inline">\(\hat{y}_{R_2}\)</span> respectively.</p>
<p>But how do we pick the predictor <span class="math inline">\(j\)</span> and the value <span class="math inline">\(s\)</span>? One of the more popular ways for categorical data is the <em>Gini Index</em>.</p>
<p>In a perfect scenario, the outcomes in each of our partitions are all of the same category since this will permit perfect accuracy. The <em>Gini Index</em> is going to be 0 in this scenario, and become larger the more we deviate from this scenario. To define the Gini Index, we define <span class="math inline">\(\hat{p}_{j,k}\)</span> as the proportion of observations in partition <span class="math inline">\(j\)</span> that are of class <span class="math inline">\(k\)</span>. The Gini Index is defined as</p>
<p><span class="math display">\[
\mbox{Gini}(j) = \sum_{k=1}^K \hat{p}_{j,k}(1-\hat{p}_{j,k})
\]</span></p>
<p>If you study the formula carefully you will see that it is in fact 0 in the perfect scenario described above, since <span class="math inline">\(\hat{p}_{j,k}(1-\hat{p}_{j,k}) = 0\)</span> for all <span class="math inline">\(k\)</span>.</p>
<p>Once we are done partitioning the predictor space into regions, in each region a prediction is made using the observations in that region.</p>
<p>But when do we stop partitioning? Every time we split and define two new partitions, the Gini Index improves. This is because with more partitions, our model has more flexibility to adapt to our data. However, our model may therefore perform worse when exposed to new data (this problem is called <em>overfitting</em>). This connects to our discussion of validity and models, as the conditions used to create the model will be too specific to accurately extrapolate to new data points. To avoid this, the algorithm sets a minimum for how much the Gini Index must improve for another partition to be added. This parameter is referred to as the <em>complexity parameter</em> (<span class="math inline">\(c_p\)</span>). The measure of fit must improve by a factor of <span class="math inline">\(c_p\)</span> for the new partition to be added. Large values of <span class="math inline">\(c_p\)</span> will therefore force the algorithm to stop earlier which results in fewer nodes.</p>
<!-- MB: Use overfitting to discuss validity/model fitting the world-->
<p>Classification trees have certain advantages that make them very useful. They are highly interpretable, even more so than linear models. They are easy to visualize (if small enough). Finally, they can model human decision processes. However, in terms of accuracy, they are rarely the best performing method since they are not very flexible. Random forests, explained in the next section, improve on some of the shortcomings of classification trees.</p>
</div>
<div id="one-categorical-explanatory-variable-1" class="section level3">
<h3>
<span class="header-section-number">12.2.2</span> One categorical explanatory variable</h3>
<p>To create classification trees, we’ll use the <code>decision_tree()</code> model specification and the <code>"rpart"</code> engine. The syntax is very similar to when we used <code>logistic_reg()</code>. Note that our binary response variable has to be a factor, just like with <code>logistic_reg()</code>.</p>
<div class="sourceCode" id="cb963"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb963-1"><a href="discrete-response.html#cb963-1"></a>tree_mod &lt;-<span class="st"> </span><span class="kw">decision_tree</span>() <span class="op">%&gt;%</span></span>
<span id="cb963-2"><a href="discrete-response.html#cb963-2"></a><span class="st">  </span><span class="kw">set_engine</span>(<span class="st">"rpart"</span>,</span>
<span id="cb963-3"><a href="discrete-response.html#cb963-3"></a>             <span class="dt">model =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb963-4"><a href="discrete-response.html#cb963-4"></a><span class="st">  </span><span class="kw">set_mode</span>(<span class="st">"classification"</span>)</span></code></pre></div>
<p>(Note that we added the argument <code>model = TRUE</code> to <code>set_engine()</code>. This saves the model frame, which we will need to avoid a warning when we plot the trees later.)</p>
<p>The function <code>set_mode()</code> wasn’t necessary when we did logistic regression. Here it clarifies that we want a <em>classification</em> tree rather than a <em>regression</em> tree.</p>
<p>Now that we have the object <code>tree_mod</code>, we can use <code>fit()</code> in the <strong>parsnip</strong> package. We’ll start by predicting <code>dem_win</code> with <code>region</code>:</p>
<div class="sourceCode" id="cb964"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb964-1"><a href="discrete-response.html#cb964-1"></a>house_region_tree &lt;-<span class="st"> </span><span class="kw">fit</span>(tree_mod,</span>
<span id="cb964-2"><a href="discrete-response.html#cb964-2"></a>                         <span class="kw">factor</span>(dem_win) <span class="op">~</span><span class="st"> </span>region, </span>
<span id="cb964-3"><a href="discrete-response.html#cb964-3"></a>                         <span class="dt">data =</span> house_ch12)</span></code></pre></div>
<p>See how when using <strong>tidymodels</strong>, this is exactly the same as how we would fit a logistic regression, but with our model specification saved in <code>tree_mod</code> rather than the model specification we saved in <code>logistic_fit</code>.</p>
<p>What was the result of our tree?</p>
<div class="sourceCode" id="cb965"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb965-1"><a href="discrete-response.html#cb965-1"></a>house_region_tree</span></code></pre></div>
<pre><code>## parsnip model object
## 
## Fit time:  29ms 
## n= 9557 
## 
## node), split, n, loss, yval, (yprob)
##       * denotes terminal node
## 
## 1) root 9557 4400 1 (0.46 0.54)  
##   2) region=Midwest,South 5589 2700 0 (0.51 0.49) *
##   3) region=Northeast,West 3968 1600 1 (0.40 0.60) *</code></pre>
<p>It’s not especially helpful to look at the results of a tree as text. In order to visualize the tree, we’ll use the <code>prp()</code> function in the <strong>rpart.plot</strong> package. Remember that the model object is stored in <code>house_region_tree$fit</code>.</p>
<div class="sourceCode" id="cb967"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb967-1"><a href="discrete-response.html#cb967-1"></a><span class="kw">library</span>(rpart.plot)</span>
<span id="cb967-2"><a href="discrete-response.html#cb967-2"></a></span>
<span id="cb967-3"><a href="discrete-response.html#cb967-3"></a>house_region_tree<span class="op">$</span>fit <span class="op">%&gt;%</span></span>
<span id="cb967-4"><a href="discrete-response.html#cb967-4"></a><span class="st">  </span><span class="kw">prp</span>(<span class="dt">extra =</span> <span class="dv">6</span>, <span class="dt">varlen =</span> <span class="dv">0</span>, <span class="dt">faclen =</span> <span class="dv">0</span>)</span></code></pre></div>
<p><img src="book_temp_files/figure-html/unnamed-chunk-741-1.png" width="672"></p>
<p>The arguments <code>varlen = 0</code> and <code>faclen = 0</code> ensure that the full variable names and factor levels are printed. The argument <code>extra = 6</code> shows the proportion of “yes” outcomes within a given partition. Since we’ll be using these same arguments throughout the chapter, we’ll create a new function that calls <code>prp()</code> but with these options as defaults:</p>
<div class="sourceCode" id="cb968"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb968-1"><a href="discrete-response.html#cb968-1"></a>prp_ch13 &lt;-<span class="st"> </span><span class="cf">function</span>(x, ...) <span class="kw">prp</span>(x, <span class="dt">extra =</span> <span class="dv">6</span>, <span class="dt">varlen =</span> <span class="dv">0</span>, <span class="dt">faclen =</span> <span class="dv">0</span>, ...)</span>
<span id="cb968-2"><a href="discrete-response.html#cb968-2"></a></span>
<span id="cb968-3"><a href="discrete-response.html#cb968-3"></a>house_region_tree<span class="op">$</span>fit <span class="op">%&gt;%</span></span>
<span id="cb968-4"><a href="discrete-response.html#cb968-4"></a><span class="st">  </span><span class="kw">prp_ch13</span>()</span></code></pre></div>
<p><img src="book_temp_files/figure-html/unnamed-chunk-742-1.png" width="672"></p>
<p>How do we interpret this tree? Here we have two partitions, based on whether an observation is in the Midwest or South or not in the Midwest or South (i.e., in the Northeast or West). If an observation is in the Midwest or South, the tree classifies the observation as a 0, a Democratic loss. The “0.49” means that 49% of the observations in this node were Democratic wins. If an observation is not in the Midwest or South, the algorithm classifies the observation as a 1, a Democratic win; 60% of the observations in this node were Democratic wins.</p>
<p>As you can see, the algorithm is very simple when you have one categorical explanatory variable: it just classifies every observation based on the most common response per category. Take a look at the following table:</p>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<table>
<thead><tr>
<th style="text-align:left;">
Region
</th>
<th style="text-align:right;">
Democratic Win Percentage
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Midwest
</td>
<td style="text-align:right;">
48
</td>
</tr>
<tr>
<td style="text-align:left;">
Northeast
</td>
<td style="text-align:right;">
64
</td>
</tr>
<tr>
<td style="text-align:left;">
South
</td>
<td style="text-align:right;">
50
</td>
</tr>
<tr>
<td style="text-align:left;">
West
</td>
<td style="text-align:right;">
56
</td>
</tr>
</tbody>
</table>
<p>The two partitions just divide the observations by region into a) those regions where Democrats won a majority of the elections in the data and b) those where they lost a majority of the elections.</p>
</div>
<div id="one-numerical-explanatory-variable-1" class="section level3">
<h3>
<span class="header-section-number">12.2.3</span> One numerical explanatory variable</h3>
<p>Once we have created our model specification <code>tree_mod</code>, it is easy to use it to fit new models with different formulae and data. We can use the same approach to create a classification tree predicting <code>dem_win</code> with <code>year</code>:</p>
<div class="sourceCode" id="cb970"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb970-1"><a href="discrete-response.html#cb970-1"></a>house_year_tree &lt;-<span class="st"> </span><span class="kw">fit</span>(tree_mod,</span>
<span id="cb970-2"><a href="discrete-response.html#cb970-2"></a>                       <span class="kw">factor</span>(dem_win) <span class="op">~</span><span class="st"> </span>year,</span>
<span id="cb970-3"><a href="discrete-response.html#cb970-3"></a>                       <span class="dt">data =</span> house_ch12)</span>
<span id="cb970-4"><a href="discrete-response.html#cb970-4"></a></span>
<span id="cb970-5"><a href="discrete-response.html#cb970-5"></a>house_year_tree<span class="op">$</span>fit <span class="op">%&gt;%</span></span>
<span id="cb970-6"><a href="discrete-response.html#cb970-6"></a><span class="st">  </span><span class="kw">prp_ch13</span>()</span></code></pre></div>
<p><img src="book_temp_files/figure-html/unnamed-chunk-744-1.png" width="672"></p>
<p>Now, the algorithm creates cutpoints in the <code>year</code> variable in order to classify observations. This tree will classify observations before 1993 (the 1992 election cycle or earlier, since House elections only occur in even-numbered years) or between 2005 and 2009 (the 2006 and 2008 cycles) as Democratic victories and all other observations as Democratic losses.</p>
<p>Eagle-eyed observers will notice that this is simply classifying every year based on whether the Democrats won a majority in that year, with one exception — observations in 2018 are predicted to be Democratic losses. Why is that? Recall that the algorithm uses a <em>complexity parameter</em>, <span class="math inline">\(c_p\)</span>, to avoid overfitting. The default value of <span class="math inline">\(c_p\)</span> in <code>rpart()</code> (the engine we are using) is 0.01; setting it to 0 allows one to see the maximum number of partitions that the algorithm will do.</p>
<p>How can we change <span class="math inline">\(c_p\)</span>? We don’t need to create an entirely new model specification. Rather, we can use the <code>update()</code> function to change <span class="math inline">\(c_p\)</span> while leaving everything else about <code>tree_mod</code> the same. All we need to do is specify the parameter we want to change, which here is called <code>cost_complexity</code>:</p>
<div class="sourceCode" id="cb971"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb971-1"><a href="discrete-response.html#cb971-1"></a>house_year_tree_<span class="dv">0</span> &lt;-<span class="st"> </span><span class="kw">fit</span>(<span class="kw">update</span>(tree_mod, <span class="dt">cost_complexity =</span> <span class="dv">0</span>),</span>
<span id="cb971-2"><a href="discrete-response.html#cb971-2"></a>                         <span class="kw">factor</span>(dem_win) <span class="op">~</span><span class="st"> </span>year,</span>
<span id="cb971-3"><a href="discrete-response.html#cb971-3"></a>                         <span class="dt">data =</span> house_ch12)</span></code></pre></div>
<p>We can then look at the new tree and see what changed:</p>
<div class="sourceCode" id="cb972"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb972-1"><a href="discrete-response.html#cb972-1"></a>house_year_tree_<span class="dv">0</span><span class="op">$</span>fit <span class="op">%&gt;%</span></span>
<span id="cb972-2"><a href="discrete-response.html#cb972-2"></a><span class="st">  </span><span class="kw">prp_ch13</span>()</span></code></pre></div>
<p><img src="book_temp_files/figure-html/unnamed-chunk-746-1.png" width="672"></p>
<p>Now there is an additional partition that classifies observations where <code>year</code> <span class="math inline">\(\geq 2017\)</span> as 1.</p>
<p>But which tree is better? We can answer that question using the <code>tune_grid()</code> function in the <strong>tune</strong> package, included as part of <strong>tidymodels</strong>. But for now, we’ll rely on the default value of <span class="math inline">\(c_p\)</span>, keeping in mind that changing that value could change the tree.</p>
<!-- AR: material below commented out; can be deleted unless it may be
repurposed for a discussion of the tune package at another time -->
<!-- The basic idea is that we want to test out various values of $c_p$. and select the model that performs best.  We will provide code on how to decide which model is best by calculating the accuracy on 25 bootstrapped samples of our data.  (We wouldn't want to calculate the accuracy on our full data, because a lower value of $c_p$ will always perform best on any particular dataset, but the resulting model may not perform well on out-of-sample observations; this is an example of a general phenomenon called *overfitting*.)

First, we need to update the model specification to note that we are tuning the `cost_complexity` parameter.  We can do that using the `update()` function and setting `cost_complexity = tune()`:


```r
tree_mod_tune <- tree_mod %>%
  update(cost_complexity = tune())
```

Next, we need to create our bootstrapped data.  We can do that using **tidymodels** with the `bootstraps()` function in the **rsample** package.  We will first call `set.seed()` in order to make sure our results are replicable, given the random nature of the bootstrap process.


```r
set.seed(12345)
house_boots <- bootstraps(house_ch12)
```

By default, the `bootstraps()` function generates 25 samples.  You can modify this with the `times` argument.

Next, we must set the values of `cost_complexity` that we will test.  We can select random values using the `grid_random()` function; by default, it selects 5, although you can adjust that with the `size` option.  We'll save the result in `cost_grid`.


```r
cost_grid <- grid_random(cost_complexity())
cost_grid
```

```
## # A tibble: 5 x 1
##   cost_complexity
##             <dbl>
## 1       0.000199 
## 2       0.0000668
## 3       0.00504  
## 4       0.00734  
## 5       0.00133
```

Now we have the elements necessary to run `tune_grid`.  The key arguments are our formula (here, `factor(dem_win) ~ year`), the `model` (`tree_mod_tune`), the `resamples` (`house_boots`), and the grid (`cost_grid`).  We'll save the result as `tree_res`:


```r
tree_res <- tune_grid(factor(dem_win) ~ year,
                      model = tree_mod_tune,
                      resamples = house_boots,
                      grid = cost_grid)
```

```
## Warning: `tune_grid.formula()` is deprecated as of lifecycle 0.1.0.
## The first argument to `tune_grid()` should be either a model or a workflow. In the future, you can use:
## tune_grid(tree_mod_tune, factor(dem_win) ~ year, resamples = house_boots, 
##     grid = cost_grid)
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_warnings()` to see where this warning was generated.
```

Now we need to know what value of `cost_complexity` performed the best.  For this, we use the function `select_best()`. We need to supply an argument called `metric` to `select_best()`; for this example, we'll choose `"accuracy"`, which is just the percentage of observations correctly classified.


```r
best_cost <- select_best(tree_res, metric = "accuracy")
best_cost
```

```
## # A tibble: 1 x 1
##   cost_complexity
##             <dbl>
## 1        0.000199
```

We can see from the output that 1.99\times 10^{-4} performed best on our bootstrap samples. We can visualize these results using `autoplot()`:


```r
autoplot(tree_res, metric = "accuracy")
```

<img src="book_temp_files/figure-html/unnamed-chunk-752-1.png" width="672"  />

All we have left to do is to `update()` our model specification based on `best_cost` and fit the results:


```r
house_year_tree_best <- fit(update(tree_mod, cost_complexity = best_cost),
                       factor(dem_win) ~ year,
                       data = house_ch12)
```

Let's look at the tree, saved in `house_year_tree_best$fit`:


```r
house_year_tree_best$fit %>%
  prp_ch13()
```

<img src="book_temp_files/figure-html/unnamed-chunk-754-1.png" width="672"  />

With the value of `cost_complexity` chosen by `tune_grid()`, we retain the partition based on `year < 2017`.-->
</div>
<div id="multiple-explanatory-variables" class="section level3">
<h3>
<span class="header-section-number">12.2.4</span> Multiple explanatory variables</h3>
<p>What if we wanted to predict <code>dem_win</code> based on <code>region</code> and <code>year</code>? The process is similar to what we’ve seen before. We’ll fit a new model called <code>region_year_tree</code> using our model specification <code>tree_mod</code>.</p>
<div class="sourceCode" id="cb973"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb973-1"><a href="discrete-response.html#cb973-1"></a>region_year_tree &lt;-<span class="st"> </span><span class="kw">fit</span>(tree_mod,</span>
<span id="cb973-2"><a href="discrete-response.html#cb973-2"></a>                        <span class="kw">factor</span>(dem_win) <span class="op">~</span><span class="st"> </span>region <span class="op">+</span><span class="st"> </span>year,</span>
<span id="cb973-3"><a href="discrete-response.html#cb973-3"></a>                        <span class="dt">data =</span> house_ch12)</span>
<span id="cb973-4"><a href="discrete-response.html#cb973-4"></a></span>
<span id="cb973-5"><a href="discrete-response.html#cb973-5"></a>region_year_tree<span class="op">$</span>fit <span class="op">%&gt;%</span></span>
<span id="cb973-6"><a href="discrete-response.html#cb973-6"></a><span class="st">  </span><span class="kw">prp_ch13</span>()</span></code></pre></div>
<p><img src="book_temp_files/figure-html/unnamed-chunk-755-1.png" width="672"></p>
<p>This tree classifies observations in the Northeast and West as a Democratic win and observations in the Midwest and South as a Democratic win before 1993 and a Democratic loss afterward.</p>
<p>In the section on logistic regression, we used <code>map()</code> to fit many models to visualize the effect of <code>year</code> by <code>state</code>. When fitting classification trees, it is easy just to add <code>state</code> as a predictor and allow the complexity parameter to determine whether we ought to partition further states by <code>year</code>. In fact, unlike with <code>lm()</code> and <code>glm()</code>, we can include both <code>region</code> and <code>state</code> in the model, and the algorithm will decide whether it wants to use the additional information provided by <code>state</code> or just create partitions based on <code>region</code>. Let’s take a look:</p>
<div class="sourceCode" id="cb974"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb974-1"><a href="discrete-response.html#cb974-1"></a>state_year_tree &lt;-<span class="st"> </span><span class="kw">fit</span>(tree_mod,</span>
<span id="cb974-2"><a href="discrete-response.html#cb974-2"></a>                       <span class="kw">factor</span>(dem_win) <span class="op">~</span><span class="st"> </span>region <span class="op">+</span><span class="st"> </span>state <span class="op">+</span><span class="st"> </span>year,</span>
<span id="cb974-3"><a href="discrete-response.html#cb974-3"></a>                       <span class="dt">data =</span> house_ch12)</span>
<span id="cb974-4"><a href="discrete-response.html#cb974-4"></a></span>
<span id="cb974-5"><a href="discrete-response.html#cb974-5"></a>state_year_tree<span class="op">$</span>fit <span class="op">%&gt;%</span></span>
<span id="cb974-6"><a href="discrete-response.html#cb974-6"></a><span class="st">  </span><span class="kw">prp_ch13</span>()</span></code></pre></div>
<p><img src="book_temp_files/figure-html/unnamed-chunk-756-1.png" width="672"></p>
<p>Unfortunately, this is very difficult to read, since <code>prp()</code> tries to plot all the state names on one line. The <a href="http://www.milbo.org/doc/prp.pdf">documentation</a> gives example code on how to wrap the factor labels across multiple lines, which we will adapt:</p>
<div class="sourceCode" id="cb975"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb975-1"><a href="discrete-response.html#cb975-1"></a>split.fun &lt;-<span class="st"> </span><span class="cf">function</span>(x, labs, digits, varlen, faclen) {</span>
<span id="cb975-2"><a href="discrete-response.html#cb975-2"></a>  </span>
<span id="cb975-3"><a href="discrete-response.html#cb975-3"></a>  <span class="co"># Replace commas with spaces (needed for strwrap)</span></span>
<span id="cb975-4"><a href="discrete-response.html#cb975-4"></a>  </span>
<span id="cb975-5"><a href="discrete-response.html#cb975-5"></a>  labs &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">","</span>, <span class="st">" "</span>, labs)</span>
<span id="cb975-6"><a href="discrete-response.html#cb975-6"></a>  </span>
<span id="cb975-7"><a href="discrete-response.html#cb975-7"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(labs)) {</span>
<span id="cb975-8"><a href="discrete-response.html#cb975-8"></a>    </span>
<span id="cb975-9"><a href="discrete-response.html#cb975-9"></a>    <span class="co"># Split labs[i] into multiple lines</span></span>
<span id="cb975-10"><a href="discrete-response.html#cb975-10"></a>    </span>
<span id="cb975-11"><a href="discrete-response.html#cb975-11"></a>    labs[i] &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="kw">strwrap</span>(labs[i], <span class="dt">width =</span> <span class="dv">50</span>), <span class="dt">collapse =</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb975-12"><a href="discrete-response.html#cb975-12"></a>  }</span>
<span id="cb975-13"><a href="discrete-response.html#cb975-13"></a>  </span>
<span id="cb975-14"><a href="discrete-response.html#cb975-14"></a>  labs</span>
<span id="cb975-15"><a href="discrete-response.html#cb975-15"></a>}</span></code></pre></div>
<p>Now we need to apply <code>split.fun</code> to <code>prp()</code>; we’ll also set <code>faclen = 2</code> in order to abbreviate the state names:</p>
<div class="sourceCode" id="cb976"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb976-1"><a href="discrete-response.html#cb976-1"></a>state_year_tree<span class="op">$</span>fit <span class="op">%&gt;%</span></span>
<span id="cb976-2"><a href="discrete-response.html#cb976-2"></a><span class="st">  </span><span class="kw">prp</span>(<span class="dt">split.fun =</span> split.fun,</span>
<span id="cb976-3"><a href="discrete-response.html#cb976-3"></a>      <span class="dt">faclen =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="book_temp_files/figure-html/unnamed-chunk-758-1.png" width="672"></p>
<p>This experience shows a tradeoff when working with decision trees: as they get more complex, they become more accurate but also harder to read.</p>
</div>
</div>
<div id="random-forests" class="section level2">
<h2>
<span class="header-section-number">12.3</span> Random forests</h2>
<div id="what-are-random-forests" class="section level3">
<h3>
<span class="header-section-number">12.3.1</span> What are random forests?</h3>
<p>Random forests are a <strong>very popular</strong> machine learning approach that addresses the shortcomings of decision trees using a clever idea. The goal is to improve prediction performance and reduce instability by <em>averaging</em> multiple decision trees (a forest of trees constructed with randomness). It has two features that help accomplish this.</p>
<p>The first step is <em>bootstrap aggregation</em> or <em>bagging</em>. The general idea is to generate many predictors, each using classification trees, and then forming a final prediction based on the average prediction of all these trees. To assure that the individual trees are not the same, we use the bootstrap to induce randomness. These two features combined explain the name: the bootstrap makes the individual trees <strong>randomly</strong> different, and the combination of trees is the <strong>forest</strong>. The specific steps are as follows.</p>
<!-- AR: do we explain training set/test set before this? -->
<p>1. Build <span class="math inline">\(B\)</span> decision trees using the training set. We refer to the fitted models as <span class="math inline">\(T_1, T_2, \dots, T_B\)</span>. We later explain how we ensure they are different.</p>
<p>2. For every observation in the test set, form a prediction <span class="math inline">\(\hat{y}_j\)</span> using tree <span class="math inline">\(T_j\)</span>.</p>
<p>3. For categorical data classification, predict <span class="math inline">\(\hat{y}\)</span> with majority vote (most frequent class among <span class="math inline">\(\hat{y}_1, \dots, \hat{y}_T\)</span>).</p>
<p>So how do we get different decision trees from a single training set? For this, we use randomness in two ways which we explain in the steps below. Let <span class="math inline">\(N\)</span> be the number of observations in the training set. To create <span class="math inline">\(T_j, \, j=1,\ldots,B\)</span> from the training set we do the following:</p>
<p>1. Create a bootstrap training set by sampling <span class="math inline">\(N\)</span> observations from the training set <strong>with replacement</strong>. This is the first way to induce randomness.</p>
<p>2. A large number of features is typical in machine learning challenges. Often, many features can be informative but including them all in the model may result in overfitting. The second way random forests induce randomness is by randomly selecting features to be included in the building of each tree. A different random subset is selected for each tree. This reduces correlation between trees in the forest, thereby improving prediction accuracy.</p>
</div>
<div id="fitting-random-forests" class="section level3">
<h3>
<span class="header-section-number">12.3.2</span> Fitting random forests</h3>
<p>We will demonstrate by fitting a random forest to the House elections data, predicting <code>dem_win</code> with <code>region</code>, <code>state</code>, and <code>year</code>. We will use the <code>rand_forest()</code> function to create our model specification, setting the engine to <code>"randomForest"</code> and the mode to <code>"classification"</code>.</p>
<div class="sourceCode" id="cb977"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb977-1"><a href="discrete-response.html#cb977-1"></a>forest_mod &lt;-<span class="st"> </span><span class="kw">rand_forest</span>() <span class="op">%&gt;%</span></span>
<span id="cb977-2"><a href="discrete-response.html#cb977-2"></a><span class="st">  </span><span class="kw">set_engine</span>(<span class="st">"randomForest"</span>) <span class="op">%&gt;%</span></span>
<span id="cb977-3"><a href="discrete-response.html#cb977-3"></a><span class="st">  </span><span class="kw">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb977-4"><a href="discrete-response.html#cb977-4"></a></span>
<span id="cb977-5"><a href="discrete-response.html#cb977-5"></a>house_forest &lt;-<span class="st"> </span><span class="kw">fit</span>(forest_mod,</span>
<span id="cb977-6"><a href="discrete-response.html#cb977-6"></a>                    <span class="kw">factor</span>(dem_win) <span class="op">~</span><span class="st"> </span>region <span class="op">+</span><span class="st"> </span>state <span class="op">+</span><span class="st"> </span>year,</span>
<span id="cb977-7"><a href="discrete-response.html#cb977-7"></a>                    <span class="dt">data =</span> house_ch12)</span>
<span id="cb977-8"><a href="discrete-response.html#cb977-8"></a></span>
<span id="cb977-9"><a href="discrete-response.html#cb977-9"></a>house_forest</span></code></pre></div>
<pre><code>## parsnip model object
## 
## Fit time:  18.5s 
## 
## Call:
##  randomForest(x = as.data.frame(x), y = y) 
##                Type of random forest: classification
##                      Number of trees: 500
## No. of variables tried at each split: 7
## 
##         OOB estimate of  error rate: 36%
## Confusion matrix:
##      0    1 class.error
## 0 2349 2084        0.47
## 1 1356 3768        0.26</code></pre>
<p>We see under “OOB estimate of error rate” that this model has an error rate of 36% (or, looking at it the other way, an accuracy of 64%). We can see how the error rate of our algorithm changes as we add trees by looking at <code>house_forest$fit$err.rate[, "OOB"]</code>. By default, <code>randomForest()</code> (the engine we specified) grows 500 trees.</p>
<div class="sourceCode" id="cb979"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb979-1"><a href="discrete-response.html#cb979-1"></a><span class="kw">tibble</span>(<span class="st">`</span><span class="dt">Error rate</span><span class="st">`</span> =<span class="st"> </span>house_forest<span class="op">$</span>fit<span class="op">$</span>err.rate[, <span class="st">"OOB"</span>],</span>
<span id="cb979-2"><a href="discrete-response.html#cb979-2"></a>       <span class="dt">Trees =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">500</span>) <span class="op">%&gt;%</span></span>
<span id="cb979-3"><a href="discrete-response.html#cb979-3"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Trees, <span class="dt">y =</span> <span class="st">`</span><span class="dt">Error rate</span><span class="st">`</span>)) <span class="op">+</span></span>
<span id="cb979-4"><a href="discrete-response.html#cb979-4"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb979-5"><a href="discrete-response.html#cb979-5"></a><span class="st">  </span><span class="kw">theme_classic</span>()</span></code></pre></div>
<p><img src="book_temp_files/figure-html/unnamed-chunk-760-1.png" width="672"></p>
<p>We can see that in this case, the accuracy improves as we add more trees until about 300 trees where accuracy stabilizes.</p>
<p>Random forests often perform better than other methods. However, a disadvantage of random forests is that we lose interpretability—we don’t get anything like the coefficients from a logistic regression or the single tree from CART.</p>
<!-- AR: Cutting this; not sure how to do this in tidymodels -->
<!-- An approach that helps with interpretability is to examine _variable importance_. To define _variable importance_ we count how often a predictor is used in the individual trees. You can learn more about _variable importance_ in an advanced machine learning book.^[https://web.stanford.edu/~hastie/Papers/ESLII.pdf] The __caret__ package includes the function `varImp` that extracts variable importance from any model in which the calculation is implemented.  -->
<!-- ```{r} -->
<!-- caret::varImp(house_forest) -->
<!-- ``` -->
<!-- Thus, we can see that the state an observation is in plays the biggest role in our forest, followed by year and finally by region. -->
</div>
</div>
<div id="comparing-the-three-approaches" class="section level2">
<h2>
<span class="header-section-number">12.4</span> Comparing the three approaches</h2>
<p>We’ve explored three ways to model binary responses in this chapter. Which one should you use?</p>
<p>This isn’t as straightforward a question as it may seem. First, we need some measure of which model is “better.” The most obvious way to compare models for binary data is simply to look at the predicted outcomes from the model and compare those predicted outcomes to the actual outcomes. The percentage of outcomes correctly classified by the model is called the model’s <em>accuracy</em>.</p>
<p>Let’s compare the accuracy of the following models in predicting Democratic victories in House elections:</p>
<ul>
<li>Predicting a Democratic win (the modal outcome in our data) for every observation</li>
<li>A logistic regression predicting <code>dem_win</code> with <code>state</code>, <code>year</code>, and the interaction of <code>state</code> and <code>year</code>
</li>
<li>A linear regression with the same predictors as the logistic regression</li>
<li>A classification tree using <code>state</code> and <code>year</code>
</li>
<li>A random forest using <code>state</code> and <code>year</code>
</li>
</ul>
<p>Those last two models we already have saved as <code>state_year_tree</code> and <code>house_forest</code> respectively. We’ll create the logistic and linear regressions and save them as <code>house_logistic</code> and <code>house_linear</code>:</p>
<div class="sourceCode" id="cb980"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb980-1"><a href="discrete-response.html#cb980-1"></a>house_logistic &lt;-<span class="st"> </span><span class="kw">fit</span>(logistic_mod,</span>
<span id="cb980-2"><a href="discrete-response.html#cb980-2"></a>                      <span class="kw">factor</span>(dem_win) <span class="op">~</span><span class="st"> </span>state <span class="op">*</span><span class="st"> </span>year,</span>
<span id="cb980-3"><a href="discrete-response.html#cb980-3"></a>                      <span class="dt">data =</span> house_ch12)</span>
<span id="cb980-4"><a href="discrete-response.html#cb980-4"></a></span>
<span id="cb980-5"><a href="discrete-response.html#cb980-5"></a>house_linear &lt;-<span class="st"> </span><span class="kw">fit</span>(<span class="kw">linear_reg</span>(),</span>
<span id="cb980-6"><a href="discrete-response.html#cb980-6"></a>                    dem_win <span class="op">~</span><span class="st"> </span>state <span class="op">*</span><span class="st"> </span>year,</span>
<span id="cb980-7"><a href="discrete-response.html#cb980-7"></a>                    <span class="dt">data =</span> house_ch12)</span></code></pre></div>
<p>Note that fitting a linear regression is as simple as using the model specification <code>linear_reg()</code>, which by default uses <code>lm()</code> as its engine.</p>
<p>How can we extract the predictions for each of these models? <strong>tidymodels</strong> provides a unified function, <code>predict()</code>. The first argument of the function is the fitted model object. It also requires the argument <code>new_data</code>, which is the dataset on which you will be making your predictions. Here, we are making predictions on our original data (<code>house_ch12</code>). For example:</p>
<div class="sourceCode" id="cb981"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb981-1"><a href="discrete-response.html#cb981-1"></a><span class="kw">predict</span>(house_logistic, <span class="dt">new_data =</span> house_ch12)</span></code></pre></div>
<pre><code>## # A tibble: 9,557 x 1
##    .pred_class
##    &lt;fct&gt;      
##  1 0          
##  2 1          
##  3 1          
##  4 1          
##  5 1          
##  6 1          
##  7 1          
##  8 1          
##  9 1          
## 10 1          
## # … with 9,547 more rows</code></pre>
<p>The result is a tibble with the predicted outcomes stored in the column <code>.pred_class</code>.</p>
<p>For the linear model, the result is going to be a number, not a class:</p>
<div class="sourceCode" id="cb983"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb983-1"><a href="discrete-response.html#cb983-1"></a><span class="kw">predict</span>(house_linear, <span class="dt">new_data =</span> house_ch12)</span></code></pre></div>
<pre><code>## # A tibble: 9,557 x 1
##       .pred
##       &lt;dbl&gt;
##  1 1.00e-11
##  2 7.35e- 1
##  3 7.35e- 1
##  4 7.35e- 1
##  5 7.35e- 1
##  6 7.35e- 1
##  7 7.35e- 1
##  8 7.35e- 1
##  9 7.83e- 1
## 10 7.83e- 1
## # … with 9,547 more rows</code></pre>
<p>We can interpret this as a predicted probability and classify responses <span class="math inline">\(&gt; 0.5\)</span> as <span class="math inline">\(1\)</span> and <span class="math inline">\(&lt; 0.5\)</span> as <span class="math inline">\(0\)</span>:</p>
<div class="sourceCode" id="cb985"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb985-1"><a href="discrete-response.html#cb985-1"></a><span class="dv">1</span> <span class="op">*</span><span class="st"> </span>(<span class="kw">predict</span>(house_linear, <span class="dt">new_data =</span> house_ch12) <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.5</span>)</span></code></pre></div>
<p>Let’s put it all together in a tibble called <code>house_preds</code>:</p>
<div class="sourceCode" id="cb986"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb986-1"><a href="discrete-response.html#cb986-1"></a>house_preds &lt;-<span class="st"> </span>house_ch12 <span class="op">%&gt;%</span></span>
<span id="cb986-2"><a href="discrete-response.html#cb986-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">modal =</span> <span class="dv">1</span>,</span>
<span id="cb986-3"><a href="discrete-response.html#cb986-3"></a>         <span class="dt">logistic =</span> <span class="kw">predict</span>(house_logistic, <span class="dt">new_data =</span> house_ch12) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb986-4"><a href="discrete-response.html#cb986-4"></a><span class="st">           </span><span class="kw">pull</span>(.pred_class),</span>
<span id="cb986-5"><a href="discrete-response.html#cb986-5"></a>         <span class="dt">linear =</span> <span class="dv">1</span> <span class="op">*</span><span class="st"> </span>(<span class="kw">predict</span>(house_linear, <span class="dt">new_data =</span> house_ch12) <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.5</span>),</span>
<span id="cb986-6"><a href="discrete-response.html#cb986-6"></a>         <span class="dt">tree =</span> <span class="kw">predict</span>(state_year_tree, <span class="dt">new_data =</span> house_ch12) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb986-7"><a href="discrete-response.html#cb986-7"></a><span class="st">           </span><span class="kw">pull</span>(.pred_class),</span>
<span id="cb986-8"><a href="discrete-response.html#cb986-8"></a>         <span class="dt">forest =</span> <span class="kw">predict</span>(house_forest, <span class="dt">new_data =</span> house_ch12) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb986-9"><a href="discrete-response.html#cb986-9"></a><span class="st">           </span><span class="kw">pull</span>(.pred_class))</span></code></pre></div>
<p>We’ll start by looking at five random rows of <code>house_preds</code>.</p>
<div class="sourceCode" id="cb987"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb987-1"><a href="discrete-response.html#cb987-1"></a>house_preds <span class="op">%&gt;%</span></span>
<span id="cb987-2"><a href="discrete-response.html#cb987-2"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>region, <span class="op">-</span>state) <span class="op">%&gt;%</span></span>
<span id="cb987-3"><a href="discrete-response.html#cb987-3"></a><span class="st">  </span><span class="kw">sample_n</span>(<span class="dv">5</span>)</span></code></pre></div>
<table>
<thead><tr>
<th style="text-align:left;">
district
</th>
<th style="text-align:right;">
year
</th>
<th style="text-align:right;">
dem_win
</th>
<th style="text-align:right;">
south
</th>
<th style="text-align:right;">
modal
</th>
<th style="text-align:left;">
logistic
</th>
<th style="text-align:right;">
linear
</th>
<th style="text-align:left;">
tree
</th>
<th style="text-align:left;">
forest
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
NC-12
</td>
<td style="text-align:right;">
2014
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
PA-17
</td>
<td style="text-align:right;">
2002
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
SC-02
</td>
<td style="text-align:right;">
2010
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
NY-29
</td>
<td style="text-align:right;">
1984
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
PA-15
</td>
<td style="text-align:right;">
1990
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
1
</td>
</tr>
</tbody>
</table>
<p>In these five districts, the Democrats won two and therefore our <code>modal</code> prediction, which always predicts a Democratic win, classifies 40% of the observations correctly. For these districts, the logistic, linear, and classification tree models all classify SC-02 in 2010 correctly as a Democratic loss and misclassify the remaining districts, for an accuracy of 20%. Finally, the random forest model classifies SC-02 in 2010 correctly as a Democratic loss and also correctly classifies PA-17 in 2002 as a Democratic win, for an accuracy of 40%.</p>
<p>Now let’s calculate the overall accuracy of our five models. We simply need to calculate the proportion of observations where the predicted value equals <code>dem_win</code>:</p>
<div class="sourceCode" id="cb988"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb988-1"><a href="discrete-response.html#cb988-1"></a><span class="kw">tibble</span>(<span class="dt">modal =</span> <span class="kw">mean</span>(house_preds<span class="op">$</span>modal <span class="op">==</span><span class="st"> </span>house_preds<span class="op">$</span>dem_win),</span>
<span id="cb988-2"><a href="discrete-response.html#cb988-2"></a>       <span class="dt">logistic =</span> <span class="kw">mean</span>(house_preds<span class="op">$</span>logistic <span class="op">==</span><span class="st"> </span>house_preds<span class="op">$</span>dem_win),</span>
<span id="cb988-3"><a href="discrete-response.html#cb988-3"></a>       <span class="dt">linear =</span> <span class="kw">mean</span>(house_preds<span class="op">$</span>linear <span class="op">==</span><span class="st"> </span>house_preds<span class="op">$</span>dem_win),</span>
<span id="cb988-4"><a href="discrete-response.html#cb988-4"></a>       <span class="dt">tree =</span> <span class="kw">mean</span>(house_preds<span class="op">$</span>tree <span class="op">==</span><span class="st"> </span>house_preds<span class="op">$</span>dem_win),</span>
<span id="cb988-5"><a href="discrete-response.html#cb988-5"></a>       <span class="dt">forest =</span> <span class="kw">mean</span>(house_preds<span class="op">$</span>forest <span class="op">==</span><span class="st"> </span>house_preds<span class="op">$</span>dem_win))</span></code></pre></div>
<pre><code>## # A tibble: 1 x 5
##   modal logistic linear  tree forest
##   &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1 0.536    0.650  0.650 0.642  0.645</code></pre>
<p>Here we see that all our models perform better than simply picking the modal outcome, but there isn’t much variation in accuracy of the four more sophisticated models.</p>
<p>However, when selecting a model, we may care about more than just accuracy. There are three concerns in particular that we’ll address here:</p>
<ol style="list-style-type: decimal">
<li>Is accuracy the right measure?</li>
<li>Modeling for prediction vs. explanation</li>
<li>Out-of-sample predictions</li>
</ol>
<div id="is-accuracy-the-right-measure" class="section level3">
<h3>
<span class="header-section-number">12.4.1</span> Is accuracy the right measure?</h3>
<p>We’ve been looking at the <em>accuracy</em> of each model. However, we can come up with more granular measures. Every prediction can be classified into one of the following four categories:</p>
<ul>
<li>True positive (classified as a <code>1</code> and actually a <code>1</code>)</li>
<li>True negative (classified as a <code>0</code> and actually a <code>0</code>)</li>
<li>False positive (classified as a <code>1</code> but actually a <code>0</code>)</li>
<li>False negative (classified as a <code>0</code> but actually a <code>1</code>)</li>
</ul>
<p>Accuracy thus is <span class="math inline">\((\text{True positives } + \text{ True negatives})/n\)</span>. When using accuracy as a metric, therefore, we are implicitly assuming that false positives and false negatives are equally bad. In the context of election forecasting, that is probably right, since we probably only care about how many seats we accurately predict.</p>
<p>However, there are other scenarios where a false negative and a false positive can have very different costs associated with them, such as when evaluating medical interventions. (A false negative may mean that a person who actually has a disease receives no treatment, whereas a false positive may mean that a healthy person receives a medical intervention; which is worse depends on the disease and the side effects of the treatment.) Therefore, there are many metrics beyond accuracy that may be relevant for different applications, such as <em>sensitivity</em> (the proportion of actual <span class="math inline">\(1\)</span>s classified as <span class="math inline">\(1\)</span>) and <em>specificity</em> (the proportion of actual <span class="math inline">\(0\)</span>s classified as <span class="math inline">\(0\)</span>).</p>
</div>
<div id="modeling-for-prediction-vs.-explanation" class="section level3">
<h3>
<span class="header-section-number">12.4.2</span> Modeling for prediction vs. explanation</h3>
<p>All things being equal, we would prefer a model with more predictive power to one with less. However, we have emphasized that models may serve different purposes. Some focus on attempting to predict an outcome. Others focus on learning about a <em>causal effect</em>. When one is interested in identifying a causal effect, we may not always prefer the model that has the greatest predictive power.</p>
<p>Why not? One concern is <em>interpretability</em>. We want to have a sense of the magnitude of the causal effect and our uncertainty about that magnitude; this is much easier with models such as linear and logistic regressions that produce coefficients.</p>
<p>Another concern is <em>post-treatment bias</em>. For example, let’s say that we were interested in the effect of a hypertension drug on all-cause mortality. We cannot use blood pressure measurements taken after the drug was administered as a predictor if we are interested in the effects of the drug on mortality, even though such a variable will surely improve our predictions, since that variable is affected by our treatment.</p>
</div>
<div id="out-of-sample-predictions" class="section level3">
<h3>
<span class="header-section-number">12.4.3</span> Out-of-sample predictions</h3>
<p>We saw that our models predicted 64%-65% of the House races from 1976–2018 accurately using <code>state</code> and <code>year</code> as predictors. However, these models were fitted on the same data that we used to evaluate their predictions. These are called <em>in-sample</em> predictions. A more strenuous test of a model’s performance is whether it can generate good predictions on data that were not used in fitting the model. For election forecasting, for example, we are much more interested in forecasting the 2020 election results (which we don’t know) than the 1976–2018 election results (which we know). The 2020 predictions are an example of <em>out-of-sample</em> predictions.</p>
<p>Making out-of-sample predictions is a great way of measuring unknown unknowns in the world, which is data we haven’t yet observed. When making such predictions, it is important to make sure that the conditions used to create the model match the conditions of the world you are extrapolating about. Using 1976–2018 election results to predict election results in 2020, we contend, is a pretty safe extrapolation. An example of similar but unsafe extrapolation would be using UK election results to predict outcomes in the US.</p>
<p>While we can’t evaluate our models’ performance on the 2020 elections (yet!), we can take a look at the process by fitting our logistic, classification tree, and random forest models on the data we have pre-2018 and then evaluating their accuracy on the 2018 election results. Let’s start by creating tibbles of our pre-2018 and 2018 data:</p>
<div class="sourceCode" id="cb990"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb990-1"><a href="discrete-response.html#cb990-1"></a>house_pre_<span class="dv">2018</span> &lt;-<span class="st"> </span>house_ch12 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(year <span class="op">!=</span><span class="st"> </span><span class="dv">2018</span>)</span>
<span id="cb990-2"><a href="discrete-response.html#cb990-2"></a>house_<span class="dv">2018</span> &lt;-<span class="st"> </span>house_ch12 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span><span class="dv">2018</span>)</span></code></pre></div>
<p>Next, we’ll fit the models on the pre-2018 data:</p>
<div class="sourceCode" id="cb991"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb991-1"><a href="discrete-response.html#cb991-1"></a>house_logistic_pre &lt;-<span class="st"> </span><span class="kw">fit</span>(logistic_mod,</span>
<span id="cb991-2"><a href="discrete-response.html#cb991-2"></a>                           <span class="kw">factor</span>(dem_win) <span class="op">~</span><span class="st"> </span>state <span class="op">*</span><span class="st"> </span>year,</span>
<span id="cb991-3"><a href="discrete-response.html#cb991-3"></a>                           <span class="dt">data =</span> house_pre_<span class="dv">2018</span>)</span>
<span id="cb991-4"><a href="discrete-response.html#cb991-4"></a></span>
<span id="cb991-5"><a href="discrete-response.html#cb991-5"></a>house_tree_pre &lt;-<span class="st"> </span><span class="kw">fit</span>(tree_mod,</span>
<span id="cb991-6"><a href="discrete-response.html#cb991-6"></a>                       <span class="kw">factor</span>(dem_win) <span class="op">~</span><span class="st"> </span>state <span class="op">+</span><span class="st"> </span>year,</span>
<span id="cb991-7"><a href="discrete-response.html#cb991-7"></a>                       <span class="dt">data =</span> house_pre_<span class="dv">2018</span>)</span>
<span id="cb991-8"><a href="discrete-response.html#cb991-8"></a></span>
<span id="cb991-9"><a href="discrete-response.html#cb991-9"></a>house_forest_pre &lt;-<span class="st"> </span><span class="kw">fit</span>(forest_mod,</span>
<span id="cb991-10"><a href="discrete-response.html#cb991-10"></a>                         <span class="kw">factor</span>(dem_win) <span class="op">~</span><span class="st"> </span>state <span class="op">+</span><span class="st"> </span>year,</span>
<span id="cb991-11"><a href="discrete-response.html#cb991-11"></a>                         <span class="dt">data =</span> house_pre_<span class="dv">2018</span>)</span></code></pre></div>
<p>We’ll then generate predictions using <code>new_data = house_2018</code>:</p>
<div class="sourceCode" id="cb992"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb992-1"><a href="discrete-response.html#cb992-1"></a>house_<span class="dv">2018</span>_preds &lt;-<span class="st"> </span>house_<span class="dv">2018</span> <span class="op">%&gt;%</span></span>
<span id="cb992-2"><a href="discrete-response.html#cb992-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">logistic =</span> <span class="kw">predict</span>(house_logistic_pre, <span class="dt">new_data =</span> house_<span class="dv">2018</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb992-3"><a href="discrete-response.html#cb992-3"></a><span class="st">           </span><span class="kw">pull</span>(.pred_class),</span>
<span id="cb992-4"><a href="discrete-response.html#cb992-4"></a>         <span class="dt">tree =</span> <span class="kw">predict</span>(house_tree_pre, <span class="dt">new_data =</span> house_<span class="dv">2018</span>)  <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb992-5"><a href="discrete-response.html#cb992-5"></a><span class="st">           </span><span class="kw">pull</span>(.pred_class),</span>
<span id="cb992-6"><a href="discrete-response.html#cb992-6"></a>         <span class="dt">forest =</span> <span class="kw">predict</span>(house_forest_pre, <span class="dt">new_data =</span> house_<span class="dv">2018</span>)  <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb992-7"><a href="discrete-response.html#cb992-7"></a><span class="st">           </span><span class="kw">pull</span>(.pred_class))</span></code></pre></div>
<p>Finally, let’s take a look at the accuracy of the three models:</p>
<div class="sourceCode" id="cb993"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb993-1"><a href="discrete-response.html#cb993-1"></a><span class="kw">tibble</span>(<span class="dt">logistic =</span> <span class="kw">mean</span>(house_<span class="dv">2018</span>_preds<span class="op">$</span>logistic <span class="op">==</span><span class="st"> </span>house_<span class="dv">2018</span>_preds<span class="op">$</span>dem_win),</span>
<span id="cb993-2"><a href="discrete-response.html#cb993-2"></a>       <span class="dt">tree =</span> <span class="kw">mean</span>(house_<span class="dv">2018</span>_preds<span class="op">$</span>tree <span class="op">==</span><span class="st"> </span>house_<span class="dv">2018</span>_preds<span class="op">$</span>dem_win),</span>
<span id="cb993-3"><a href="discrete-response.html#cb993-3"></a>       <span class="dt">forest =</span> <span class="kw">mean</span>(house_<span class="dv">2018</span>_preds<span class="op">$</span>forest <span class="op">==</span><span class="st"> </span>house_<span class="dv">2018</span>_preds<span class="op">$</span>dem_win))</span></code></pre></div>
<pre><code>## # A tibble: 1 x 3
##   logistic  tree forest
##      &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1    0.697 0.655  0.722</code></pre>
<p>Here we see that when fitting the models on pre-2018 data and testing them on 2018 data, the random forest specification performs the best and the classification tree the worse, with the logistic regression in-between.</p>

</div>
</div>
</div></body></html>

<p style="text-align: center;">
<a href="continuous-response.html"><button class="btn btn-default">Previous</button></a>
<a href="appendices.html"><button class="btn btn-default">Next</button></a>
</p>
<p class="build-date">Page built: 
2020-07-19
</p>
</div>
</div>



</body>
</html>
