<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Chapter 10 Continuous Response | We R Who We R: Preceptor’s Primer for Bayesian Data Science" />
<meta property="og:type" content="book" />



<meta name="github-repo" content="davidkane9/PPBDS" />

<meta name="author" content="David Kane" />

<meta name="date" content="2020-07-28" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>

<meta name="description" content="Chapter 10 Continuous Response | We R Who We R: Preceptor’s Primer for Bayesian Data Science">

<title>Chapter 10 Continuous Response | We R Who We R: Preceptor’s Primer for Bayesian Data Science</title>

<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/envisioned.css" rel="stylesheet" />
<link href="libs/msmb-css-0/msmb.css" rel="stylesheet" />
<script>
function toggle_visibility(id1, id2) {
var e = document.getElementById(id1);
var f = document.getElementById(id2);

e.style.display = ((e.style.display!='none') ? 'none' : 'block');

if(f.classList.contains('fa-plus-square')) {
    f.classList.add('fa-minus-square')
    f.classList.remove('fa-plus-square')
} else {
    f.classList.add('fa-plus-square')
    f.classList.remove('fa-minus-square')
}

}
</script>
<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/str_view-0.1.0/str_view.css" rel="stylesheet" />
<script src="libs/str_view-binding-1.4.0/str_view.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }

code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />

</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul class="navbar">
<li class="msmb"><p class="title">We R Who We R: Preceptor's Primer for Bayesian Data Science<p><p class="author">David Kane</p>
<li class="dropdown" style="float:right">
<a href="javascript:void(0)" class="dropbtn">&#x25BE; Chapters</a>
<div class="dropdown-content">
<a href="index.html">Cover</a>
<a href="preamble.html">Preamble</a>
<a href="shopping-week.html">Shopping Week</a>
<a href="visualization.html"><span class="toc-section-number">1</span> Visualization</a>
<a href="tidyverse.html"><span class="toc-section-number">2</span> Tidyverse</a>
<a href="rubin-causal-model.html"><span class="toc-section-number">3</span> Rubin Causal Model</a>
<a href="functions.html"><span class="toc-section-number">4</span> Functions</a>
<a href="probability.html"><span class="toc-section-number">5</span> Probability</a>
<a href="sampling.html"><span class="toc-section-number">6</span> Sampling</a>
<a href="one-parameter.html"><span class="toc-section-number">7</span> One Parameter</a>
<a href="two-parameters.html"><span class="toc-section-number">8</span> Two Parameters</a>
<a href="n-parameters.html"><span class="toc-section-number">9</span> N Parameters</a>
<a id="active-page" href="continuous-response.html"><span class="toc-section-number">10</span> Continuous Response</a><ul class="toc-sections">
<li class="toc"><a href="#model4"> Income and Gender: One numerical and one categorical explanatory variable</a></li>
<li class="toc"><a href="#model3"> Credit card debt: two numerical explanatory variables</a></li>
<li class="toc"><a href="#seattle-house-prices"> Case study: Seattle house prices</a></li>
</ul>
<a href="discrete-response.html"><span class="toc-section-number">11</span> Discrete Response</a>
<a href="appendices.html">Appendices</a>
<a href="tools.html">Tools</a>
<a href="simpsons-paradox.html">Simpson’s Paradox</a>
<a href="m-and-s-errors.html">M and S Errors</a>
<a href="shiny.html">Shiny</a>
<a href="maps.html">Maps</a>
<a href="animation.html">Animation</a>
<a href="references-1.html">References</a>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body><div id="continuous-response" class="section level1">
<h1>
<span class="header-section-number">Chapter 10</span> Continuous Response</h1>
<!-- Overview: The main structure of the this chapter is three full scale linear modeling approaches to the same data set, where the response variable is continuous. (Maybe we have two data sets, and apply all three models to each one?) In each case, we use the tidymodels framework. I am not sure what the best dataset would be. I am not sure what the three approaches should be. Presumably lm() and stan_glm() would be included. Maybe gam() also. Or loess(). Or robust_lm(). Could be something fancier like svm(). Or neural network. -->
<!-- 0) Preamble. Plan out to chapter. Nothing more to learn. Just apply. Review themes.Rmd, and the three problems which we confronted in 9 and solved in 10. What specific questions are we going to answer? -->
<!-- 1) EDA of the data set we are using. (Or the two data sets?) validity -->
<!-- 2) Specify the mathematical stucture.  -->
<!-- 3) Specify the dgm -->
<!-- 4) humility -->
<!-- 5) How do we select among the models. -->
<!-- 6) Answer the questions we started with. -->
<!-- EC: Chapter Organization
Since Ch. 14 might be partially absorbed into this chapter, I'm wondering how to organize it.
Concepts in this chapter are multivariate regression, interaction models, parallel slope models, model selection, 3D scatterplots & regression planes. Concepts in Ch 14 are using tidymodels, machine learning, and cross validation. Here's a rough outline;
1. Multivariate regression and tidymodels
2. Interaction models, parallel slope models, model selection
3. 3D scatterplots & regression planes
4. Introducing machine learning
5. Using tidymodels for cross validation-->
<!-- EC: Dataset replacement proposals
UT Austin example: trains or sps. I need another dataset regressing on one numerical and one categorical variable, also the datasets are similar in that they analyze evaluation scores. 
Credit card debt example: Scores. 1 numerical outcome variable and 2 numerical explanatory variables
Seattle house prices example: trains or SPS. 1 numerical outcome, 1 numerical explanatory, 1 categorical explanatory. -->
<!-- 2. Use a different model, like loess, to solve the exact same problem. Go through the same overview, but more quickly. Not everything will work. For example, there are no parameter estimates for loess, or at least none that are easily visible. -->
<!-- 3. How do we decide? lm() or loess() or something? Incorporate (i.e., copy and paste) chapter 14 material. Don't do anything with tidymodel syntax. All that falls to chapter 11. But you are explaining every concept. -->
<!-- In loess section, grab a copy of this xkcd and use it: https://xkcd.com/2048/ -->
<p>Earlier we introduced ideas related to modeling for explanation, in particular that the goal of modeling is to make explicit the relationship between some outcome variable <span class="math inline">\(y\)</span> and some explanatory variable <span class="math inline">\(x\)</span>. While there are many approaches to modeling, we focused on one particular technique: <em>linear regression</em>, one of the most commonly used and easy-to-understand approaches to modeling. To keep things simple, we only considered models with one explanatory <span class="math inline">\(x\)</span> variable that was either numerical or categorical.</p>
<p>In this chapter on multiple regression, we’ll start considering models that include more than one explanatory variable <span class="math inline">\(x\)</span>. You can imagine when trying to model a particular outcome variable, like annual incomes or life expectancy, that it would be useful to include more than just one explanatory variable’s worth of information.</p>
<p>Since our regression models will now consider more than one explanatory variable, the interpretation of the associated effect of any one explanatory variable must be made in conjunction with the other explanatory variables included in your model. Let’s begin by loading all the necessary packages for this chapter.</p>
<div class="sourceCode" id="cb821"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb821-1"><a href="continuous-response.html#cb821-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb821-2"><a href="continuous-response.html#cb821-2"></a><span class="kw">library</span>(broom)</span>
<span id="cb821-3"><a href="continuous-response.html#cb821-3"></a><span class="kw">library</span>(skimr)</span>
<span id="cb821-4"><a href="continuous-response.html#cb821-4"></a><span class="kw">library</span>(ISLR)</span>
<span id="cb821-5"><a href="continuous-response.html#cb821-5"></a><span class="kw">library</span>(fivethirtyeight)</span>
<span id="cb821-6"><a href="continuous-response.html#cb821-6"></a><span class="kw">library</span>(gt)</span>
<span id="cb821-7"><a href="continuous-response.html#cb821-7"></a><span class="kw">library</span>(rsample)</span>
<span id="cb821-8"><a href="continuous-response.html#cb821-8"></a><span class="kw">library</span>(PPBDS.data)</span>
<span id="cb821-9"><a href="continuous-response.html#cb821-9"></a><span class="kw">library</span>(gapminder)</span>
<span id="cb821-10"><a href="continuous-response.html#cb821-10"></a><span class="kw">library</span>(moderndive)</span></code></pre></div>
<div id="model4" class="section level2">
<h2>
<span class="header-section-number">10.1</span> Income and Gender: One numerical and one categorical explanatory variable</h2>
<!-- EC: Is income appropriate? It's interesting but also not a completely continuous variable -->
<p>Recall the <code>trains</code> dataset, which examines the immigration attitudes of daily commuters in a predominantly white Massachusetts town. The dataset provides demographic information for its subjects, as well as data relevant to the experiment. In this section, let’s focus on the demographic data, namely income, age, and gender. Our outcome variable will be income, a continuous variable, and our two explanatory variables will be age and gender.</p>
<p>Could it be that subjects who are older earn higher incomes, perhaps because they have had time to climb up the career ladder? Are there differences in incomes for subjects of the same age, but of different genders? What can we predict for the income of, say, a 30-year-old woman in this town? We’ll answer these questions by modeling the relationship between these variables using <em>multiple regression</em>, where we have:</p>
<ol style="list-style-type: decimal">
<li>A numerical outcome variable <span class="math inline">\(y\)</span>, the subject’s annual income, and</li>
<li>Two explanatory variables:
<ol style="list-style-type: decimal">
<li>A numerical explanatory variable <span class="math inline">\(x_1\)</span>, the subject’s age.</li>
<li>A categorical explanatory variable <span class="math inline">\(x_2\)</span>, the subject’s gender.</li>
</ol>
</li>
</ol>
<div id="model4EDA" class="section level3">
<h3>
<span class="header-section-number">10.1.1</span> Exploratory data analysis</h3>
<p>To keep things simple, let’s <code>select()</code> only the subset of the variables we’ll consider in this chapter, and save this data in a new data frame called <code>earnings</code>.</p>
<div class="sourceCode" id="cb822"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb822-1"><a href="continuous-response.html#cb822-1"></a><span class="kw">library</span>(PPBDS.data)</span>
<span id="cb822-2"><a href="continuous-response.html#cb822-2"></a></span>
<span id="cb822-3"><a href="continuous-response.html#cb822-3"></a>earnings &lt;-<span class="st"> </span>trains <span class="op">%&gt;%</span></span>
<span id="cb822-4"><a href="continuous-response.html#cb822-4"></a><span class="st">  </span><span class="kw">select</span>(gender, age, income)</span></code></pre></div>
<p>Let’s first look at the raw data values by using the <code>glimpse()</code> function from the <strong>dplyr</strong> package:</p>
<div class="sourceCode" id="cb823"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb823-1"><a href="continuous-response.html#cb823-1"></a><span class="kw">glimpse</span>(earnings)</span></code></pre></div>
<pre><code>## Rows: 115
## Columns: 3
## $ gender &lt;chr&gt; "Female", "Female", "Male", "Male", "Male", "Female", "Female"…
## $ age    &lt;dbl&gt; 31, 34, 63, 45, 55, 37, 53, 36, 54, 42, 33, 50, 24, 40, 53, 50…
## $ income &lt;dbl&gt; 135000, 105000, 135000, 300000, 135000, 87500, 87500, 135000, …</code></pre>
<p>Let’s also display a random sample of 5 rows of the data, with each row corresponding to a subject. Due to the random nature of the sampling, you will likely end up with a different subset of 5 rows. The <code>set.seed()</code> function allows you to “randomly” obtain the same 5 rows if you set the same number as the seed. In this case, we’ve set the seed to 1, arbitrarily.</p>
<div class="sourceCode" id="cb825"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb825-1"><a href="continuous-response.html#cb825-1"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb825-2"><a href="continuous-response.html#cb825-2"></a>earnings <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb825-3"><a href="continuous-response.html#cb825-3"></a><span class="st">  </span><span class="kw">sample_n</span>(<span class="dt">size =</span> <span class="dv">5</span>)</span></code></pre></div>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#knrsauujvn .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#knrsauujvn .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#knrsauujvn .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#knrsauujvn .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#knrsauujvn .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#knrsauujvn .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#knrsauujvn .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#knrsauujvn .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#knrsauujvn .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#knrsauujvn .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#knrsauujvn .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#knrsauujvn .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#knrsauujvn .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#knrsauujvn .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#knrsauujvn .gt_from_md > :first-child {
  margin-top: 0;
}

#knrsauujvn .gt_from_md > :last-child {
  margin-bottom: 0;
}

#knrsauujvn .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#knrsauujvn .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#knrsauujvn .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#knrsauujvn .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#knrsauujvn .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#knrsauujvn .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#knrsauujvn .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#knrsauujvn .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#knrsauujvn .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#knrsauujvn .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#knrsauujvn .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#knrsauujvn .gt_left {
  text-align: left;
}

#knrsauujvn .gt_center {
  text-align: center;
}

#knrsauujvn .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#knrsauujvn .gt_font_normal {
  font-weight: normal;
}

#knrsauujvn .gt_font_bold {
  font-weight: bold;
}

#knrsauujvn .gt_font_italic {
  font-style: italic;
}

#knrsauujvn .gt_super {
  font-size: 65%;
}

#knrsauujvn .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="knrsauujvn" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
<thead class="gt_header">
<tr>
<th colspan="3" class="gt_heading gt_title gt_font_normal" style>A random sample of 5 out of the 115 subjects</th>
    </tr>
<tr>
<th colspan="3" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
</thead>
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">gender</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">age</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">income</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_left">Female</td>
      <td class="gt_row gt_right">56</td>
      <td class="gt_row gt_right">250000</td>
    </tr>
<tr>
<td class="gt_row gt_left">Female</td>
      <td class="gt_row gt_right">55</td>
      <td class="gt_row gt_right">105000</td>
    </tr>
<tr>
<td class="gt_row gt_left">Female</td>
      <td class="gt_row gt_right">31</td>
      <td class="gt_row gt_right">135000</td>
    </tr>
<tr>
<td class="gt_row gt_left">Male</td>
      <td class="gt_row gt_right">48</td>
      <td class="gt_row gt_right">42500</td>
    </tr>
<tr>
<td class="gt_row gt_left">Female</td>
      <td class="gt_row gt_right">21</td>
      <td class="gt_row gt_right">250000</td>
    </tr>
</tbody>
</table></div>
<p>Before we compute summary statistics, let’s change the variable type of <code>gender</code> from ‘character’ to ‘factor.’<label for="tufte-sn-14" class="margin-toggle sidenote-number">14</label><input type="checkbox" id="tufte-sn-14" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">14</span> This is because, at the time, the study only offered two responses to <code>gender</code>. Because there are only two categories, we can factorize the variable, which tells R that these are categories.</span></p>
<p>Now that we’ve looked at the raw values in our <code>earnings</code> data frame and got a sense of the data, let’s compute summary statistics. As done before, let’s use the <code>skim()</code> function from <strong>skimr</strong>.</p>
<div class="sourceCode" id="cb826"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb826-1"><a href="continuous-response.html#cb826-1"></a>earnings <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb826-2"><a href="continuous-response.html#cb826-2"></a><span class="st">  </span><span class="kw">skim</span>()</span></code></pre></div>
<table style="width: auto;" class="table table-condensed">
<caption>
<span id="tab:unnamed-chunk-613">TABLE 10.1: </span>Data summary
</caption>
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Name
</td>
<td style="text-align:left;">
Piped data
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of rows
</td>
<td style="text-align:left;">
115
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of columns
</td>
<td style="text-align:left;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
_______________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Column type frequency:
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
factor
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
________________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Group variables
</td>
<td style="text-align:left;">
None
</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table>
<thead><tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:left;">
ordered
</th>
<th style="text-align:right;">
n_unique
</th>
<th style="text-align:left;">
top_counts
</th>
</tr></thead>
<tbody><tr>
<td style="text-align:left;">
gender
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Mal: 64, Fem: 51
</td>
</tr></tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead><tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
p0
</th>
<th style="text-align:right;">
p25
</th>
<th style="text-align:right;">
p50
</th>
<th style="text-align:right;">
p75
</th>
<th style="text-align:right;">
p100
</th>
<th style="text-align:left;">
hist
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
age
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
42
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
33
</td>
<td style="text-align:right;">
43
</td>
<td style="text-align:right;">
52
</td>
<td style="text-align:right;">
68
</td>
<td style="text-align:left;">
▆▇▇▇▃
</td>
</tr>
<tr>
<td style="text-align:left;">
income
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
141813
</td>
<td style="text-align:right;">
74477
</td>
<td style="text-align:right;">
23500
</td>
<td style="text-align:right;">
87500
</td>
<td style="text-align:right;">
135000
</td>
<td style="text-align:right;">
135000
</td>
<td style="text-align:right;">
300000
</td>
<td style="text-align:left;">
▅▇▇▁▆
</td>
</tr>
</tbody>
</table>
<p>We can see that there were 64 male subjects and 51 female subjects. The mean age of the subjects was 42.4 years old, with a roughly even age distribution save for the oldest group. The average income is $141,813, which is exceptionally high for the United States. Let’s keep in mind the environmental context of the study - a wealthy, predominantly white town in the Northeast.</p>
<p>Now, let’s compute the correlation coefficient between our two numerical variables: <code>income</code> and <code>age</code>. Recall that correlation coefficients only exist between numerical variables. We observe that they are “weakly positively” correlated.</p>
<div class="sourceCode" id="cb827"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb827-1"><a href="continuous-response.html#cb827-1"></a>earnings <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb827-2"><a href="continuous-response.html#cb827-2"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">correlation =</span> <span class="kw">cor</span>(income, age)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb827-3"><a href="continuous-response.html#cb827-3"></a><span class="st">  </span><span class="kw">round</span>(<span class="dv">3</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb827-4"><a href="continuous-response.html#cb827-4"></a><span class="st">  </span><span class="kw">pull</span>()</span></code></pre></div>
<pre><code>## [1] 0.15</code></pre>
<p>Let’s now create a visualization to display the relationship between the outcome variable <code>income</code> and the explanatory variable <code>age</code>. Since both variables are numerical, we’ll use a scatterplot to display their relationship. We can incorporate the categorical variable <code>gender</code> by adding <code>color = gender</code> to the <code>aes()</code>thetic mapping.</p>
<div class="sourceCode" id="cb829"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb829-1"><a href="continuous-response.html#cb829-1"></a>earnings <span class="op">%&gt;%</span></span>
<span id="cb829-2"><a href="continuous-response.html#cb829-2"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> age, <span class="dt">y =</span> income, <span class="dt">color =</span> gender)) <span class="op">+</span></span>
<span id="cb829-3"><a href="continuous-response.html#cb829-3"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb829-4"><a href="continuous-response.html#cb829-4"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">"Age"</span>, <span class="dt">y =</span> <span class="st">"Income"</span>, <span class="dt">color =</span> <span class="st">"Gender"</span>) <span class="op">+</span></span>
<span id="cb829-5"><a href="continuous-response.html#cb829-5"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">"lm"</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>) </span></code></pre></div>
<div class="figure">
<span id="fig:unnamed-chunk-616"></span>
<p class="caption marginnote shownote">
FIGURE 10.1: Colored scatterplot of relationship between age and income.
</p>
<img src="book_temp_files/figure-html/unnamed-chunk-616-1.png" alt="Colored scatterplot of relationship between age and income." width="672">
</div>
<p>Observe that the <code>geom_smooth(method = "lm", se = FALSE)</code> layer automatically fits a different regression line for each group.</p>
<p>We notice some interesting trends. First, there is a wide range of income, with both men and women reporting the lowest and highest incomes. Second, the slope of the regression line for age for female subjects seems to be slightly negative, whereas that of male subjects is positive. It seems like female subjects are paying a penalty for age<label for="tufte-sn-15" class="margin-toggle sidenote-number">15</label><input type="checkbox" id="tufte-sn-15" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">15</span> Pun unintended.</span>, whereas male subjects seem to benefit from older age.</p>
</div>
<div id="model4interactiontable" class="section level3">
<h3>
<span class="header-section-number">10.1.2</span> Interaction model</h3>
<p>Let’s now quantify the relationship of our outcome variable <span class="math inline">\(y\)</span> and the two explanatory variables using one type of multiple regression model known as an <em>interaction model</em>. We’ll explain where the term “interaction” comes from at the end of this section.</p>
<p>In particular, we’ll write out the equation of the two regression lines using the values from a regression table. Before we do this, however, let’s go over a brief refresher of regression when you have a categorical explanatory variable <span class="math inline">\(x\)</span>.</p>
<p>Recall this regression model for countries’ life expectancies as a function of which continent the country was in. In other words, we had a numerical outcome variable <span class="math inline">\(y\)</span> = <code>lifeExp</code> and a categorical explanatory variable <span class="math inline">\(x\)</span> = <code>continent</code> which had 5 levels: <code>Africa</code>, <code>Americas</code>, <code>Asia</code>, <code>Europe</code>, and <code>Oceania</code>.</p>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#jgioueiyne .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#jgioueiyne .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jgioueiyne .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#jgioueiyne .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#jgioueiyne .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jgioueiyne .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jgioueiyne .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#jgioueiyne .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#jgioueiyne .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#jgioueiyne .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#jgioueiyne .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#jgioueiyne .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#jgioueiyne .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#jgioueiyne .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#jgioueiyne .gt_from_md > :first-child {
  margin-top: 0;
}

#jgioueiyne .gt_from_md > :last-child {
  margin-bottom: 0;
}

#jgioueiyne .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#jgioueiyne .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#jgioueiyne .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jgioueiyne .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#jgioueiyne .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jgioueiyne .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#jgioueiyne .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jgioueiyne .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jgioueiyne .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#jgioueiyne .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jgioueiyne .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#jgioueiyne .gt_left {
  text-align: left;
}

#jgioueiyne .gt_center {
  text-align: center;
}

#jgioueiyne .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#jgioueiyne .gt_font_normal {
  font-weight: normal;
}

#jgioueiyne .gt_font_bold {
  font-weight: bold;
}

#jgioueiyne .gt_font_italic {
  font-style: italic;
}

#jgioueiyne .gt_super {
  font-size: 65%;
}

#jgioueiyne .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="jgioueiyne" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
<thead class="gt_header">
<tr>
<th colspan="4" class="gt_heading gt_title gt_font_normal" style>Regression table for life expectancy as a function of continent</th>
    </tr>
<tr>
<th colspan="4" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
</thead>
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">term</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">estimate</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">conf.low</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">conf.high</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_left">(Intercept)</td>
      <td class="gt_row gt_right">55</td>
      <td class="gt_row gt_right">53</td>
      <td class="gt_row gt_right">57</td>
    </tr>
<tr>
<td class="gt_row gt_left">continentAmericas</td>
      <td class="gt_row gt_right">19</td>
      <td class="gt_row gt_right">15</td>
      <td class="gt_row gt_right">22</td>
    </tr>
<tr>
<td class="gt_row gt_left">continentAsia</td>
      <td class="gt_row gt_right">16</td>
      <td class="gt_row gt_right">13</td>
      <td class="gt_row gt_right">19</td>
    </tr>
<tr>
<td class="gt_row gt_left">continentEurope</td>
      <td class="gt_row gt_right">23</td>
      <td class="gt_row gt_right">19</td>
      <td class="gt_row gt_right">26</td>
    </tr>
<tr>
<td class="gt_row gt_left">continentOceania</td>
      <td class="gt_row gt_right">26</td>
      <td class="gt_row gt_right">15</td>
      <td class="gt_row gt_right">36</td>
    </tr>
</tbody>
</table></div>
<p>Recall our interpretation of the <code>estimate</code> column. Since <code>Africa</code> was the “baseline for comparison” group, the <code>intercept</code> term corresponds to the mean life expectancy for all countries in Africa of 54.8 years. The other four values of <code>estimate</code> correspond to “offsets” relative to the baseline group. So, for example, the “offset” corresponding to the Americas is +18.8 as compared to the baseline for comparison group Africa. In other words, the average life expectancy for countries in the Americas is 18.8 years <em>higher</em>. Thus the mean life expectancy for all countries in the Americas is 54.8 + 18.8 = 73.6. The same interpretation holds for Asia, Europe, and Oceania.</p>
<p>Going back to our multiple regression model for <code>income</code> using <code>age</code> and <code>gender</code>, we generate the regression table using a two-step approach: we first “fit” the model using the <code>lm()</code> “linear model” function and then we apply the <code>tidy()</code> function. This time, however, our model formula won’t be of the form <code>y ~ x</code>, but rather of the form <code>y ~ x1 * x2</code>. In other words, our two explanatory variables <code>x1</code> and <code>x2</code> are separated by a <code>*</code> sign:</p>
<div class="sourceCode" id="cb830"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb830-1"><a href="continuous-response.html#cb830-1"></a><span class="co"># Fit regression model:</span></span>
<span id="cb830-2"><a href="continuous-response.html#cb830-2"></a></span>
<span id="cb830-3"><a href="continuous-response.html#cb830-3"></a>earnings_model_interaction &lt;-<span class="st"> </span><span class="kw">lm</span>(income <span class="op">~</span><span class="st"> </span>age <span class="op">*</span><span class="st"> </span>gender, <span class="dt">data =</span> earnings)</span>
<span id="cb830-4"><a href="continuous-response.html#cb830-4"></a></span>
<span id="cb830-5"><a href="continuous-response.html#cb830-5"></a><span class="co"># Get regression table:</span></span>
<span id="cb830-6"><a href="continuous-response.html#cb830-6"></a></span>
<span id="cb830-7"><a href="continuous-response.html#cb830-7"></a>earnings_model_interaction <span class="op">%&gt;%</span></span>
<span id="cb830-8"><a href="continuous-response.html#cb830-8"></a><span class="st">  </span><span class="kw">tidy</span>(<span class="dt">conf.int =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb830-9"><a href="continuous-response.html#cb830-9"></a><span class="st">  </span><span class="kw">select</span>(term, estimate, conf.low, conf.high)</span></code></pre></div>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#ebjyloatcf .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ebjyloatcf .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ebjyloatcf .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ebjyloatcf .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ebjyloatcf .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ebjyloatcf .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ebjyloatcf .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ebjyloatcf .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ebjyloatcf .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ebjyloatcf .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ebjyloatcf .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ebjyloatcf .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#ebjyloatcf .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ebjyloatcf .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ebjyloatcf .gt_from_md > :first-child {
  margin-top: 0;
}

#ebjyloatcf .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ebjyloatcf .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ebjyloatcf .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#ebjyloatcf .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ebjyloatcf .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#ebjyloatcf .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ebjyloatcf .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ebjyloatcf .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ebjyloatcf .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ebjyloatcf .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#ebjyloatcf .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ebjyloatcf .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#ebjyloatcf .gt_left {
  text-align: left;
}

#ebjyloatcf .gt_center {
  text-align: center;
}

#ebjyloatcf .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ebjyloatcf .gt_font_normal {
  font-weight: normal;
}

#ebjyloatcf .gt_font_bold {
  font-weight: bold;
}

#ebjyloatcf .gt_font_italic {
  font-style: italic;
}

#ebjyloatcf .gt_super {
  font-size: 65%;
}

#ebjyloatcf .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="ebjyloatcf" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
<thead class="gt_header">
<tr>
<th colspan="4" class="gt_heading gt_title gt_font_normal" style>Regression table for interaction model</th>
    </tr>
<tr>
<th colspan="4" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
</thead>
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">term</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">estimate</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">conf.low</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">conf.high</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_left">(Intercept)</td>
      <td class="gt_row gt_right">131,906.245</td>
      <td class="gt_row gt_right">60,735.017</td>
      <td class="gt_row gt_right">203,077.473</td>
    </tr>
<tr>
<td class="gt_row gt_left">age</td>
      <td class="gt_row gt_right">−127.856</td>
      <td class="gt_row gt_right">−1,793.052</td>
      <td class="gt_row gt_right">1,537.341</td>
    </tr>
<tr>
<td class="gt_row gt_left">genderMale</td>
      <td class="gt_row gt_right">−45,118.656</td>
      <td class="gt_row gt_right">−143,261.731</td>
      <td class="gt_row gt_right">53,024.418</td>
    </tr>
<tr>
<td class="gt_row gt_left">age:genderMale</td>
      <td class="gt_row gt_right">1,671.384</td>
      <td class="gt_row gt_right">−568.575</td>
      <td class="gt_row gt_right">3,911.342</td>
    </tr>
</tbody>
</table></div>
<p>There are four rows of values corresponding to a different predictor. Female subjects are the baseline group for comparison, as the other predictors display the additional “offset” amount for males. Thus, <code>intercept</code> is the intercept <em>for only the female subjects</em>.</p>
<p>This holds similarly for <code>age</code>. It is the slope for age <em>for only the female subjects</em>. Thus, the regression line in the model has an intercept of 1.3210^{5} and slope for age of -127.86. Remember that for this data, while the intercept has a mathematical interpretation, it has no <em>practical</em> interpretation since subjects can’t have zero age.</p>
<!-- EC: Round -->
<p>What about the intercept and slope for age of the male subjects? This is where our notion of “offsets” comes into play once again. The value for <code>gendermale</code> is the <em>offset</em> in intercept for male subjects relative to female subjects. The intercept for the male subjects is <code>intercept + gendermale</code> = 1.3210^{5} + -4.5110^{4} = <code>intercept_male</code>. Similarly, <code>age:gendermale</code> = 1671.38 is not the slope for age for the male subjects, but rather the <em>offset</em> in slope for the male subjects. Therefore, the slope for age for the male subjects is <code>age + age:gendermale</code> <span class="math inline">\(=\)</span> -127.86 1671.38 <span class="math inline">\(=\)</span> 1543.53.</p>
<p>Let’s summarize these values in Table <a href="#tab:interaction-summary"><strong>??</strong></a> and focus on the two slopes for age:</p>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#jjfottzlyw .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#jjfottzlyw .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jjfottzlyw .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#jjfottzlyw .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#jjfottzlyw .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jjfottzlyw .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jjfottzlyw .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#jjfottzlyw .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#jjfottzlyw .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#jjfottzlyw .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#jjfottzlyw .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#jjfottzlyw .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#jjfottzlyw .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#jjfottzlyw .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#jjfottzlyw .gt_from_md > :first-child {
  margin-top: 0;
}

#jjfottzlyw .gt_from_md > :last-child {
  margin-bottom: 0;
}

#jjfottzlyw .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#jjfottzlyw .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#jjfottzlyw .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jjfottzlyw .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#jjfottzlyw .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jjfottzlyw .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#jjfottzlyw .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jjfottzlyw .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jjfottzlyw .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#jjfottzlyw .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jjfottzlyw .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#jjfottzlyw .gt_left {
  text-align: left;
}

#jjfottzlyw .gt_center {
  text-align: center;
}

#jjfottzlyw .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#jjfottzlyw .gt_font_normal {
  font-weight: normal;
}

#jjfottzlyw .gt_font_bold {
  font-weight: bold;
}

#jjfottzlyw .gt_font_italic {
  font-style: italic;
}

#jjfottzlyw .gt_super {
  font-size: 65%;
}

#jjfottzlyw .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="jjfottzlyw" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
<thead class="gt_header">
<tr>
<th colspan="3" class="gt_heading gt_title gt_font_normal" style>Comparison of intercepts and slopes for interaction model</th>
    </tr>
<tr>
<th colspan="3" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
</thead>
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">Gender</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Intercept</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Slope for age</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_left">Female subjects</td>
      <td class="gt_row gt_right">131,906.000</td>
      <td class="gt_row gt_right">−128.000</td>
    </tr>
<tr>
<td class="gt_row gt_left">Male subjects</td>
      <td class="gt_row gt_right">86,788.000</td>
      <td class="gt_row gt_right">1,671.000</td>
    </tr>
</tbody>
</table></div>
<p>Since the slope for age for the female subjects was -127.8557, it means that on average, a female subject who is a year older would have an income that is -127.8557 dollars <strong>lower</strong>, whereas the corresponding associated change for males was on average an increase of 1543.5278 dollars. This may or may not be consistent with the previous observation that this model is suggesting that age impacts earnings for female subjects more than for male subjects. It is difficult to say because of the opposite signs of each slope, and the difference between intercepts. We will revisit this question later.</p>
<p>Note that our regression table included the confidence interval bounds generated from <code>tidy(conf.int = TRUE)</code>. Let’s reassure ourselves that they are similar to what we would get from the bootstrap samples.</p>
<p>The process is somewhat more involved because we have multiple coefficients around which we would like to construct confidence intervals.</p>
<div class="sourceCode" id="cb831"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb831-1"><a href="continuous-response.html#cb831-1"></a><span class="kw">library</span>(rsample)</span>
<span id="cb831-2"><a href="continuous-response.html#cb831-2"></a></span>
<span id="cb831-3"><a href="continuous-response.html#cb831-3"></a>x &lt;-<span class="st"> </span>earnings <span class="op">%&gt;%</span></span>
<span id="cb831-4"><a href="continuous-response.html#cb831-4"></a><span class="st">  </span><span class="kw">bootstraps</span>(<span class="dt">times =</span> <span class="dv">1000</span>) <span class="op">%&gt;%</span></span>
<span id="cb831-5"><a href="continuous-response.html#cb831-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mod =</span> <span class="kw">map</span>(splits, <span class="op">~</span><span class="st"> </span><span class="kw">lm</span>(income <span class="op">~</span><span class="st"> </span>age <span class="op">*</span><span class="st"> </span>gender, <span class="dt">data =</span> .)),</span>
<span id="cb831-6"><a href="continuous-response.html#cb831-6"></a>         <span class="dt">reg_results =</span> <span class="kw">map</span>(mod, <span class="op">~</span><span class="st"> </span><span class="kw">tidy</span>(.)))</span></code></pre></div>
<p>Let’s take advantage of <code>unnest()</code> to reshape our data so that the unit of analysis is a replicate-term:</p>
<div class="sourceCode" id="cb832"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb832-1"><a href="continuous-response.html#cb832-1"></a>  x <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unnest</span>(reg_results)</span></code></pre></div>
<pre><code>## # A tibble: 4,000 x 8
##    splits       id         mod   term      estimate std.error statistic  p.value
##    &lt;list&gt;       &lt;chr&gt;      &lt;lis&gt; &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1 &lt;split [115… Bootstrap… &lt;lm&gt;  (Interce…  138727.    34882.     3.98   1.25e-4
##  2 &lt;split [115… Bootstrap… &lt;lm&gt;  age          -377.      882.    -0.427  6.70e-1
##  3 &lt;split [115… Bootstrap… &lt;lm&gt;  genderMa…  -65001.    46399.    -1.40   1.64e-1
##  4 &lt;split [115… Bootstrap… &lt;lm&gt;  age:gend…    2316.     1156.     2.00   4.75e-2
##  5 &lt;split [115… Bootstrap… &lt;lm&gt;  (Interce…  142668.    35271.     4.04   9.70e-5
##  6 &lt;split [115… Bootstrap… &lt;lm&gt;  age          -380.      792.    -0.479  6.33e-1
##  7 &lt;split [115… Bootstrap… &lt;lm&gt;  genderMa…  -46134.    47424.    -0.973  3.33e-1
##  8 &lt;split [115… Bootstrap… &lt;lm&gt;  age:gend…    1797.     1062.     1.69   9.34e-2
##  9 &lt;split [115… Bootstrap… &lt;lm&gt;  (Interce…  123126.    33480.     3.68   3.65e-4
## 10 &lt;split [115… Bootstrap… &lt;lm&gt;  age           411.      799.     0.514  6.08e-1
## # … with 3,990 more rows</code></pre>
<p>Now we have 4,000 rows, which are 1,000 replicates apiece for each of the <code>term</code>s in our regression.</p>
<p>It is now a simple matter to <code>group_by(term)</code> and <code>summarize()</code> to create our confidence intervals:</p>
<div class="sourceCode" id="cb834"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb834-1"><a href="continuous-response.html#cb834-1"></a>x <span class="op">%&gt;%</span></span>
<span id="cb834-2"><a href="continuous-response.html#cb834-2"></a><span class="st">  </span><span class="kw">unnest</span>(reg_results) <span class="op">%&gt;%</span></span>
<span id="cb834-3"><a href="continuous-response.html#cb834-3"></a><span class="st">  </span><span class="kw">group_by</span>(term) <span class="op">%&gt;%</span></span>
<span id="cb834-4"><a href="continuous-response.html#cb834-4"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">conf.low =</span> <span class="kw">quantile</span>(estimate, <span class="fl">0.025</span>),</span>
<span id="cb834-5"><a href="continuous-response.html#cb834-5"></a>            <span class="dt">conf.high =</span> <span class="kw">quantile</span>(estimate, <span class="fl">0.975</span>))</span></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##   term           conf.low conf.high
##   &lt;chr&gt;             &lt;dbl&gt;     &lt;dbl&gt;
## 1 (Intercept)      69420.   190794.
## 2 age              -1438.     1294.
## 3 age:genderMale    -361.     3682.
## 4 genderMale     -135116.    50400.</code></pre>
<p>For comparison, let’s take another look at the results from <code>tidy(conf.int = TRUE)</code> which we saw before:</p>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#plctbwidfe .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#plctbwidfe .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#plctbwidfe .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#plctbwidfe .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#plctbwidfe .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#plctbwidfe .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#plctbwidfe .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#plctbwidfe .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#plctbwidfe .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#plctbwidfe .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#plctbwidfe .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#plctbwidfe .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#plctbwidfe .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#plctbwidfe .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#plctbwidfe .gt_from_md > :first-child {
  margin-top: 0;
}

#plctbwidfe .gt_from_md > :last-child {
  margin-bottom: 0;
}

#plctbwidfe .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#plctbwidfe .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#plctbwidfe .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#plctbwidfe .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#plctbwidfe .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#plctbwidfe .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#plctbwidfe .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#plctbwidfe .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#plctbwidfe .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#plctbwidfe .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#plctbwidfe .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#plctbwidfe .gt_left {
  text-align: left;
}

#plctbwidfe .gt_center {
  text-align: center;
}

#plctbwidfe .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#plctbwidfe .gt_font_normal {
  font-weight: normal;
}

#plctbwidfe .gt_font_bold {
  font-weight: bold;
}

#plctbwidfe .gt_font_italic {
  font-style: italic;
}

#plctbwidfe .gt_super {
  font-size: 65%;
}

#plctbwidfe .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="plctbwidfe" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
<thead class="gt_header">
<tr>
<th colspan="4" class="gt_heading gt_title gt_font_normal" style>Regression table for interaction model</th>
    </tr>
<tr>
<th colspan="4" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
</thead>
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">term</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">estimate</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">conf.low</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">conf.high</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_left">(Intercept)</td>
      <td class="gt_row gt_right">131,906.245</td>
      <td class="gt_row gt_right">60,735.017</td>
      <td class="gt_row gt_right">203,077.473</td>
    </tr>
<tr>
<td class="gt_row gt_left">age</td>
      <td class="gt_row gt_right">−127.856</td>
      <td class="gt_row gt_right">−1,793.052</td>
      <td class="gt_row gt_right">1,537.341</td>
    </tr>
<tr>
<td class="gt_row gt_left">genderMale</td>
      <td class="gt_row gt_right">−45,118.656</td>
      <td class="gt_row gt_right">−143,261.731</td>
      <td class="gt_row gt_right">53,024.418</td>
    </tr>
<tr>
<td class="gt_row gt_left">age:genderMale</td>
      <td class="gt_row gt_right">1,671.384</td>
      <td class="gt_row gt_right">−568.575</td>
      <td class="gt_row gt_right">3,911.342</td>
    </tr>
</tbody>
</table></div>
<p>They are very similar, so we will keep using <code>tidy(conf.int = TRUE)</code> to save time.</p>
<p>Let’s now write the equation for our regression lines, which we can use to compute our fitted values <span class="math inline">\(\hat{y} = \widehat{\text{income}}\)</span>. Here is the final equation, which we will break down in a second.</p>
<p><span class="math display">\[
\begin{aligned}
\hat{y} = \widehat{\text{income}} &amp;= b_0 + b_{\text{age}} \cdot \text{age} + b_{\text{male}} \cdot \mathbb{1}_{\text{is male}}(x) + b_{\text{age,male}} \cdot \text{age} \cdot \mathbb{1}_{\text{is male}}\\
&amp;= 131906 -128  \cdot \text{age} - 45119 \cdot \mathbb{1}_{\text{is male}}(x) 1671 \cdot \text{age} \cdot \mathbb{1}_{\text{is male}}
\end{aligned}
\]</span>
First, let’s use an indicator variable, <span class="math inline">\({1}_{\text{is male}}\)</span>, that assigns a value of 0 or 1 based on whether the subject is male or not.</p>
<p><span class="math display">\[
\mathbb{1}_{\text{is male}}(x) = \left\{
\begin{array}{ll}
1 &amp; \text{if } \text{subject } x \text{ is male} \\
0 &amp; \text{otherwise}\end{array}
\right.
\]</span></p>
<p>Second, let’s create coefficients in the previous equation from values in the <code>estimate</code> column in Table <a href="#tab:regtable-interaction"><strong>??</strong></a>:</p>
<ol style="list-style-type: decimal">
<li>
<span class="math inline">\(b_0\)</span> is the <code>intercept</code> = 131906 for the female subjects</li>
<li>
<span class="math inline">\(b_{\text{age}}\)</span> is the slope for <code>age</code> = -128 for the female subjects</li>
<li>
<span class="math inline">\(b_{\text{male}}\)</span> is the offset in intercept = -45119 for the male subjects</li>
<li>
<span class="math inline">\(b_{\text{age,male}}\)</span> is the offset in slope for age = 1671 for the male subjects</li>
</ol>
<p>Let’s put this all together and compute the fitted value <span class="math inline">\(\hat{y} = \widehat{\text{income}}\)</span> for female subjects. Since for female subjects <span class="math inline">\(\mathbb{1}_{\text{is male}}(x)\)</span> = 0, the previous equation becomes</p>
<p><span class="math display">\[
\begin{aligned}
\hat{y} = \widehat{\text{income}} &amp;= 131906 - 128   \cdot \text{age} - 0.446 \cdot 0 + 1671 \cdot \text{age} \cdot 0\\
&amp;= 131906 - 128 \cdot \text{age} - 0 + 0\\
&amp;= 131906 - 128 \cdot \text{age}\\
\end{aligned}
\]</span></p>
<p>which is the equation of the red regression line corresponding to the female subjects. Correspondingly, since for male subjects <span class="math inline">\(\mathbb{1}_{\text{is male}}(x)\)</span> = 1, the previous equation becomes</p>
<p><span class="math display">\[
\begin{aligned}
\hat{y} = \widehat{\text{income}} &amp;= 131906 - 128   \cdot \text{age} - 45119 + 1671 \cdot \text{age}\\
&amp;= (131906 - 45119) + (- 128 + 1671) * \text{age}\\
&amp;= 131906 + 1544    \cdot \text{age}\\
\end{aligned}
\]</span></p>
<p>which is the equation of the re regression line corresponding to the male subjects in Table <a href="#tab:interaction-summary"><strong>??</strong></a>.</p>
</div>
<div id="interpreting-regression-coefficients-with-interactions" class="section level3">
<h3>
<span class="header-section-number">10.1.3</span> Interpreting regression coefficients with interactions</h3>
<p>Before we end this section, we explain why we refer to this type of model as an “interaction model.” The <span class="math inline">\(b_{\text{age,male}}\)</span> term in the equation for the fitted value <span class="math inline">\(\hat{y}\)</span> = <span class="math inline">\(\widehat{\text{income}}\)</span> is what’s known in statistical modeling as an “interaction effect.”
We say there is an interaction effect if the associated effect of one variable <em>depends on the value of another variable</em>. That is to say, the two variables are “interacting” with each other. Here, the associated effect of the variable age <em>depends</em> on the value of the other variable gender. The difference in slopes for age of +1671 of male subjects relative to female subjects shows this.</p>
<p>Another way of thinking about interaction effects as follows. For a given person, there might be an associated effect of their age <em>by itself</em>, there might be an associated effect of their gender <em>by itself</em>, but when age and gender are considered <em>together</em> there might be an <em>additional effect</em> above and beyond the two individual effects.</p>
<!-- EC: Could expand on RCM here! -->
<p>Can we interpret these coefficients using the <a href="rubin-causal-model.html#rubin-causal-model">Rubin Causal Model</a>? In order to interpet a multiple regression causally, you first need to decide what you are considering as the treatment variable. Let’s say that we are conceptualizing gender as the treatment variable. Back in the simple linear regression context, we noted that you cannot interpret the regression coefficient as the average treatment effect if there are any confounding variables – variables that are correlated both with the treatment variable and the potential outcomes. Multiple regression allows for consideration of confounding variables, but only in the situation where you have included <em>all</em> confounders can you justify a causal interpretation of the regression.</p>
<p>For our teaching score model, then, we can interpret the effect of gender causally <strong>only if</strong> <em>other than age measured in years</em> there are no variables that correlate with a teacher’s gender and the teacher’s potential outcomes. So if age is the only confounding variable, we can interpret the model causally. This is most likely not the case, but let’s take on this assumption to see what we get:</p>
<pre><code>## Warning: 'html' is deprecated.
## Use 'xml2::read_html' instead.
## See help("Deprecated")

## Warning: 'html' is deprecated.
## Use 'xml2::read_html' instead.
## See help("Deprecated")</code></pre>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#bdbinbrhyg .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#bdbinbrhyg .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#bdbinbrhyg .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#bdbinbrhyg .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#bdbinbrhyg .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#bdbinbrhyg .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#bdbinbrhyg .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#bdbinbrhyg .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#bdbinbrhyg .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#bdbinbrhyg .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#bdbinbrhyg .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#bdbinbrhyg .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#bdbinbrhyg .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#bdbinbrhyg .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#bdbinbrhyg .gt_from_md > :first-child {
  margin-top: 0;
}

#bdbinbrhyg .gt_from_md > :last-child {
  margin-bottom: 0;
}

#bdbinbrhyg .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#bdbinbrhyg .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#bdbinbrhyg .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#bdbinbrhyg .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#bdbinbrhyg .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#bdbinbrhyg .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#bdbinbrhyg .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#bdbinbrhyg .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#bdbinbrhyg .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#bdbinbrhyg .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#bdbinbrhyg .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#bdbinbrhyg .gt_left {
  text-align: left;
}

#bdbinbrhyg .gt_center {
  text-align: center;
}

#bdbinbrhyg .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#bdbinbrhyg .gt_font_normal {
  font-weight: normal;
}

#bdbinbrhyg .gt_font_bold {
  font-weight: bold;
}

#bdbinbrhyg .gt_font_italic {
  font-style: italic;
}

#bdbinbrhyg .gt_super {
  font-size: 65%;
}

#bdbinbrhyg .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="bdbinbrhyg" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">Subject</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"&gt;
&lt;html&gt;&lt;body&gt;&lt;i&gt;Y_{gender = F}&lt;/i&gt;&lt;/body&gt;&lt;/html&gt;
</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"&gt;
&lt;html&gt;&lt;body&gt;&lt;i&gt;Y_{gender = M}&lt;/i&gt;&lt;/body&gt;&lt;/html&gt;
</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_left">Alice</td>
      <td class="gt_row gt_left">4</td>
      <td class="gt_row gt_left">?</td>
    </tr>
<tr>
<td class="gt_row gt_left">Bob</td>
      <td class="gt_row gt_left">?</td>
      <td class="gt_row gt_left">3.75</td>
    </tr>
<tr>
<td class="gt_row gt_left">Charlie</td>
      <td class="gt_row gt_left">?</td>
      <td class="gt_row gt_left">4.1</td>
    </tr>
</tbody>
</table></div>
<!-- AR: problems with using potential outcome tables with regressions like
this: a) heterogenous treatment effects lead to difficult-to-calculate
confidence intervals, given what we've shown the students before, b) this only
takes into account the uncertainty around the estimate of the ATE, since
predictive intervals aren't causal quantities.  But this was my best attempt.
-->
<p>Now, following what we saw in the last chapter, we’ll want to fill in the missing potential outcomes by using our estimate of the ATE. But in an interaction model, this is is more complicated, because we have <strong>heterogeneous treatment effects</strong>. That means that we don’t just have one estimate of the ATE, but rather we have an estimate of the ATE for <em>each age.</em> So we need to know the age of each subject:</p>
<!-- EC: There's a way to get the nice math formatting onto GT tables, either by wrapping col_labels() arguments in md() or html(). Still figuring it out. -->
<pre><code>## Warning: 'html' is deprecated.
## Use 'xml2::read_html' instead.
## See help("Deprecated")

## Warning: 'html' is deprecated.
## Use 'xml2::read_html' instead.
## See help("Deprecated")

## Warning: 'html' is deprecated.
## Use 'xml2::read_html' instead.
## See help("Deprecated")

## Warning: 'html' is deprecated.
## Use 'xml2::read_html' instead.
## See help("Deprecated")</code></pre>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#chunswpyqv .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#chunswpyqv .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#chunswpyqv .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#chunswpyqv .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#chunswpyqv .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#chunswpyqv .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#chunswpyqv .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#chunswpyqv .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#chunswpyqv .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#chunswpyqv .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#chunswpyqv .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#chunswpyqv .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#chunswpyqv .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#chunswpyqv .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#chunswpyqv .gt_from_md > :first-child {
  margin-top: 0;
}

#chunswpyqv .gt_from_md > :last-child {
  margin-bottom: 0;
}

#chunswpyqv .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#chunswpyqv .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#chunswpyqv .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#chunswpyqv .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#chunswpyqv .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#chunswpyqv .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#chunswpyqv .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#chunswpyqv .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#chunswpyqv .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#chunswpyqv .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#chunswpyqv .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#chunswpyqv .gt_left {
  text-align: left;
}

#chunswpyqv .gt_center {
  text-align: center;
}

#chunswpyqv .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#chunswpyqv .gt_font_normal {
  font-weight: normal;
}

#chunswpyqv .gt_font_bold {
  font-weight: bold;
}

#chunswpyqv .gt_font_italic {
  font-style: italic;
}

#chunswpyqv .gt_super {
  font-size: 65%;
}

#chunswpyqv .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="chunswpyqv" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"&gt;
&lt;html&gt;&lt;body&gt;&lt;b&gt;Subject&lt;/b&gt;&lt;/body&gt;&lt;/html&gt;
</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"&gt;
&lt;html&gt;&lt;body&gt;&lt;b&gt;age&lt;/b&gt;&lt;/body&gt;&lt;/html&gt;
</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"&gt;
&lt;html&gt;&lt;body&gt;&lt;i&gt;Y_{gender = F}&lt;/i&gt;&lt;/body&gt;&lt;/html&gt;
</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"&gt;
&lt;html&gt;&lt;body&gt;&lt;i&gt;Y_{gender = M}&lt;/i&gt;&lt;/body&gt;&lt;/html&gt;
</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_left">Alice</td>
      <td class="gt_row gt_left">30</td>
      <td class="gt_row gt_left">4</td>
      <td class="gt_row gt_left">?</td>
    </tr>
<tr>
<td class="gt_row gt_left">Bob</td>
      <td class="gt_row gt_left">45</td>
      <td class="gt_row gt_left">?</td>
      <td class="gt_row gt_left">3.75</td>
    </tr>
<tr>
<td class="gt_row gt_left">Charlie</td>
      <td class="gt_row gt_left">60</td>
      <td class="gt_row gt_left">?</td>
      <td class="gt_row gt_left">4.1</td>
    </tr>
</tbody>
</table></div>
<p>We could use the regression equation to get the point estimate of the ATE for each age:</p>
<p><span class="math display">\[
\begin{aligned}
\widehat{\text{ATE}} &amp;= - 0.446 \cdot \mathbb{1}_{\text{is male}}(x) + 0.014 \cdot \text{age} \cdot \mathbb{1}_{\text{is male}}
\end{aligned}
\]</span></p>
<p>But that still does not give us an estimate of the uncertainty around that interval.</p>
<!-- AR: we could teach the students how to use a covariance matrix to calculate this quantity, but this chapter is very long and I fear this is already pretty confusing, so I'm presenting an easy way to get the answer -->
<!-- EC: What is the reason for calculating the CIs at each age? -->
<p>Thankfully, there is an easy way to get that using <code>lm()</code> and <code>tidy()</code>. Recall that our coefficient on <code>gendermale</code> reflects the effect for subjects whose age is 0. If we <em>recenter</em> age so 0 is equal to the age we are interested in, then we can use both the coefficient and confidence interval around <code>gendermale</code> to get the confidence interval for that age. For example, here is how we would get the coefficient and confidence interval for subjects whose age is 30:</p>
<div class="sourceCode" id="cb838"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb838-1"><a href="continuous-response.html#cb838-1"></a><span class="kw">lm</span>(income <span class="op">~</span><span class="st"> </span><span class="kw">I</span>(age <span class="op">-</span><span class="st"> </span><span class="dv">30</span>) <span class="op">*</span><span class="st"> </span>gender, <span class="dt">data =</span> earnings) <span class="op">%&gt;%</span></span>
<span id="cb838-2"><a href="continuous-response.html#cb838-2"></a><span class="st">  </span><span class="kw">tidy</span>(<span class="dt">conf.int =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb838-3"><a href="continuous-response.html#cb838-3"></a><span class="st">  </span><span class="kw">filter</span>(term <span class="op">==</span><span class="st"> "gendermale"</span>) <span class="op">%&gt;%</span></span>
<span id="cb838-4"><a href="continuous-response.html#cb838-4"></a><span class="st">  </span><span class="kw">select</span>(term, estimate, conf.low, conf.high)</span></code></pre></div>
<pre><code>## # A tibble: 0 x 4
## # … with 4 variables: term &lt;chr&gt;, estimate &lt;dbl&gt;, conf.low &lt;dbl&gt;,
## #   conf.high &lt;dbl&gt;</code></pre>
<!-- AR: at least this is an excuse to use our `map_*` code for regressions
another time! -->
<p>But there’s no reason to do this just for one age. We can use <code>map_*</code> functions and list columns to get the coefficient on <code>gendermale</code> and the confidence interval for an arbitrary range of ages, say 20 to 90:</p>
<div class="sourceCode" id="cb840"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb840-1"><a href="continuous-response.html#cb840-1"></a>gendermale_coefs &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">ages =</span> <span class="dv">20</span><span class="op">:</span><span class="dv">90</span>) <span class="op">%&gt;%</span></span>
<span id="cb840-2"><a href="continuous-response.html#cb840-2"></a><span class="st">  </span></span>
<span id="cb840-3"><a href="continuous-response.html#cb840-3"></a><span class="st">  </span><span class="co"># First, we get our regression results for each age:</span></span>
<span id="cb840-4"><a href="continuous-response.html#cb840-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mod =</span> <span class="kw">map</span>(ages, <span class="op">~</span><span class="st"> </span><span class="kw">lm</span>(income <span class="op">~</span><span class="st"> </span><span class="kw">I</span>(age <span class="op">-</span><span class="st"> </span>.) <span class="op">*</span><span class="st"> </span>gender, <span class="dt">data =</span> earnings)),</span>
<span id="cb840-5"><a href="continuous-response.html#cb840-5"></a>         <span class="dt">reg_results =</span> <span class="kw">map</span>(mod, <span class="op">~</span><span class="st"> </span><span class="kw">tidy</span>(., <span class="dt">conf.int =</span> <span class="ot">TRUE</span>)),</span>
<span id="cb840-6"><a href="continuous-response.html#cb840-6"></a>         </span>
<span id="cb840-7"><a href="continuous-response.html#cb840-7"></a>         <span class="co"># We only care about the term "gendermale":</span></span>
<span id="cb840-8"><a href="continuous-response.html#cb840-8"></a>         </span>
<span id="cb840-9"><a href="continuous-response.html#cb840-9"></a>         <span class="dt">reg_gendermale =</span> <span class="kw">map</span>(reg_results, <span class="op">~</span><span class="st"> </span><span class="kw">filter</span>(., term <span class="op">==</span><span class="st"> "genderMale"</span>)),</span>
<span id="cb840-10"><a href="continuous-response.html#cb840-10"></a>         </span>
<span id="cb840-11"><a href="continuous-response.html#cb840-11"></a>         <span class="co"># Now, let's get the estimates and CIs:</span></span>
<span id="cb840-12"><a href="continuous-response.html#cb840-12"></a>         </span>
<span id="cb840-13"><a href="continuous-response.html#cb840-13"></a>         <span class="dt">estimate =</span> <span class="kw">map_dbl</span>(reg_gendermale, <span class="op">~</span><span class="st"> </span><span class="kw">pull</span>(., estimate)),</span>
<span id="cb840-14"><a href="continuous-response.html#cb840-14"></a>         <span class="dt">conf.low =</span> <span class="kw">map_dbl</span>(reg_gendermale, <span class="op">~</span><span class="st"> </span><span class="kw">pull</span>(., conf.low)),</span>
<span id="cb840-15"><a href="continuous-response.html#cb840-15"></a>         <span class="dt">conf.high =</span> <span class="kw">map_dbl</span>(reg_gendermale, <span class="op">~</span><span class="st"> </span><span class="kw">pull</span>(., conf.high)))</span>
<span id="cb840-16"><a href="continuous-response.html#cb840-16"></a></span>
<span id="cb840-17"><a href="continuous-response.html#cb840-17"></a>gendermale_coefs</span></code></pre></div>
<pre><code>## # A tibble: 71 x 7
##     ages mod    reg_results      reg_gendermale    estimate conf.low conf.high
##    &lt;int&gt; &lt;list&gt; &lt;list&gt;           &lt;list&gt;               &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
##  1    20 &lt;lm&gt;   &lt;tibble [4 × 7]&gt; &lt;tibble [1 × 7]&gt; -11691.    -68180.    44798.
##  2    21 &lt;lm&gt;   &lt;tibble [4 × 7]&gt; &lt;tibble [1 × 7]&gt; -10020.    -64557.    44518.
##  3    22 &lt;lm&gt;   &lt;tibble [4 × 7]&gt; &lt;tibble [1 × 7]&gt;  -8348.    -60957.    44260.
##  4    23 &lt;lm&gt;   &lt;tibble [4 × 7]&gt; &lt;tibble [1 × 7]&gt;  -6677.    -57382.    44029.
##  5    24 &lt;lm&gt;   &lt;tibble [4 × 7]&gt; &lt;tibble [1 × 7]&gt;  -5005.    -53836.    43825.
##  6    25 &lt;lm&gt;   &lt;tibble [4 × 7]&gt; &lt;tibble [1 × 7]&gt;  -3334.    -50322.    43654.
##  7    26 &lt;lm&gt;   &lt;tibble [4 × 7]&gt; &lt;tibble [1 × 7]&gt;  -1663.    -46844.    43519.
##  8    27 &lt;lm&gt;   &lt;tibble [4 × 7]&gt; &lt;tibble [1 × 7]&gt;      8.70  -43407.    43424.
##  9    28 &lt;lm&gt;   &lt;tibble [4 × 7]&gt; &lt;tibble [1 × 7]&gt;   1680.    -40015.    43375.
## 10    29 &lt;lm&gt;   &lt;tibble [4 × 7]&gt; &lt;tibble [1 × 7]&gt;   3351.    -36674.    43377.
## # … with 61 more rows</code></pre>
<p>Note how closely this code follows code we’ve seen before for using <code>map_*</code> functions to run multiple models, except now we are using <code>I(age - .)</code> in the <code>lm()</code> call to recenter each regression by <code>ages</code>.</p>
<p>The heterogeneous treatment effects are easiest to understand if plotted visually:</p>
<div class="sourceCode" id="cb842"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb842-1"><a href="continuous-response.html#cb842-1"></a>gendermale_coefs <span class="op">%&gt;%</span></span>
<span id="cb842-2"><a href="continuous-response.html#cb842-2"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> ages, <span class="dt">y =</span> estimate, <span class="dt">ymin =</span> conf.low, <span class="dt">ymax =</span> conf.high)) <span class="op">+</span></span>
<span id="cb842-3"><a href="continuous-response.html#cb842-3"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb842-4"><a href="continuous-response.html#cb842-4"></a><span class="st">  </span><span class="kw">geom_errorbar</span>() <span class="op">+</span></span>
<span id="cb842-5"><a href="continuous-response.html#cb842-5"></a><span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span></span>
<span id="cb842-6"><a href="continuous-response.html#cb842-6"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb842-7"><a href="continuous-response.html#cb842-7"></a>       <span class="dt">y =</span> <span class="st">"Effect of being male on incomes"</span>,</span>
<span id="cb842-8"><a href="continuous-response.html#cb842-8"></a>       <span class="dt">title =</span> <span class="st">"Predicting incomes with gender and age"</span>,</span>
<span id="cb842-9"><a href="continuous-response.html#cb842-9"></a>       <span class="dt">subtitle =</span> <span class="st">"As age increases, being male is more associated with higher incomes"</span>)</span></code></pre></div>
<p><img src="book_temp_files/figure-html/unnamed-chunk-629-1.png" width="672"></p>
<p>Note that our interaction model constrains the heterogeneous treatment effects to be linear with respect to age. If that isn’t a good model of the relationship, our model may make poor predictions.</p>
<p>Finally, let’s extract the values we need for our potential outcomes table:</p>
<div class="sourceCode" id="cb843"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb843-1"><a href="continuous-response.html#cb843-1"></a>gendermale_coefs <span class="op">%&gt;%</span></span>
<span id="cb843-2"><a href="continuous-response.html#cb843-2"></a><span class="st">  </span><span class="kw">filter</span>(ages <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">30</span>, <span class="dv">45</span>, <span class="dv">60</span>)) <span class="op">%&gt;%</span></span>
<span id="cb843-3"><a href="continuous-response.html#cb843-3"></a><span class="st">  </span><span class="kw">select</span>(ages, estimate, conf.low, conf.high)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 4
##    ages estimate conf.low conf.high
##   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1    30    5023.  -33392.    43437.
## 2    45   30094.    2089.    58098.
## 3    60   55164.    6681.   103648.</code></pre>
<p>Note that we’ll have to reverse the sign on our estimate for Bob and Charlie, because for them, the counterfactual is that <code>gender</code> is <code>"female"</code>.</p>
<pre><code>## Warning: 'html' is deprecated.
## Use 'xml2::read_html' instead.
## See help("Deprecated")

## Warning: 'html' is deprecated.
## Use 'xml2::read_html' instead.
## See help("Deprecated")

## Warning: 'html' is deprecated.
## Use 'xml2::read_html' instead.
## See help("Deprecated")

## Warning: 'html' is deprecated.
## Use 'xml2::read_html' instead.
## See help("Deprecated")

## Warning: 'html' is deprecated.
## Use 'xml2::read_html' instead.
## See help("Deprecated")</code></pre>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#uslybedeed .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#uslybedeed .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#uslybedeed .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#uslybedeed .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#uslybedeed .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#uslybedeed .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#uslybedeed .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#uslybedeed .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#uslybedeed .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#uslybedeed .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#uslybedeed .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#uslybedeed .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#uslybedeed .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#uslybedeed .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#uslybedeed .gt_from_md > :first-child {
  margin-top: 0;
}

#uslybedeed .gt_from_md > :last-child {
  margin-bottom: 0;
}

#uslybedeed .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#uslybedeed .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#uslybedeed .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#uslybedeed .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#uslybedeed .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#uslybedeed .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#uslybedeed .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#uslybedeed .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#uslybedeed .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#uslybedeed .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#uslybedeed .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#uslybedeed .gt_left {
  text-align: left;
}

#uslybedeed .gt_center {
  text-align: center;
}

#uslybedeed .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#uslybedeed .gt_font_normal {
  font-weight: normal;
}

#uslybedeed .gt_font_bold {
  font-weight: bold;
}

#uslybedeed .gt_font_italic {
  font-style: italic;
}

#uslybedeed .gt_super {
  font-size: 65%;
}

#uslybedeed .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="uslybedeed" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"&gt;
&lt;html&gt;&lt;body&gt;&lt;b&gt;Subject&lt;/b&gt;&lt;/body&gt;&lt;/html&gt;
</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"&gt;
&lt;html&gt;&lt;body&gt;&lt;b&gt;age&lt;/b&gt;&lt;/body&gt;&lt;/html&gt;
</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"&gt;
&lt;html&gt;&lt;body&gt;&lt;i&gt;Y_{gender = F}&lt;/i&gt;&lt;/body&gt;&lt;/html&gt;
</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"&gt;
&lt;html&gt;&lt;body&gt;&lt;i&gt;Y_{gender = M}&lt;/i&gt;&lt;/body&gt;&lt;/html&gt;
</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"&gt;
&lt;html&gt;&lt;body&gt;&lt;i&gt;ATE&lt;/i&gt;&lt;/body&gt;&lt;/html&gt;
</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_left">Alice</td>
      <td class="gt_row gt_left">30</td>
      <td class="gt_row gt_left">4</td>
      <td class="gt_row gt_left">3.96 (3.75, 4.17)</td>
      <td class="gt_row gt_left">-0.04 (-0.25, 0.17)</td>
    </tr>
<tr>
<td class="gt_row gt_left">Bob</td>
      <td class="gt_row gt_left">45</td>
      <td class="gt_row gt_left">3.59 (3.48, 3.69)</td>
      <td class="gt_row gt_left">3.75</td>
      <td class="gt_row gt_left">-0.16 (-0.27, -0.06)</td>
    </tr>
<tr>
<td class="gt_row gt_left">Charlie</td>
      <td class="gt_row gt_left">60</td>
      <td class="gt_row gt_left">3.73 (3.56, 3.91)</td>
      <td class="gt_row gt_left">4.1</td>
      <td class="gt_row gt_left">-0.37 (-0.54, -0.19)</td>
    </tr>
</tbody>
</table></div>
<p>Again, however, one should always think carefully about whether a causal interpretation of a regression model is plausible. Is it really the case that age is only confounder of the relationship between gender and teaching incomes? Likely it is not, and therefore we should not interpret the results of this regression causally.</p>
<!-- EC: Would be good to insert a theme here, like testing is evil -->
</div>
<div id="model4table" class="section level3">
<h3>
<span class="header-section-number">10.1.4</span> Parallel slopes model</h3>
<p>Another model we can use to visualize regressing on one numerical variable and one categorical variable is known as a <em>parallel slopes</em> model. Unlike interaction models where the regression lines can have different intercepts and different slopes, parallel slopes models still allow for different intercepts but <em>force</em> all lines to have the same slope. This is done by using the indicator variable we previously introduced, <span class="math inline">\({1}_{\text{is male}}\)</span>. Each line will correspond to an outcome of this indicator variable. Let’s visualize the best-fitting parallel slopes model to <code>earnings</code>.</p>
<p>A function called <code>geom_parallel_slopes()</code> in the <strong>moderndive</strong> package allows us to plot the parallel slopes model for teaching income. Notice how the code is identical to the code that produced the visualization of the interaction model previously, but now the <code>geom_smooth(method = "lm", se = FALSE)</code> layer is replaced with <code>geom_parallel_slopes(se = FALSE)</code>.</p>
<div class="sourceCode" id="cb846"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb846-1"><a href="continuous-response.html#cb846-1"></a><span class="kw">ggplot</span>(earnings, <span class="kw">aes</span>(<span class="dt">x =</span> age, <span class="dt">y =</span> income, <span class="dt">color =</span> gender)) <span class="op">+</span></span>
<span id="cb846-2"><a href="continuous-response.html#cb846-2"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb846-3"><a href="continuous-response.html#cb846-3"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">"Age"</span>, <span class="dt">y =</span> <span class="st">"Income"</span>, <span class="dt">color =</span> <span class="st">"Gender"</span>) <span class="op">+</span></span>
<span id="cb846-4"><a href="continuous-response.html#cb846-4"></a><span class="st">  </span><span class="kw">geom_parallel_slopes</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<div class="figure">
<span id="fig:unnamed-chunk-633"></span>
<p class="caption marginnote shownote">
FIGURE 10.2: Parallel slopes model of income with age and gender.
</p>
<img src="book_temp_files/figure-html/unnamed-chunk-633-1.png" alt="Parallel slopes model of income with age and gender." width="672">
</div>
<p>Observe that we now have parallel lines corresponding to the female and male subjects, respectively: here they have the same negative slope. This is telling us that, in general, subjects who are older will tend to receive lower teaching incomes than subjects who are younger. Furthermore, since the lines are parallel, the associated penalty for being older is assumed to be the same for both female and male subjects.</p>
<p>However, observe also that these two lines have different intercepts as evidenced by the fact that the blue line corresponding to the male subjects is higher than the red line corresponding to the female subjects. This is telling us that irrespective of age, female subjects tended to receive lower teaching incomes than male subjects.</p>
<p>In order to obtain the precise numerical values of the two intercepts and the single common slope, we once again “fit” the model using the <code>lm()</code> “linear model” function and then apply the <code>tidy()</code> function. However, unlike the interaction model which had a model formula of the form <code>y ~ x1 * x2</code>, our model formula is now of the form <code>y ~ x1 + x2</code>. In other words, our two explanatory variables <code>x1</code> and <code>x2</code> are separated by a <code>+</code> sign:</p>
<div class="sourceCode" id="cb847"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb847-1"><a href="continuous-response.html#cb847-1"></a><span class="co"># Fit regression model:</span></span>
<span id="cb847-2"><a href="continuous-response.html#cb847-2"></a></span>
<span id="cb847-3"><a href="continuous-response.html#cb847-3"></a>earnings_model_parallel_slopes &lt;-<span class="st"> </span><span class="kw">lm</span>(income <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>gender, <span class="dt">data =</span> earnings)</span>
<span id="cb847-4"><a href="continuous-response.html#cb847-4"></a></span>
<span id="cb847-5"><a href="continuous-response.html#cb847-5"></a><span class="co"># Get regression table:</span></span>
<span id="cb847-6"><a href="continuous-response.html#cb847-6"></a></span>
<span id="cb847-7"><a href="continuous-response.html#cb847-7"></a>earnings_model_parallel_slopes <span class="op">%&gt;%</span></span>
<span id="cb847-8"><a href="continuous-response.html#cb847-8"></a><span class="st">  </span><span class="kw">tidy</span>(<span class="dt">conf.int =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb847-9"><a href="continuous-response.html#cb847-9"></a><span class="st">  </span><span class="kw">select</span>(term, estimate, conf.low, conf.high)</span></code></pre></div>
<pre><code>## Warning: 'html' is deprecated.
## Use 'xml2::read_html' instead.
## See help("Deprecated")

## Warning: 'html' is deprecated.
## Use 'xml2::read_html' instead.
## See help("Deprecated")

## Warning: 'html' is deprecated.
## Use 'xml2::read_html' instead.
## See help("Deprecated")

## Warning: 'html' is deprecated.
## Use 'xml2::read_html' instead.
## See help("Deprecated")</code></pre>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#botnhdvzkt .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#botnhdvzkt .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#botnhdvzkt .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#botnhdvzkt .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#botnhdvzkt .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#botnhdvzkt .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#botnhdvzkt .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#botnhdvzkt .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#botnhdvzkt .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#botnhdvzkt .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#botnhdvzkt .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#botnhdvzkt .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#botnhdvzkt .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#botnhdvzkt .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#botnhdvzkt .gt_from_md > :first-child {
  margin-top: 0;
}

#botnhdvzkt .gt_from_md > :last-child {
  margin-bottom: 0;
}

#botnhdvzkt .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#botnhdvzkt .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#botnhdvzkt .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#botnhdvzkt .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#botnhdvzkt .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#botnhdvzkt .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#botnhdvzkt .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#botnhdvzkt .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#botnhdvzkt .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#botnhdvzkt .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#botnhdvzkt .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#botnhdvzkt .gt_left {
  text-align: left;
}

#botnhdvzkt .gt_center {
  text-align: center;
}

#botnhdvzkt .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#botnhdvzkt .gt_font_normal {
  font-weight: normal;
}

#botnhdvzkt .gt_font_bold {
  font-weight: bold;
}

#botnhdvzkt .gt_font_italic {
  font-style: italic;
}

#botnhdvzkt .gt_super {
  font-size: 65%;
}

#botnhdvzkt .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="botnhdvzkt" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
<thead class="gt_header">
<tr>
<th colspan="4" class="gt_heading gt_title gt_font_normal" style>Regression table for parallel slopes model</th>
    </tr>
<tr>
<th colspan="4" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
</thead>
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"&gt;
&lt;html&gt;&lt;body&gt;&lt;b&gt;term&lt;/b&gt;&lt;/body&gt;&lt;/html&gt;
</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"&gt;
&lt;html&gt;&lt;body&gt;&lt;b&gt;estimate&lt;/b&gt;&lt;/body&gt;&lt;/html&gt;
</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"&gt;
&lt;html&gt;&lt;body&gt;&lt;b&gt;conf.low&lt;/b&gt;&lt;/body&gt;&lt;/html&gt;
</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"&gt;
&lt;html&gt;&lt;body&gt;&lt;b&gt;conf.high&lt;/b&gt;&lt;/body&gt;&lt;/html&gt;
</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_left">(Intercept)</td>
      <td class="gt_row gt_right">94,052.999</td>
      <td class="gt_row gt_right">43,876.509</td>
      <td class="gt_row gt_right">144,229.488</td>
    </tr>
<tr>
<td class="gt_row gt_left">age</td>
      <td class="gt_row gt_right">795.836</td>
      <td class="gt_row gt_right">−323.689</td>
      <td class="gt_row gt_right">1,915.361</td>
    </tr>
<tr>
<td class="gt_row gt_left">genderMale</td>
      <td class="gt_row gt_right">25,235.821</td>
      <td class="gt_row gt_right">−2,142.584</td>
      <td class="gt_row gt_right">52,614.227</td>
    </tr>
</tbody>
</table></div>
<p>Similarly to the regression table for the interaction model from Table <a href="#tab:regtable-interaction"><strong>??</strong></a>, we have an <code>intercept</code> term corresponding to the intercept for the “baseline for comparison” female subject group and a <code>gendermale</code> term corresponding to the <em>offset</em> in intercept for the male subjects relative to female subjects. In other words, the red regression line corresponding to the female subjects has an intercept of 94053 while the blue regression line corresponding to the male subjects has an intercept of 94053 + 25236 = 1.192910^{5}. Once again, since there aren’t any subjects of age 0, the intercepts only have a mathematical interpretation but no practical one.</p>
<p>Unlike the interaction table shown previously, however, we now only have a single slope for age of 795.8359. This is because the model dictates that both the female and male subjects have a common slope for age. This is telling us that a subject who is a year older than another subject received a teaching income that is on average 795.84 units <em>higher</em>. This reward for being of advanced age applies equally to both female and male subjects.</p>
<p>Let’s summarize these values in a table below, noting the different intercepts but common slopes:</p>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#dlgiwvojem .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#dlgiwvojem .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dlgiwvojem .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#dlgiwvojem .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#dlgiwvojem .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dlgiwvojem .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dlgiwvojem .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#dlgiwvojem .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#dlgiwvojem .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#dlgiwvojem .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#dlgiwvojem .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#dlgiwvojem .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#dlgiwvojem .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#dlgiwvojem .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#dlgiwvojem .gt_from_md > :first-child {
  margin-top: 0;
}

#dlgiwvojem .gt_from_md > :last-child {
  margin-bottom: 0;
}

#dlgiwvojem .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#dlgiwvojem .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#dlgiwvojem .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dlgiwvojem .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#dlgiwvojem .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dlgiwvojem .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#dlgiwvojem .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dlgiwvojem .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dlgiwvojem .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#dlgiwvojem .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dlgiwvojem .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#dlgiwvojem .gt_left {
  text-align: left;
}

#dlgiwvojem .gt_center {
  text-align: center;
}

#dlgiwvojem .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#dlgiwvojem .gt_font_normal {
  font-weight: normal;
}

#dlgiwvojem .gt_font_bold {
  font-weight: bold;
}

#dlgiwvojem .gt_font_italic {
  font-style: italic;
}

#dlgiwvojem .gt_super {
  font-size: 65%;
}

#dlgiwvojem .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="dlgiwvojem" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
<thead class="gt_header">
<tr>
<th colspan="3" class="gt_heading gt_title gt_font_normal" style>Comparison of intercepts and slope for parallel slopes model</th>
    </tr>
<tr>
<th colspan="3" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
</thead>
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">Gender</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Intercept</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Slope for age</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_left">Female subjects</td>
      <td class="gt_row gt_right">94,053.000</td>
      <td class="gt_row gt_right">795.836</td>
    </tr>
<tr>
<td class="gt_row gt_left">Male subjects</td>
      <td class="gt_row gt_right">119,288.821</td>
      <td class="gt_row gt_right">795.836</td>
    </tr>
</tbody>
</table></div>
<p>Let’s now write the equation for our regression lines, which we can use to compute our fitted values <span class="math inline">\(\hat{y} = \widehat{\text{income}}\)</span>.</p>
<p><span class="math display">\[
\begin{aligned}
\hat{y} = \widehat{\text{income}} &amp;= b_0 + b_{\text{age}} \cdot \text{age} + b_{\text{male}} \cdot \mathbb{1}_{\text{is male}}(x)\\
&amp;= 94053 + 795.836  \cdot \text{age} + 25235.821 \cdot \mathbb{1}_{\text{is male}}(x) 
\end{aligned}
\]</span></p>
<p>Let’s put this all together and compute the fitted value <span class="math inline">\(\hat{y} = \widehat{\text{income}}\)</span> for female subjects. Since for female subjects the indicator function <span class="math inline">\(\mathbb{1}_{\text{is male}}(x)\)</span> = 0, the previous equation becomes</p>
<p><span class="math display">\[
\begin{aligned}
\hat{y} = \widehat{\text{income}} &amp;= 94053 +795.836 \cdot \text{age} + 25235.821 \cdot 0\\
&amp;= 94053 +795.836   \cdot \text{age}
\end{aligned}
\]</span></p>
<p>which is the equation of the red regression line corresponding to the female subjects. Correspondingly, since for male subjects the indicator function <span class="math inline">\(\mathbb{1}_{\text{is male}}(x)\)</span> = 1, the previous equation becomes</p>
<p><span class="math display">\[
\begin{aligned}
\hat{y} = \widehat{\text{income}} &amp;= 94053 +795.836 \cdot \text{age} + 25235.821 \cdot 1\\
&amp;= (94053 + 25235.821) +795.836 \cdot \text{age}\\
&amp;= 119288.821 +795.836 \cdot \text{age}
\end{aligned}
\]</span></p>
<p>which is the equation of the blue regression line corresponding to the male subjects.</p>
<p>Great! We’ve considered both an interaction model and a parallel slopes model for our data. Let’s compare the visualizations for both models side-by-side.</p>
<pre><code>## `geom_smooth()` using formula 'y ~ x'</code></pre>
<div class="figure">
<span id="fig:unnamed-chunk-638"></span>
<p class="caption marginnote shownote">
FIGURE 10.3: Comparison of interaction and parallel slopes models.
</p>
<img src="book_temp_files/figure-html/unnamed-chunk-638-1.png" alt="Comparison of interaction and parallel slopes models." width="768">
</div>
<p>At this point, you might be asking yourself: “Why would we ever use a parallel slopes model?” Looking at the left-hand plot, the two lines definitely do not appear to be parallel, so why would we <em>force</em> them to be parallel? For this data, we agree! It can easily be argued that the interaction model on the left is more appropriate. However, in the upcoming subsection on model selection, we’ll present an example where it can be argued that the case for a parallel slopes model might be stronger.</p>
</div>
<div id="model4points" class="section level3">
<h3>
<span class="header-section-number">10.1.5</span> Observed/fitted values and residuals</h3>
<p>Let’s say we now have a 36 year old female subject and a 59 year old male subject. What fitted values <span class="math inline">\(\hat{y}\)</span> = <span class="math inline">\(\widehat{\text{income}}\)</span> would our <code>earnings_model_interaction</code> yield?</p>
<p>We answer this question visually first for the female subject by finding the intersection of the red regression line and the vertical line at <span class="math inline">\(x\)</span> = age = 36. We mark this value with a large red dot. Similarly, we can identify the fitted value <span class="math inline">\(\hat{y}\)</span> = <span class="math inline">\(\widehat{\text{income}}\)</span> for the male subject by finding the intersection of the blue regression line and the vertical line at <span class="math inline">\(x\)</span> = age = 59. We mark this value with a large blue dot.</p>
<pre><code>## `geom_smooth()` using formula 'y ~ x'</code></pre>
<div class="figure">
<span id="fig:unnamed-chunk-639"></span>
<p class="caption marginnote shownote">
FIGURE 10.4: Fitted values for two new subjects.
</p>
<img src="book_temp_files/figure-html/unnamed-chunk-639-1.png" alt="Fitted values for two new subjects." width="672">
</div>
<p>What are these two values of <span class="math inline">\(\hat{y}\)</span> = <span class="math inline">\(\widehat{\text{income}}\)</span> precisely? We can use the equations of the two regression lines we computed:</p>
<ul>
<li>For all female subjects: <span class="math inline">\(\hat{y} = \widehat{\text{income}} = 131906 - 128 \cdot \text{age}\)</span>
</li>
<li>For all male subjects: <span class="math inline">\(\hat{y} = \widehat{\text{income}} = 86787 + 1544 \cdot \text{age}\)</span>
</li>
</ul>
<p>So our fitted values would be: <span class="math inline">\(131906 - 128 \cdot 36 = 127298\)</span> and <span class="math inline">\(86787 + 1544 \cdot 59 = 177883\)</span>, respectively.</p>
<p>Now what if we want the fitted values not just for these two subjects, but for all of the subjects in the <code>trains</code> experiment? Doing this by hand would be long and tedious! This is where the <code>augment()</code> function from the <strong>broom</strong> package can help: it will quickly automate the above calculations for all 115 subjects. Just like in the last chapter, we’ll use the <code>.se.fit</code> column to construct confidence intervals around our predicted values.</p>
<div class="sourceCode" id="cb851"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb851-1"><a href="continuous-response.html#cb851-1"></a><span class="co"># regression_points &lt;- earnings_model_interaction %&gt;%</span></span>
<span id="cb851-2"><a href="continuous-response.html#cb851-2"></a><span class="co">#   augment() %&gt;%</span></span>
<span id="cb851-3"><a href="continuous-response.html#cb851-3"></a><span class="co">#   mutate(conf.low = .fitted - 2 * .se.fit,</span></span>
<span id="cb851-4"><a href="continuous-response.html#cb851-4"></a><span class="co">#          conf.high = .fitted + 2 * .se.fit) %&gt;%</span></span>
<span id="cb851-5"><a href="continuous-response.html#cb851-5"></a><span class="co">#   select(income, age, gender, .fitted, conf.low, conf.high, .resid)</span></span>
<span id="cb851-6"><a href="continuous-response.html#cb851-6"></a><span class="co"># regression_points</span></span></code></pre></div>
<p>The <code>augment()</code> function also returns the residuals <span class="math inline">\(y-\hat{y}\)</span>. Notice that there are both positive and negative residuals for both male and female subjects.</p>
</div>
</div>
<div id="model3" class="section level2">
<h2>
<span class="header-section-number">10.2</span> Credit card debt: two numerical explanatory variables</h2>
<p>Let’s now switch gears and consider multiple regression models where instead of one numerical and one categorical explanatory variable, we now have two numerical explanatory variables. The dataset we’ll use is from <a href="http://www-bcf.usc.edu/~gareth/ISL/"><em>An Introduction to Statistical Learning with Applications in R (ISLR)</em></a>, an intermediate-level textbook on statistical and machine learning <span class="citation">(James et al. <a href="references-1.html#ref-islr2017" role="doc-biblioref">2017</a>)</span>. Its accompanying <strong>ISLR</strong> R package contains the datasets to which the authors apply various machine learning methods.</p>
<p>One frequently used dataset in this book is the <code>Credit</code> dataset, where the outcome variable of interest is the credit card debt of 400 individuals. Other variables like income, credit limit, credit rating, and age are included as well. Note that the <code>Credit</code> data is not based on real individuals’ financial information, but rather is a simulated dataset used for educational purposes.</p>
<p>In this section, we’ll fit a regression model where we have</p>
<ol style="list-style-type: decimal">
<li>A numerical outcome variable <span class="math inline">\(y\)</span>, the cardholder’s credit card debt</li>
<li>Two explanatory variables:
<ol style="list-style-type: decimal">
<li>One numerical explanatory variable <span class="math inline">\(x_1\)</span>, the cardholder’s credit limit</li>
<li>Another numerical explanatory variable <span class="math inline">\(x_2\)</span>, the cardholder’s income (in thousands of dollars).</li>
</ol>
</li>
</ol>
<div id="model3EDA" class="section level3">
<h3>
<span class="header-section-number">10.2.1</span> Exploratory data analysis</h3>
<p>Let’s load the <code>Credit</code> dataset. To keep things simple let’s <code>select()</code> the subset of the variables we’ll consider in this chapter, and save this data in the new data frame <code>credit_ch12</code>. Notice our slightly different use of the <code>select()</code> verb here than previously. For example, we’ll select the <code>Balance</code> variable from <code>Credit</code> but then save it with a new variable name <code>debt</code>. We do this because here the term “debt” is easier to interpret than “balance.”</p>
<div class="sourceCode" id="cb852"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb852-1"><a href="continuous-response.html#cb852-1"></a><span class="kw">library</span>(ISLR)</span>
<span id="cb852-2"><a href="continuous-response.html#cb852-2"></a>credit_ch12 &lt;-<span class="st"> </span>Credit <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb852-3"><a href="continuous-response.html#cb852-3"></a><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb852-4"><a href="continuous-response.html#cb852-4"></a><span class="st">  </span><span class="kw">select</span>(ID, <span class="dt">debt =</span> Balance, <span class="dt">credit_limit =</span> Limit, </span>
<span id="cb852-5"><a href="continuous-response.html#cb852-5"></a>         <span class="dt">income =</span> Income, <span class="dt">credit_rating =</span> Rating, <span class="dt">age =</span> Age)</span></code></pre></div>
<p>You can observe the effect of our use of <code>select()</code> in the first common step of an exploratory data analysis: looking at the raw values either in RStudio’s spreadsheet viewer or by using <code>glimpse()</code>.</p>
<div class="sourceCode" id="cb853"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb853-1"><a href="continuous-response.html#cb853-1"></a><span class="kw">glimpse</span>(credit_ch12)</span></code></pre></div>
<pre><code>## Rows: 400
## Columns: 6
## $ ID            &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, …
## $ debt          &lt;int&gt; 333, 903, 580, 964, 331, 1151, 203, 872, 279, 1350, 140…
## $ credit_limit  &lt;int&gt; 3606, 6645, 7075, 9504, 4897, 8047, 3388, 7114, 3300, 6…
## $ income        &lt;dbl&gt; 14.89, 106.03, 104.59, 148.92, 55.88, 80.18, 21.00, 71.…
## $ credit_rating &lt;int&gt; 283, 483, 514, 681, 357, 569, 259, 512, 266, 491, 589, …
## $ age           &lt;int&gt; 34, 82, 71, 36, 68, 77, 37, 87, 66, 41, 30, 64, 57, 49,…</code></pre>
<p>Furthermore, let’s look at a random sample of five out of the 400 credit card holders. Once again, note that due to the random nature of the sampling, you will likely end up with a different subset of five rows.</p>
<div class="sourceCode" id="cb855"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb855-1"><a href="continuous-response.html#cb855-1"></a>credit_ch12 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb855-2"><a href="continuous-response.html#cb855-2"></a><span class="st">  </span><span class="kw">sample_n</span>(<span class="dt">size =</span> <span class="dv">5</span>)</span></code></pre></div>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#rsauujvnjg .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#rsauujvnjg .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rsauujvnjg .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#rsauujvnjg .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#rsauujvnjg .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rsauujvnjg .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rsauujvnjg .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#rsauujvnjg .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#rsauujvnjg .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#rsauujvnjg .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#rsauujvnjg .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#rsauujvnjg .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#rsauujvnjg .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#rsauujvnjg .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#rsauujvnjg .gt_from_md > :first-child {
  margin-top: 0;
}

#rsauujvnjg .gt_from_md > :last-child {
  margin-bottom: 0;
}

#rsauujvnjg .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#rsauujvnjg .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#rsauujvnjg .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rsauujvnjg .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#rsauujvnjg .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rsauujvnjg .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#rsauujvnjg .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rsauujvnjg .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rsauujvnjg .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#rsauujvnjg .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rsauujvnjg .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#rsauujvnjg .gt_left {
  text-align: left;
}

#rsauujvnjg .gt_center {
  text-align: center;
}

#rsauujvnjg .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#rsauujvnjg .gt_font_normal {
  font-weight: normal;
}

#rsauujvnjg .gt_font_bold {
  font-weight: bold;
}

#rsauujvnjg .gt_font_italic {
  font-style: italic;
}

#rsauujvnjg .gt_super {
  font-size: 65%;
}

#rsauujvnjg .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="rsauujvnjg" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
<thead class="gt_header">
<tr>
<th colspan="6" class="gt_heading gt_title gt_font_normal" style>Random sample of 5 credit card holders</th>
    </tr>
<tr>
<th colspan="6" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
</thead>
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">ID</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">debt</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">credit_limit</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">income</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">credit_rating</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">age</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_center">324</td>
      <td class="gt_row gt_center">1999</td>
      <td class="gt_row gt_center">13913</td>
      <td class="gt_row gt_right">182.73</td>
      <td class="gt_row gt_center">982</td>
      <td class="gt_row gt_center">98</td>
    </tr>
<tr>
<td class="gt_row gt_center">167</td>
      <td class="gt_row gt_center">0</td>
      <td class="gt_row gt_center">2880</td>
      <td class="gt_row gt_right">35.69</td>
      <td class="gt_row gt_center">214</td>
      <td class="gt_row gt_center">35</td>
    </tr>
<tr>
<td class="gt_row gt_center">129</td>
      <td class="gt_row gt_center">1259</td>
      <td class="gt_row gt_center">8376</td>
      <td class="gt_row gt_right">123.30</td>
      <td class="gt_row gt_center">610</td>
      <td class="gt_row gt_center">89</td>
    </tr>
<tr>
<td class="gt_row gt_center">299</td>
      <td class="gt_row gt_center">0</td>
      <td class="gt_row gt_center">2672</td>
      <td class="gt_row gt_right">20.79</td>
      <td class="gt_row gt_center">204</td>
      <td class="gt_row gt_center">70</td>
    </tr>
<tr>
<td class="gt_row gt_center">270</td>
      <td class="gt_row gt_center">772</td>
      <td class="gt_row gt_center">5565</td>
      <td class="gt_row gt_right">39.05</td>
      <td class="gt_row gt_center">410</td>
      <td class="gt_row gt_center">48</td>
    </tr>
</tbody>
</table></div>
<p>Now that we’ve looked at the raw values in our <code>credit_ch12</code> data frame and got a sense of the data, let’s move on to computing summary statistics using <code>skim()</code>. We are only selecting for the variables of interest:</p>
<div class="sourceCode" id="cb856"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb856-1"><a href="continuous-response.html#cb856-1"></a>credit_ch12 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb856-2"><a href="continuous-response.html#cb856-2"></a><span class="st">  </span><span class="kw">select</span>(debt, credit_limit, income) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb856-3"><a href="continuous-response.html#cb856-3"></a><span class="st">  </span><span class="kw">skim</span>()</span></code></pre></div>
<table style="width: auto;" class="table table-condensed">
<caption>
<span id="tab:unnamed-chunk-646">TABLE 10.2: </span>Data summary
</caption>
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Name
</td>
<td style="text-align:left;">
Piped data
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of rows
</td>
<td style="text-align:left;">
400
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of columns
</td>
<td style="text-align:left;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
_______________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Column type frequency:
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
________________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Group variables
</td>
<td style="text-align:left;">
None
</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead><tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
p0
</th>
<th style="text-align:right;">
p25
</th>
<th style="text-align:right;">
p50
</th>
<th style="text-align:right;">
p75
</th>
<th style="text-align:right;">
p100
</th>
<th style="text-align:left;">
hist
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
debt
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
520.02
</td>
<td style="text-align:right;">
459.76
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
68.75
</td>
<td style="text-align:right;">
459.50
</td>
<td style="text-align:right;">
863.00
</td>
<td style="text-align:right;">
1999.0
</td>
<td style="text-align:left;">
▇▅▃▂▁
</td>
</tr>
<tr>
<td style="text-align:left;">
credit_limit
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4735.60
</td>
<td style="text-align:right;">
2308.20
</td>
<td style="text-align:right;">
855.00
</td>
<td style="text-align:right;">
3088.00
</td>
<td style="text-align:right;">
4622.50
</td>
<td style="text-align:right;">
5872.75
</td>
<td style="text-align:right;">
13913.0
</td>
<td style="text-align:left;">
▆▇▃▁▁
</td>
</tr>
<tr>
<td style="text-align:left;">
income
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
45.22
</td>
<td style="text-align:right;">
35.24
</td>
<td style="text-align:right;">
10.35
</td>
<td style="text-align:right;">
21.01
</td>
<td style="text-align:right;">
33.12
</td>
<td style="text-align:right;">
57.47
</td>
<td style="text-align:right;">
186.6
</td>
<td style="text-align:left;">
▇▂▁▁▁
</td>
</tr>
</tbody>
</table>
<p>Observe the summary statistics for the outcome variable <code>debt</code>: the mean and median credit card debt are $520.01 and $459.50, respectively, and that 25% of card holders had debts of $68.75 or less. Let’s now look at one of the explanatory variables <code>credit_limit</code>: the mean and median credit card limit are $4735.6 and $4622.50, respectively, while 75% of card holders had incomes of $57,470 or less.</p>
<p>Since our outcome variable <code>debt</code> and the explanatory variables <code>credit_limit</code> and <code>income</code> are numerical, we can compute the correlation coefficient between the different possible pairs of these variables. First, we can run the <code>cor()</code> command twice, once for each explanatory variable:</p>
<div class="sourceCode" id="cb857"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb857-1"><a href="continuous-response.html#cb857-1"></a>credit_ch12 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb857-2"><a href="continuous-response.html#cb857-2"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">correlation =</span> <span class="kw">cor</span>(debt, credit_limit)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb857-3"><a href="continuous-response.html#cb857-3"></a><span class="st">  </span><span class="kw">pull</span>(correlation)</span>
<span id="cb857-4"><a href="continuous-response.html#cb857-4"></a>credit_ch12 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb857-5"><a href="continuous-response.html#cb857-5"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">correlation =</span> <span class="kw">cor</span>(debt, income)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb857-6"><a href="continuous-response.html#cb857-6"></a><span class="st">  </span><span class="kw">pull</span>(correlation)</span></code></pre></div>
<p>Or we can simultaneously compute them by returning a <em>correlation matrix</em>. We can see the correlation coefficient for any pair of variables by looking them up in the appropriate row/column combination.</p>
<!-- EC: Only remaining kable charts because cor() and gt() aren't friends. Error message: "no applicable method for 'group_vars' applied to an object of class "c('matrix', 'array', 'double', 'numeric')"" -->
<div class="sourceCode" id="cb858"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb858-1"><a href="continuous-response.html#cb858-1"></a>credit_ch12 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb858-2"><a href="continuous-response.html#cb858-2"></a><span class="st">  </span><span class="kw">select</span>(debt, credit_limit, income) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb858-3"><a href="continuous-response.html#cb858-3"></a><span class="st">  </span><span class="kw">cor</span>()</span></code></pre></div>
<table class="table" style="font-size: 16px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-649">TABLE 10.3: </span>Correlation coefficients between credit card debt, credit limit, and income
</caption>
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
debt
</th>
<th style="text-align:right;">
credit_limit
</th>
<th style="text-align:right;">
income
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
debt
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
0.862
</td>
<td style="text-align:right;">
0.464
</td>
</tr>
<tr>
<td style="text-align:left;">
credit_limit
</td>
<td style="text-align:right;">
0.862
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
0.792
</td>
</tr>
<tr>
<td style="text-align:left;">
income
</td>
<td style="text-align:right;">
0.464
</td>
<td style="text-align:right;">
0.792
</td>
<td style="text-align:right;">
1.000
</td>
</tr>
</tbody>
</table>
<p>For example, the correlation coefficient of:</p>
<ol style="list-style-type: decimal">
<li>
<code>debt</code> with itself is 1 as we would expect based on the definition of the correlation coefficient.</li>
<li>
<code>debt</code> with <code>credit_limit</code> is 0.862. This indicates a strong positive linear relationship, which makes sense as only individuals with large credit limits can accrue large credit card debts.</li>
<li>
<code>debt</code> with <code>income</code> is 0.464. This is suggestive of another positive linear relationship, although not as strong as the relationship between <code>debt</code> and <code>credit_limit</code>.</li>
<li>As an added bonus, we can read off the correlation coefficient between the two explanatory variables of <code>credit_limit</code> and <code>income</code> as 0.792.</li>
</ol>
<p>We say there is a high degree of <em>collinearity</em> between the <code>credit_limit</code> and <code>income</code> explanatory variables. Collinearity (or multicollinearity) is a phenomenon where one explanatory variable in a multiple regression model is highly correlated with another.</p>
<p>So in our case since <code>credit_limit</code> and <code>income</code> are highly correlated, if we knew someone’s <code>credit_limit</code>, we could make pretty good guesses about their <code>income</code> as well. Thus, these two variables provide somewhat redundant information. However, we’ll leave discussion on how to work with collinear explanatory variables to a more intermediate-level book on regression modeling.</p>
<p>Let’s visualize the relationship of the outcome variable with each of the two explanatory variables in two separate plots.</p>
<div class="sourceCode" id="cb859"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb859-1"><a href="continuous-response.html#cb859-1"></a>credit_ch12 <span class="op">%&gt;%</span></span>
<span id="cb859-2"><a href="continuous-response.html#cb859-2"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> credit_limit, <span class="dt">y =</span> debt)) <span class="op">+</span></span>
<span id="cb859-3"><a href="continuous-response.html#cb859-3"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb859-4"><a href="continuous-response.html#cb859-4"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">"Credit limit (in $)"</span>, <span class="dt">y =</span> <span class="st">"Credit card debt (in $)"</span>, </span>
<span id="cb859-5"><a href="continuous-response.html#cb859-5"></a>       <span class="dt">title =</span> <span class="st">"Debt and credit limit"</span>) <span class="op">+</span></span>
<span id="cb859-6"><a href="continuous-response.html#cb859-6"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">"lm"</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>)</span>
<span id="cb859-7"><a href="continuous-response.html#cb859-7"></a></span>
<span id="cb859-8"><a href="continuous-response.html#cb859-8"></a>credit_ch12 <span class="op">%&gt;%</span></span>
<span id="cb859-9"><a href="continuous-response.html#cb859-9"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> income, <span class="dt">y =</span> debt)) <span class="op">+</span></span>
<span id="cb859-10"><a href="continuous-response.html#cb859-10"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb859-11"><a href="continuous-response.html#cb859-11"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">"Income (in $1,000)"</span>, <span class="dt">y =</span> <span class="st">"Credit card debt (in $)"</span>, </span>
<span id="cb859-12"><a href="continuous-response.html#cb859-12"></a>       <span class="dt">title =</span> <span class="st">"Debt and income"</span>) <span class="op">+</span></span>
<span id="cb859-13"><a href="continuous-response.html#cb859-13"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">"lm"</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<div class="figure">
<span id="fig:unnamed-chunk-651"></span>
<p class="caption marginnote shownote">
FIGURE 10.5: Relationship between credit card debt and credit limit/income.
</p>
<img src="book_temp_files/figure-html/unnamed-chunk-651-1.png" alt="Relationship between credit card debt and credit limit/income." width="672">
</div>
<p>Observe there is a positive relationship between credit limit and credit card debt: as credit limit increases so also does credit card debt. This is consistent with the strongly positive correlation coefficient of 0.862 we computed earlier. In the case of income, the positive relationship doesn’t appear as strong, given the weakly positive correlation coefficient of 0.464.</p>
<p>However, the two plots only focus on the relationship of the outcome variable with each of the two explanatory variables <em>separately</em>. To visualize the <em>joint</em> relationship of all three variables simultaneously, we need a 3-dimensional (3D) scatterplot. Each of the 400 observations in the <code>credit_ch12</code> data frame are marked with a blue point where</p>
<ol style="list-style-type: decimal">
<li>The numerical outcome variable <span class="math inline">\(y\)</span> <code>debt</code> is on the vertical axis.</li>
<li>The two numerical explanatory variables, <span class="math inline">\(x_1\)</span> <code>income</code> and <span class="math inline">\(x_2\)</span> <code>credit_limit</code>, are on the two axes that form the bottom plane.</li>
</ol>
<div class="figure">
<span id="fig:unnamed-chunk-652"></span>
<p class="caption marginnote shownote">
FIGURE 10.6: 3D scatterplot and regression plane.
</p>
<img src="11-continuous-response/images/credit_card_balance_regression_plane.png" alt="3D scatterplot and regression plane." width="75%">
</div>
<p>Furthermore, we also include the <em>regression plane</em>. Recall that regression lines are “best-fitting” in that of all possible lines we can draw through a cloud of points, the regression line minimizes the <em>sum of squared residuals</em>. This concept also extends to models with two numerical explanatory variables. The difference is instead of a “best-fitting” line, we now have a “best-fitting” plane that similarly minimizes the sum of squared residuals. Head to <a href="https://moderndive.com/regression-plane">this website</a> to open an interactive version of this plot in your browser.</p>
</div>
<div id="model3table" class="section level3">
<h3>
<span class="header-section-number">10.2.2</span> Regression plane</h3>
<p>Let’s now fit a regression model and get the regression table corresponding to the regression plane. To keep things brief in this subsection, we won’t consider an interaction model for the two numerical explanatory variables <code>income</code> and <code>credit_limit</code> like we did in Subsection <a href="continuous-response.html#model4interactiontable">10.1.2</a> using the model formula <code>income ~ age * gender</code>. Rather we’ll only consider a model fit with a formula of the form <code>y ~ x1 + x2</code>. Confusingly, however, since we now have a regression plane instead of multiple lines, the label “parallel slopes” doesn’t apply when you have two numerical explanatory variables. Just as we have done multiple times throughout Chapters <a href="#pitfalls"><strong>??</strong></a> and this chapter, the regression table for this model using our two-step process is in Table <a href="#tab:model3-table-output"><strong>??</strong></a>.</p>
<div class="sourceCode" id="cb860"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb860-1"><a href="continuous-response.html#cb860-1"></a><span class="co"># Fit regression model:</span></span>
<span id="cb860-2"><a href="continuous-response.html#cb860-2"></a></span>
<span id="cb860-3"><a href="continuous-response.html#cb860-3"></a>debt_model &lt;-<span class="st"> </span><span class="kw">lm</span>(debt <span class="op">~</span><span class="st"> </span>credit_limit <span class="op">+</span><span class="st"> </span>income, <span class="dt">data =</span> credit_ch12)</span>
<span id="cb860-4"><a href="continuous-response.html#cb860-4"></a></span>
<span id="cb860-5"><a href="continuous-response.html#cb860-5"></a><span class="co"># Get regression table:</span></span>
<span id="cb860-6"><a href="continuous-response.html#cb860-6"></a></span>
<span id="cb860-7"><a href="continuous-response.html#cb860-7"></a>debt_model <span class="op">%&gt;%</span></span>
<span id="cb860-8"><a href="continuous-response.html#cb860-8"></a><span class="st">  </span><span class="kw">tidy</span>(<span class="dt">conf.int =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb860-9"><a href="continuous-response.html#cb860-9"></a><span class="st">  </span><span class="kw">select</span>(term, estimate, conf.low, conf.high)</span></code></pre></div>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#ioueiyneeb .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ioueiyneeb .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ioueiyneeb .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ioueiyneeb .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ioueiyneeb .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ioueiyneeb .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ioueiyneeb .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ioueiyneeb .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ioueiyneeb .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ioueiyneeb .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ioueiyneeb .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ioueiyneeb .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#ioueiyneeb .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ioueiyneeb .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ioueiyneeb .gt_from_md > :first-child {
  margin-top: 0;
}

#ioueiyneeb .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ioueiyneeb .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ioueiyneeb .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#ioueiyneeb .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ioueiyneeb .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#ioueiyneeb .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ioueiyneeb .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ioueiyneeb .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ioueiyneeb .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ioueiyneeb .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#ioueiyneeb .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ioueiyneeb .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#ioueiyneeb .gt_left {
  text-align: left;
}

#ioueiyneeb .gt_center {
  text-align: center;
}

#ioueiyneeb .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ioueiyneeb .gt_font_normal {
  font-weight: normal;
}

#ioueiyneeb .gt_font_bold {
  font-weight: bold;
}

#ioueiyneeb .gt_font_italic {
  font-style: italic;
}

#ioueiyneeb .gt_super {
  font-size: 65%;
}

#ioueiyneeb .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="ioueiyneeb" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
<thead class="gt_header">
<tr>
<th colspan="4" class="gt_heading gt_title gt_font_normal" style>Multiple regression table</th>
    </tr>
<tr>
<th colspan="4" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
</thead>
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">term</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">estimate</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">conf.low</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">conf.high</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_left">(Intercept)</td>
      <td class="gt_row gt_right">-385.1793</td>
      <td class="gt_row gt_right">-423.4462</td>
      <td class="gt_row gt_right">-346.9123</td>
    </tr>
<tr>
<td class="gt_row gt_left">credit_limit</td>
      <td class="gt_row gt_right">0.2643</td>
      <td class="gt_row gt_right">0.2528</td>
      <td class="gt_row gt_right">0.2759</td>
    </tr>
<tr>
<td class="gt_row gt_left">income</td>
      <td class="gt_row gt_right">-7.6633</td>
      <td class="gt_row gt_right">-8.4204</td>
      <td class="gt_row gt_right">-6.9063</td>
    </tr>
</tbody>
</table></div>
<ol style="list-style-type: decimal">
<li>We first “fit” the linear regression model using the <code>lm(y ~ x1 + x2, data)</code> function and save it in <code>debt_model</code>.</li>
<li>We get the regression table by applying the <code>tidy()</code> function from the <strong>broom</strong> package to <code>debt_model</code>.</li>
</ol>
<p>Let’s interpret the three values in the <code>estimate</code> column. First, the <code>intercept</code> value is -$385.179. This intercept represents the credit card debt for an individual who has <code>credit_limit</code> of $0 and <code>income</code> of $0. In our data, however, the intercept has no practical interpretation since no individuals had <code>credit_limit</code> or <code>income</code> values of $0. Rather, the intercept is used to situate the regression plane in 3D space.</p>
<p>Second, the <code>credit_limit</code> value is $0.264. Taking into account all the other explanatory variables in our model, for every increase of one dollar in <code>credit_limit</code>, there is an associated increase of on average $0.26 in credit card debt. We are cautious <em>not</em> to imply causality as we have seen that “correlation is not necessarily causation.” We do this merely stating there was an <em>associated</em> increase.</p>
<p>Furthermore, we preface our interpretation with the statement, “taking into account all the other explanatory variables in our model.” Here, by all other explanatory variables we mean <code>income</code>. We do this to emphasize that we are now jointly interpreting the associated effect of multiple explanatory variables in the same model at the same time.</p>
<p>Third, <code>income</code> = -$7.66. Taking into account all other explanatory variables in our model, for every increase of one unit of <code>income</code> ($1,000 in actual income), there is an associated decrease of, on average, $7.66 in credit card debt.</p>
<p>Putting these results together, the equation of the regression plane that gives us fitted values <span class="math inline">\(\hat{y}\)</span> = <span class="math inline">\(\widehat{\text{debt}}\)</span> is:</p>
<p><span class="math display">\[
\begin{aligned}
\hat{y} &amp;= b_0 + b_1 \cdot x_1 +  b_2 \cdot x_2\\
\widehat{\text{debt}} &amp;= b_0 + b_{\text{limit}} \cdot \text{limit} + b_{\text{income}} \cdot \text{income}\\
&amp;= -385.179 + 0.263 \cdot\text{limit} - 7.663 \cdot\text{income}
\end{aligned}
\]</span></p>
<p>Recall however in the right-hand plot of Figure <a href="#fig:2numxplot1"><strong>??</strong></a> that when plotting the relationship between <code>debt</code> and <code>income</code> in isolation, there appeared to be a <em>positive</em> relationship. In the last discussed multiple regression, however, when <em>jointly</em> modeling the relationship between <code>debt</code>, <code>credit_limit</code>, and <code>income</code>, there appears to be a <em>negative</em> relationship of <code>debt</code> and <code>income</code> as evidenced by the negative slope for <code>income</code> of -$7.663. What explains these contradictory results? A phenomenon known as <em>Simpson’s Paradox</em>, whereby overall trends that exist in aggregate either disappear or reverse when the data are broken down into groups. In Subsection <a href="continuous-response.html#simpsonsparadox">10.3.8</a> we elaborate on this idea by looking at the relationship between <code>credit_limit</code> and credit card <code>debt</code>, but split along different <code>income</code> brackets.</p>
<p>Let’s say that we are most interested in the effect of income on credit card debt. Can we then use the Rubin Causal Model to estimate the causal effect of moving from one income to another? <strong>Only if</strong> the only confounder is an individual’s credit limit. That’s unlikely to be the case. But if we were willing to make that assumption, we could fill in the following potential outcome table:</p>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#jyloatcfjj .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#jyloatcfjj .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jyloatcfjj .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#jyloatcfjj .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#jyloatcfjj .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jyloatcfjj .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jyloatcfjj .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#jyloatcfjj .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#jyloatcfjj .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#jyloatcfjj .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#jyloatcfjj .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#jyloatcfjj .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#jyloatcfjj .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#jyloatcfjj .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#jyloatcfjj .gt_from_md > :first-child {
  margin-top: 0;
}

#jyloatcfjj .gt_from_md > :last-child {
  margin-bottom: 0;
}

#jyloatcfjj .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#jyloatcfjj .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#jyloatcfjj .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jyloatcfjj .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#jyloatcfjj .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jyloatcfjj .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#jyloatcfjj .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jyloatcfjj .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jyloatcfjj .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#jyloatcfjj .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jyloatcfjj .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#jyloatcfjj .gt_left {
  text-align: left;
}

#jyloatcfjj .gt_center {
  text-align: center;
}

#jyloatcfjj .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#jyloatcfjj .gt_font_normal {
  font-weight: normal;
}

#jyloatcfjj .gt_font_bold {
  font-weight: bold;
}

#jyloatcfjj .gt_font_italic {
  font-style: italic;
}

#jyloatcfjj .gt_super {
  font-size: 65%;
}

#jyloatcfjj .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="jyloatcfjj" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">Subject</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">Y_{income = 40}</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">Y_{income = 60}</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">Y_{income = 80}</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_left">Alice</td>
      <td class="gt_row gt_left">?</td>
      <td class="gt_row gt_left">?</td>
      <td class="gt_row gt_left">1,000</td>
    </tr>
<tr>
<td class="gt_row gt_left">Bob</td>
      <td class="gt_row gt_left">1,000</td>
      <td class="gt_row gt_left">?</td>
      <td class="gt_row gt_left">?</td>
    </tr>
<tr>
<td class="gt_row gt_left">Charlie</td>
      <td class="gt_row gt_left">?</td>
      <td class="gt_row gt_left">300</td>
      <td class="gt_row gt_left">?</td>
    </tr>
</tbody>
</table></div>
<p>Note that unlike our example with teaching incomes and gender, we don’t have heterogeneous treatment effects, so we are applying the same estimate of the ATE to all three people. To save space, we won’t display the ATE (<span class="math inline">\(-7.663\)</span> <span class="math inline">\((-8.420,\)</span> <span class="math inline">\(-6.906)\)</span>) in the table below.</p>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#fottzlywfy .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#fottzlywfy .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fottzlywfy .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#fottzlywfy .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#fottzlywfy .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fottzlywfy .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fottzlywfy .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#fottzlywfy .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#fottzlywfy .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#fottzlywfy .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#fottzlywfy .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#fottzlywfy .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#fottzlywfy .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#fottzlywfy .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#fottzlywfy .gt_from_md > :first-child {
  margin-top: 0;
}

#fottzlywfy .gt_from_md > :last-child {
  margin-bottom: 0;
}

#fottzlywfy .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#fottzlywfy .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#fottzlywfy .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fottzlywfy .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#fottzlywfy .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fottzlywfy .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#fottzlywfy .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fottzlywfy .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fottzlywfy .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#fottzlywfy .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fottzlywfy .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#fottzlywfy .gt_left {
  text-align: left;
}

#fottzlywfy .gt_center {
  text-align: center;
}

#fottzlywfy .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#fottzlywfy .gt_font_normal {
  font-weight: normal;
}

#fottzlywfy .gt_font_bold {
  font-weight: bold;
}

#fottzlywfy .gt_font_italic {
  font-style: italic;
}

#fottzlywfy .gt_super {
  font-size: 65%;
}

#fottzlywfy .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="fottzlywfy" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">Subject</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">Y_{income = 40}</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">Y_{income = 60}</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">Y_{income = 80}</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_left">Alice</td>
      <td class="gt_row gt_left">1,306 (1,276, 1,336)</td>
      <td class="gt_row gt_left">1,153 (1,138, 1,168)</td>
      <td class="gt_row gt_left">1,000</td>
    </tr>
<tr>
<td class="gt_row gt_left">Bob</td>
      <td class="gt_row gt_left">1,000</td>
      <td class="gt_row gt_left">847 (832, 862)</td>
      <td class="gt_row gt_left">694 (664, 724)</td>
    </tr>
<tr>
<td class="gt_row gt_left">Charlie</td>
      <td class="gt_row gt_left">453 (438, 468)</td>
      <td class="gt_row gt_left">300</td>
      <td class="gt_row gt_left">147 (132, 162)</td>
    </tr>
</tbody>
</table></div>
<p>This is likely not a great model of what sudden income shocks would do to the credit card debt of Alice, Bob and Charlie. However, it is likely much closer to the truth than a simple linear regression of credit card debt on income, which would suggest that (for example) a negative shock to Alice’s income would <em>reduce</em> her credit card debt. That is an obviously implausible result. Thus, multiple regression can help make causal claims much more plausible than simple regressions can.</p>
</div>
<div id="model3points" class="section level3">
<h3>
<span class="header-section-number">10.2.3</span> Observed/fitted values and residuals</h3>
<p>Let’s also compute all fitted values and residuals for our regression model using the <code>augment()</code> function and present only the first 10 rows of output in Table <a href="#tab:model3-points-table"><strong>??</strong></a>. Remember that the coordinates of each of the blue points in our 3D scatterplot in Figure <a href="#fig:3D-scatterplot"><strong>??</strong></a> can be found in the <code>income</code>, <code>credit_limit</code>, and <code>debt</code> columns. The fitted values on the regression plane are found in the <code>.fitted</code> column and are computed using our equation for the regression plane in the previous section:</p>
<p><span class="math display">\[
\begin{aligned}
\hat{y} = \widehat{\text{debt}} &amp;= -385.179 + 0.263 \cdot \text{limit} - 7.663 \cdot \text{income}
\end{aligned}
\]</span></p>
<div class="sourceCode" id="cb861"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb861-1"><a href="continuous-response.html#cb861-1"></a><span class="kw">augment</span>(debt_model) <span class="op">%&gt;%</span></span>
<span id="cb861-2"><a href="continuous-response.html#cb861-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">conf.low =</span> .fitted <span class="op">-</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>.se.fit,</span>
<span id="cb861-3"><a href="continuous-response.html#cb861-3"></a>         <span class="dt">conf.high =</span> .fitted <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>.se.fit) <span class="op">%&gt;%</span></span>
<span id="cb861-4"><a href="continuous-response.html#cb861-4"></a><span class="st">  </span><span class="kw">select</span>(income, credit_limit, debt, .fitted, conf.low, conf.high, .resid)</span></code></pre></div>
</div>
</div>
<div id="seattle-house-prices" class="section level2">
<h2>
<span class="header-section-number">10.3</span> Case study: Seattle house prices</h2>
<!-- EC: Needs new dataset because of ModernDive removal -->
<p><a href="https://www.kaggle.com/">Kaggle.com</a> is a machine learning and predictive modeling competition website that hosts datasets uploaded by companies, governmental organizations, and other individuals. One of their datasets is the <a href="https://www.kaggle.com/harlfoxem/housesalesprediction">“House Sales in King County, USA”</a>. It consists of sale prices of homes sold between May 2014 and May 2015 in King County, Washington, USA, which includes the greater Seattle metropolitan area. This dataset is in the <code>house_prices</code> data frame included in the <strong>moderndive</strong> package.</p>
<p>The dataset consists of 21,613 houses and 21 variables describing these houses (for a full list and description of these variables, see the help file by running <code>?house_prices</code> in the console). In this case study, we’ll create a multiple regression model where:</p>
<ul>
<li>The outcome variable <span class="math inline">\(y\)</span> is the sale <code>price</code> of houses.</li>
<li>Two explanatory variables:
<ol style="list-style-type: decimal">
<li>A numerical explanatory variable <span class="math inline">\(x_1\)</span>: house size <code>sqft_living</code> as measured in square feet of living space. Note that 1 square foot is about 0.09 square meters.</li>
<li>A categorical explanatory variable <span class="math inline">\(x_2\)</span>: house <code>condition</code>, a categorical variable with five levels where <code>1</code> indicates “poor” and <code>5</code> indicates “excellent.”</li>
</ol>
</li>
</ul>
<p>Then, we will use <code>map_*</code> functions to run the above model for every year that a house was built.</p>
<div id="house-prices-EDA-I" class="section level3">
<h3>
<span class="header-section-number">10.3.1</span> Exploratory data analysis: Part I</h3>
<p>As we’ve said numerous times throughout this book, a crucial first step when presented with data is to perform an exploratory data analysis (EDA). Exploratory data analysis can give you a sense of your data, help identify issues with your data, bring to light any outliers, and help inform model construction.</p>
<p>Recall the three common steps in an exploratory data analysis we introduced in Subsection <a href="#model1EDA"><strong>??</strong></a>:</p>
<ol style="list-style-type: decimal">
<li>Looking at the raw data values.</li>
<li>Computing summary statistics.</li>
<li>Creating data visualizations.</li>
</ol>
<p>First, let’s look at the raw data using <code>View()</code> to bring up RStudio’s spreadsheet viewer and the <code>glimpse()</code> function from the <strong>dplyr</strong> package:</p>
<div class="sourceCode" id="cb862"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb862-1"><a href="continuous-response.html#cb862-1"></a><span class="kw">View</span>(house_prices)</span>
<span id="cb862-2"><a href="continuous-response.html#cb862-2"></a><span class="kw">glimpse</span>(house_prices)</span></code></pre></div>
<pre><code>## Rows: 21,613
## Columns: 21
## $ id            &lt;chr&gt; "7129300520", "6414100192", "5631500400", "2487200875",…
## $ date          &lt;date&gt; 2014-10-13, 2014-12-09, 2015-02-25, 2014-12-09, 2015-0…
## $ price         &lt;dbl&gt; 221900, 538000, 180000, 604000, 510000, 1225000, 257500…
## $ bedrooms      &lt;int&gt; 3, 3, 2, 4, 3, 4, 3, 3, 3, 3, 3, 2, 3, 3, 5, 4, 3, 4, 2…
## $ bathrooms     &lt;dbl&gt; 1.00, 2.25, 1.00, 3.00, 2.00, 4.50, 2.25, 1.50, 1.00, 2…
## $ sqft_living   &lt;int&gt; 1180, 2570, 770, 1960, 1680, 5420, 1715, 1060, 1780, 18…
## $ sqft_lot      &lt;int&gt; 5650, 7242, 10000, 5000, 8080, 101930, 6819, 9711, 7470…
## $ floors        &lt;dbl&gt; 1.0, 2.0, 1.0, 1.0, 1.0, 1.0, 2.0, 1.0, 1.0, 2.0, 1.0, …
## $ waterfront    &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE,…
## $ view          &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0…
## $ condition     &lt;fct&gt; 3, 3, 3, 5, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 3, 3, 3, 4, 4…
## $ grade         &lt;fct&gt; 7, 7, 6, 7, 8, 11, 7, 7, 7, 7, 8, 7, 7, 7, 7, 9, 7, 7, …
## $ sqft_above    &lt;int&gt; 1180, 2170, 770, 1050, 1680, 3890, 1715, 1060, 1050, 18…
## $ sqft_basement &lt;int&gt; 0, 400, 0, 910, 0, 1530, 0, 0, 730, 0, 1700, 300, 0, 0,…
## $ yr_built      &lt;int&gt; 1955, 1951, 1933, 1965, 1987, 2001, 1995, 1963, 1960, 2…
## $ yr_renovated  &lt;int&gt; 0, 1991, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ zipcode       &lt;fct&gt; 98178, 98125, 98028, 98136, 98074, 98053, 98003, 98198,…
## $ lat           &lt;dbl&gt; 47.51, 47.72, 47.74, 47.52, 47.62, 47.66, 47.31, 47.41,…
## $ long          &lt;dbl&gt; -122.3, -122.3, -122.2, -122.4, -122.0, -122.0, -122.3,…
## $ sqft_living15 &lt;int&gt; 1340, 1690, 2720, 1360, 1800, 4760, 2238, 1650, 1780, 2…
## $ sqft_lot15    &lt;int&gt; 5650, 7639, 8062, 5000, 7503, 101930, 6819, 9711, 8113,…</code></pre>
<p>Here are some questions you can ask yourself at this stage of an EDA: Which variables are numerical? Which are categorical? For the categorical variables, what are their levels? Besides the variables we’ll be using in our regression model, what other variables do you think would be useful to use in a model for house price?</p>
<p>Observe, for example, that while the <code>condition</code> variable has values <code>1</code> through <code>5</code>, these are saved in R as <code>fct</code> standing for “factors.” This is one of R’s ways of saving categorical variables. So you should think of these as the “labels” <code>1</code> through <code>5</code> and not the numerical values <code>1</code> through <code>5</code>.</p>
<p>Let’s now perform the second step in an EDA: computing summary statistics. Recall from Section <a href="#summarize"><strong>??</strong></a> that <em>summary statistics</em> are single numerical values that summarize a large number of values. Examples of summary statistics include the mean, the median, the standard deviation, and various percentiles.</p>
<p>We could do this using the <code>summarize()</code> function in the <strong>dplyr</strong> package along with R’s built-in <em>summary functions</em>, like <code>mean()</code> and <code>median()</code>. However, recall in Section <a href="visualization.html#mutate">1.12.6</a>, we saw the following code that computes a variety of summary statistics of the variable <code>gain</code>, which is the amount of time that a flight makes up mid-air:</p>
<div class="sourceCode" id="cb864"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb864-1"><a href="continuous-response.html#cb864-1"></a>gain_summary &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb864-2"><a href="continuous-response.html#cb864-2"></a><span class="st">  </span><span class="kw">summarize</span>(</span>
<span id="cb864-3"><a href="continuous-response.html#cb864-3"></a>    <span class="dt">min =</span> <span class="kw">min</span>(gain, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb864-4"><a href="continuous-response.html#cb864-4"></a>    <span class="dt">q1 =</span> <span class="kw">quantile</span>(gain, <span class="fl">0.25</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb864-5"><a href="continuous-response.html#cb864-5"></a>    <span class="dt">median =</span> <span class="kw">quantile</span>(gain, <span class="fl">0.5</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb864-6"><a href="continuous-response.html#cb864-6"></a>    <span class="dt">q3 =</span> <span class="kw">quantile</span>(gain, <span class="fl">0.75</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb864-7"><a href="continuous-response.html#cb864-7"></a>    <span class="dt">max =</span> <span class="kw">max</span>(gain, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb864-8"><a href="continuous-response.html#cb864-8"></a>    <span class="dt">mean =</span> <span class="kw">mean</span>(gain, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb864-9"><a href="continuous-response.html#cb864-9"></a>    <span class="dt">sd =</span> <span class="kw">sd</span>(gain, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb864-10"><a href="continuous-response.html#cb864-10"></a>    <span class="dt">missing =</span> <span class="kw">sum</span>(<span class="kw">is.na</span>(gain))</span>
<span id="cb864-11"><a href="continuous-response.html#cb864-11"></a>  )</span></code></pre></div>
<p>To repeat this for all three <code>price</code>, <code>sqft_living</code>, and <code>condition</code> variables would be tedious to code up. So instead, let’s use the convenient <code>skim()</code> function from the <strong>skimr</strong> package we first used in Subsection <a href="continuous-response.html#model4EDA">10.1.1</a>, being sure to only <code>select()</code> the variables of interest for our model:</p>
<!-- DDK: The current output does not include the p75 and p100 columns. Fixable? -->
<div class="sourceCode" id="cb865"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb865-1"><a href="continuous-response.html#cb865-1"></a>house_prices <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb865-2"><a href="continuous-response.html#cb865-2"></a><span class="st">  </span><span class="kw">select</span>(price, sqft_living, condition) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb865-3"><a href="continuous-response.html#cb865-3"></a><span class="st">  </span><span class="kw">skim</span>()</span></code></pre></div>
<table style="width: auto;" class="table table-condensed">
<caption>
<span id="tab:unnamed-chunk-663">TABLE 10.4: </span>Data summary
</caption>
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Name
</td>
<td style="text-align:left;">
Piped data
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of rows
</td>
<td style="text-align:left;">
21613
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of columns
</td>
<td style="text-align:left;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
_______________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Column type frequency:
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
factor
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
________________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Group variables
</td>
<td style="text-align:left;">
None
</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table>
<thead><tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:left;">
ordered
</th>
<th style="text-align:right;">
n_unique
</th>
<th style="text-align:left;">
top_counts
</th>
</tr></thead>
<tbody><tr>
<td style="text-align:left;">
condition
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
3: 14031, 4: 5679, 5: 1701, 2: 172
</td>
</tr></tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead><tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
p0
</th>
<th style="text-align:right;">
p25
</th>
<th style="text-align:right;">
p50
</th>
<th style="text-align:right;">
p75
</th>
<th style="text-align:right;">
p100
</th>
<th style="text-align:left;">
hist
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
price
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
540088
</td>
<td style="text-align:right;">
367127.2
</td>
<td style="text-align:right;">
75000
</td>
<td style="text-align:right;">
321950
</td>
<td style="text-align:right;">
450000
</td>
<td style="text-align:right;">
645000
</td>
<td style="text-align:right;">
7700000
</td>
<td style="text-align:left;">
▇▁▁▁▁
</td>
</tr>
<tr>
<td style="text-align:left;">
sqft_living
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2080
</td>
<td style="text-align:right;">
918.4
</td>
<td style="text-align:right;">
290
</td>
<td style="text-align:right;">
1427
</td>
<td style="text-align:right;">
1910
</td>
<td style="text-align:right;">
2550
</td>
<td style="text-align:right;">
13540
</td>
<td style="text-align:left;">
▇▂▁▁▁
</td>
</tr>
</tbody>
</table>
<p>Observe that the mean <code>price</code> of $540,088 is larger than the median of $450,000. This is because a small number of very expensive houses are inflating the average. In other words, there are “outlier” house prices in our dataset. (This fact will become even more apparent when we create our visualizations next.)</p>
<p>However, the median is not as sensitive to such outlier house prices. This is why news about the real estate market generally report median house prices and not mean/average house prices. We say here that the median is more <em>robust to outliers</em> than the mean. Similarly, while both the standard deviation and interquartile-range (IQR) are both measures of spread and variability, the IQR is more <em>robust to outliers</em>.</p>
<p>Let’s now perform the last of the three common steps in an exploratory data analysis: creating data visualizations. Let’s first create <em>univariate</em> visualizations. These are plots focusing on a single variable at a time. Since <code>price</code> and <code>sqft_living</code> are numerical variables, we can visualize their distributions using a <code>geom_histogram()</code> as seen in Section <a href="visualization.html#histograms">1.8</a> on histograms. On the other hand, since <code>condition</code> is categorical, we can visualize its distribution using a <code>geom_bar()</code>. Recall from Section <a href="#geombar"><strong>??</strong></a> on barplots that since <code>condition</code> is not “pre-counted”, we use a <code>geom_bar()</code> and not a <code>geom_col()</code>.</p>
<div class="sourceCode" id="cb866"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb866-1"><a href="continuous-response.html#cb866-1"></a><span class="co"># Histogram of house price:</span></span>
<span id="cb866-2"><a href="continuous-response.html#cb866-2"></a></span>
<span id="cb866-3"><a href="continuous-response.html#cb866-3"></a>house_prices <span class="op">%&gt;%</span></span>
<span id="cb866-4"><a href="continuous-response.html#cb866-4"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> price)) <span class="op">+</span></span>
<span id="cb866-5"><a href="continuous-response.html#cb866-5"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">color =</span> <span class="st">"white"</span>) <span class="op">+</span></span>
<span id="cb866-6"><a href="continuous-response.html#cb866-6"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">"price (USD)"</span>, <span class="dt">title =</span> <span class="st">"House price"</span>)</span>
<span id="cb866-7"><a href="continuous-response.html#cb866-7"></a></span>
<span id="cb866-8"><a href="continuous-response.html#cb866-8"></a><span class="co"># Histogram of sqft_living</span></span>
<span id="cb866-9"><a href="continuous-response.html#cb866-9"></a></span>
<span id="cb866-10"><a href="continuous-response.html#cb866-10"></a>house_prices <span class="op">%&gt;%</span></span>
<span id="cb866-11"><a href="continuous-response.html#cb866-11"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> sqft_living)) <span class="op">+</span></span>
<span id="cb866-12"><a href="continuous-response.html#cb866-12"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">color =</span> <span class="st">"white"</span>) <span class="op">+</span></span>
<span id="cb866-13"><a href="continuous-response.html#cb866-13"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">"living space (square feet)"</span>, <span class="dt">title =</span> <span class="st">"House size"</span>)</span>
<span id="cb866-14"><a href="continuous-response.html#cb866-14"></a></span>
<span id="cb866-15"><a href="continuous-response.html#cb866-15"></a><span class="co"># Barplot of condition:</span></span>
<span id="cb866-16"><a href="continuous-response.html#cb866-16"></a></span>
<span id="cb866-17"><a href="continuous-response.html#cb866-17"></a>house_prices <span class="op">%&gt;%</span></span>
<span id="cb866-18"><a href="continuous-response.html#cb866-18"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> condition)) <span class="op">+</span></span>
<span id="cb866-19"><a href="continuous-response.html#cb866-19"></a><span class="st">  </span><span class="kw">geom_bar</span>() <span class="op">+</span></span>
<span id="cb866-20"><a href="continuous-response.html#cb866-20"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">"condition"</span>, <span class="dt">title =</span> <span class="st">"House condition"</span>)</span></code></pre></div>
<p>In Figure <a href="#fig:house-prices-viz"><strong>??</strong></a>, we display all three of these visualizations at once.</p>
<div class="figure">
<span id="fig:unnamed-chunk-665"></span>
<p class="caption marginnote shownote">
FIGURE 10.7: Exploratory visualizations of Seattle house prices data.
</p>
<img src="book_temp_files/figure-html/unnamed-chunk-665-1.png" alt="Exploratory visualizations of Seattle house prices data." width="672">
</div>
<p>First, observe in the bottom plot that most houses are of condition “3”, with a few more of conditions “4” and “5”, and almost none that are “1” or “2”.</p>
<p>Next, observe in the histogram for <code>price</code> in the top-left plot that a majority of houses are less than two million dollars. Observe also that the x-axis stretches out to 8 million dollars, even though there does not appear to be any houses close to that price. This is because there are a <em>very small number</em> of houses with prices closer to 8 million. These are the outlier house prices we mentioned earlier. We say that the variable <code>price</code> is <em>right-skewed</em> as exhibited by the long right tail.</p>
<p>Further, observe in the histogram of <code>sqft_living</code> in the middle plot as well that most houses appear to have less than 5000 square feet of living space. For comparison, a football field in the US is about 57,600 square feet, whereas a standard soccer/association football field is about 64,000 square feet. Observe also that this variable is also right-skewed, although not as drastically as the <code>price</code> variable.</p>
<p>For both the <code>price</code> and <code>sqft_living</code> variables, the right-skew makes distinguishing houses at the lower end of the x-axis hard. This is because the scale of the x-axis is compressed by the small number of quite expensive and immensely-sized houses.</p>
<p>So what can we do about this skew? Let’s apply a <em>log10 transformation</em> to these variables. A log transformations allow us to alter the scale of a variable to focus on <em>multiplicative</em> changes instead of <em>additive</em> changes. In other words, they shift the view to be on <em>relative</em> changes instead of <em>absolute</em> changes. Such multiplicative/relative changes are also called changes in <em>orders of magnitude</em>.</p>
<p>Let’s create new log10 transformed versions of the right-skewed variable <code>price</code> and <code>sqft_living</code> using the <code>mutate()</code> function from Section <a href="visualization.html#mutate">1.12.6</a>, but we’ll give the latter the name <code>log10_size</code>, which is shorter and easier to understand than the name <code>log10_sqft_living</code>.</p>
<div class="sourceCode" id="cb867"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb867-1"><a href="continuous-response.html#cb867-1"></a>house_prices &lt;-<span class="st"> </span>house_prices <span class="op">%&gt;%</span></span>
<span id="cb867-2"><a href="continuous-response.html#cb867-2"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb867-3"><a href="continuous-response.html#cb867-3"></a>    <span class="dt">log10_price =</span> <span class="kw">log10</span>(price),</span>
<span id="cb867-4"><a href="continuous-response.html#cb867-4"></a>    <span class="dt">log10_size =</span> <span class="kw">log10</span>(sqft_living)</span>
<span id="cb867-5"><a href="continuous-response.html#cb867-5"></a>    )</span></code></pre></div>
<p>Let’s display the before and after effects of this transformation on these variables for only the first 10 rows of <code>house_prices</code>:</p>
<div class="sourceCode" id="cb868"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb868-1"><a href="continuous-response.html#cb868-1"></a>house_prices <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb868-2"><a href="continuous-response.html#cb868-2"></a><span class="st">  </span><span class="kw">select</span>(price, log10_price, sqft_living, log10_size)</span></code></pre></div>
<pre><code>## # A tibble: 21,613 x 4
##      price log10_price sqft_living log10_size
##      &lt;dbl&gt;       &lt;dbl&gt;       &lt;int&gt;      &lt;dbl&gt;
##  1  221900        5.35        1180       3.07
##  2  538000        5.73        2570       3.41
##  3  180000        5.26         770       2.89
##  4  604000        5.78        1960       3.29
##  5  510000        5.71        1680       3.23
##  6 1225000        6.09        5420       3.73
##  7  257500        5.41        1715       3.23
##  8  291850        5.47        1060       3.03
##  9  229500        5.36        1780       3.25
## 10  323000        5.51        1890       3.28
## # … with 21,603 more rows</code></pre>
<p>Observe in particular the houses in the sixth and third rows. The house in the sixth row has <code>price</code> $1,225,000, which is just above one million dollars. Since <span class="math inline">\(10^6\)</span> is one million, its <code>log10_price</code> is around 6.09.</p>
<p>Contrast this with all other houses with <code>log10_price</code> less than six, since they all have <code>price</code> less than $1,000,000. The house in the third row is the only house with <code>sqft_living</code> less than 1,000. Since <span class="math inline">\(1,000 = 10^3\)</span>, it’s the lone house with <code>log10_size</code> less than 3.</p>
<p>Let’s now visualize the before and after effects of this transformation for <code>price</code> in Figure <a href="#fig:log10-price-viz"><strong>??</strong></a>.</p>
<div class="sourceCode" id="cb870"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb870-1"><a href="continuous-response.html#cb870-1"></a><span class="co"># Before log10 transformation:</span></span>
<span id="cb870-2"><a href="continuous-response.html#cb870-2"></a></span>
<span id="cb870-3"><a href="continuous-response.html#cb870-3"></a>house_prices <span class="op">%&gt;%</span></span>
<span id="cb870-4"><a href="continuous-response.html#cb870-4"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> price)) <span class="op">+</span></span>
<span id="cb870-5"><a href="continuous-response.html#cb870-5"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">color =</span> <span class="st">"white"</span>) <span class="op">+</span></span>
<span id="cb870-6"><a href="continuous-response.html#cb870-6"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">"price (USD)"</span>, <span class="dt">title =</span> <span class="st">"House price: Before"</span>)</span>
<span id="cb870-7"><a href="continuous-response.html#cb870-7"></a></span>
<span id="cb870-8"><a href="continuous-response.html#cb870-8"></a><span class="co"># After log10 transformation:</span></span>
<span id="cb870-9"><a href="continuous-response.html#cb870-9"></a></span>
<span id="cb870-10"><a href="continuous-response.html#cb870-10"></a>house_prices <span class="op">%&gt;%</span></span>
<span id="cb870-11"><a href="continuous-response.html#cb870-11"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> log10_price)) <span class="op">+</span></span>
<span id="cb870-12"><a href="continuous-response.html#cb870-12"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">color =</span> <span class="st">"white"</span>) <span class="op">+</span></span>
<span id="cb870-13"><a href="continuous-response.html#cb870-13"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">"log10 price (USD)"</span>, <span class="dt">title =</span> <span class="st">"House price: After"</span>)</span></code></pre></div>
<div class="figure">
<span id="fig:unnamed-chunk-669"></span>
<p class="caption marginnote shownote">
FIGURE 10.8: House price before and after log10 transformation.
</p>
<img src="book_temp_files/figure-html/unnamed-chunk-669-1.png" alt="House price before and after log10 transformation." width="672">
</div>
<p>Observe that after the transformation, the distribution is much less skewed, and in this case, more symmetric and more bell-shaped. Now you can more easily distinguish the lower priced houses.</p>
<p>Let’s do the same for house size, where the variable <code>sqft_living</code> was log10 transformed to <code>log10_size</code>.</p>
<div class="sourceCode" id="cb871"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb871-1"><a href="continuous-response.html#cb871-1"></a><span class="co"># Before log10 transformation:</span></span>
<span id="cb871-2"><a href="continuous-response.html#cb871-2"></a></span>
<span id="cb871-3"><a href="continuous-response.html#cb871-3"></a>house_prices <span class="op">%&gt;%</span></span>
<span id="cb871-4"><a href="continuous-response.html#cb871-4"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> sqft_living)) <span class="op">+</span></span>
<span id="cb871-5"><a href="continuous-response.html#cb871-5"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">color =</span> <span class="st">"white"</span>) <span class="op">+</span></span>
<span id="cb871-6"><a href="continuous-response.html#cb871-6"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">"living space (square feet)"</span>, <span class="dt">title =</span> <span class="st">"House size: Before"</span>)</span>
<span id="cb871-7"><a href="continuous-response.html#cb871-7"></a></span>
<span id="cb871-8"><a href="continuous-response.html#cb871-8"></a><span class="co"># After log10 transformation:</span></span>
<span id="cb871-9"><a href="continuous-response.html#cb871-9"></a></span>
<span id="cb871-10"><a href="continuous-response.html#cb871-10"></a>house_prices <span class="op">%&gt;%</span></span>
<span id="cb871-11"><a href="continuous-response.html#cb871-11"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> log10_size)) <span class="op">+</span></span>
<span id="cb871-12"><a href="continuous-response.html#cb871-12"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">color =</span> <span class="st">"white"</span>) <span class="op">+</span></span>
<span id="cb871-13"><a href="continuous-response.html#cb871-13"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">"log10 living space (square feet)"</span>, <span class="dt">title =</span> <span class="st">"House size: After"</span>)</span></code></pre></div>
<div class="figure">
<span id="fig:unnamed-chunk-671"></span>
<p class="caption marginnote shownote">
FIGURE 10.9: House size before and after log10 transformation.
</p>
<img src="book_temp_files/figure-html/unnamed-chunk-671-1.png" alt="House size before and after log10 transformation." width="672">
</div>
<p>Observe in Figure <a href="#fig:log10-size-viz"><strong>??</strong></a> that the log10 transformation has a similar effect of unskewing the variable. We emphasize that while in these two cases the resulting distributions are more symmetric and bell-shaped, this is not always necessarily the case.</p>
<p>Given the now symmetric nature of <code>log10_price</code> and <code>log10_size</code>, we are going to revise our multiple regression model to use our new variables:</p>
<ol style="list-style-type: decimal">
<li>The outcome variable <span class="math inline">\(y\)</span> is the sale <code>log10_price</code> of houses.</li>
<li>Two explanatory variables:
<ol style="list-style-type: decimal">
<li>A numerical explanatory variable <span class="math inline">\(x_1\)</span>: house size <code>log10_size</code> as measured in log base 10 square feet of living space.</li>
<li>A categorical explanatory variable <span class="math inline">\(x_2\)</span>: house <code>condition</code>, a categorical variable with five levels where <code>1</code> indicates “poor” and <code>5</code> indicates “excellent.”</li>
</ol>
</li>
</ol>
</div>
<div id="house-prices-EDA-II" class="section level3">
<h3>
<span class="header-section-number">10.3.2</span> Exploratory data analysis: Part II</h3>
<p>Let’s now continue our EDA by creating <em>multivariate</em> visualizations. Unlike the <em>univariate</em> histograms and barplot in the earlier Figures <a href="#fig:house-prices-viz"><strong>??</strong></a>, <a href="#fig:log10-price-viz"><strong>??</strong></a>, and <a href="#fig:log10-size-viz"><strong>??</strong></a>, <em>multivariate</em> visualizations show relationships between more than one variable. This is an important step of an EDA to perform since the goal of modeling is to explore relationships between variables.</p>
<p>Since our model involves a numerical outcome variable, a numerical explanatory variable, and a categorical explanatory variable, we are in a similar regression modeling situation as in Section <a href="continuous-response.html#model4">10.1</a> where we studied the UT Austin teaching scores dataset. Recall in that case the numerical outcome variable was teaching <code>income</code>, the numerical explanatory variable was subject <code>age</code>, and the categorical explanatory variable was (binary) <code>gender</code>.</p>
<p>We thus have two choices of models we can fit: either (1) an <em>interaction model</em> where the regression line for each <code>condition</code> level will have both a different slope and a different intercept or (2) a <em>parallel slopes model</em> where the regression line for each <code>condition</code> level will have the same slope but different intercepts. We plot both resulting models below, with the interaction model on the left.</p>
<div class="sourceCode" id="cb872"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb872-1"><a href="continuous-response.html#cb872-1"></a><span class="co"># Plot interaction model</span></span>
<span id="cb872-2"><a href="continuous-response.html#cb872-2"></a></span>
<span id="cb872-3"><a href="continuous-response.html#cb872-3"></a>house_prices <span class="op">%&gt;%</span></span>
<span id="cb872-4"><a href="continuous-response.html#cb872-4"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> log10_size, <span class="dt">y =</span> log10_price, <span class="dt">col =</span> condition)) <span class="op">+</span></span>
<span id="cb872-5"><a href="continuous-response.html#cb872-5"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.05</span>) <span class="op">+</span></span>
<span id="cb872-6"><a href="continuous-response.html#cb872-6"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">"lm"</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb872-7"><a href="continuous-response.html#cb872-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">"log10 price"</span>, </span>
<span id="cb872-8"><a href="continuous-response.html#cb872-8"></a>       <span class="dt">x =</span> <span class="st">"log10 size"</span>, </span>
<span id="cb872-9"><a href="continuous-response.html#cb872-9"></a>       <span class="dt">title =</span> <span class="st">"House prices in Seattle"</span>)</span>
<span id="cb872-10"><a href="continuous-response.html#cb872-10"></a></span>
<span id="cb872-11"><a href="continuous-response.html#cb872-11"></a><span class="co"># Plot parallel slopes model</span></span>
<span id="cb872-12"><a href="continuous-response.html#cb872-12"></a></span>
<span id="cb872-13"><a href="continuous-response.html#cb872-13"></a>house_prices <span class="op">%&gt;%</span></span>
<span id="cb872-14"><a href="continuous-response.html#cb872-14"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> log10_size, <span class="dt">y =</span> log10_price, <span class="dt">col =</span> condition)) <span class="op">+</span></span>
<span id="cb872-15"><a href="continuous-response.html#cb872-15"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.05</span>) <span class="op">+</span></span>
<span id="cb872-16"><a href="continuous-response.html#cb872-16"></a><span class="st">  </span><span class="kw">geom_parallel_slopes</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb872-17"><a href="continuous-response.html#cb872-17"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">"log10 price"</span>, </span>
<span id="cb872-18"><a href="continuous-response.html#cb872-18"></a>       <span class="dt">x =</span> <span class="st">"log10 size"</span>, </span>
<span id="cb872-19"><a href="continuous-response.html#cb872-19"></a>       <span class="dt">title =</span> <span class="st">"House prices in Seattle"</span>)</span></code></pre></div>
<div class="figure">
<span id="fig:unnamed-chunk-673"></span>
<p class="caption marginnote shownote">
FIGURE 10.10: Interaction and parallel slopes models.
</p>
<img src="book_temp_files/figure-html/unnamed-chunk-673-1.png" alt="Interaction and parallel slopes models." width="672">
</div>
<p>In both cases, we see there is a positive relationship between house price and size, meaning as houses are larger, they tend to be more expensive. Furthermore, in both plots it seems that houses of condition 5 tend to be the most expensive for most house sizes as evidenced by the fact that the line for condition 5 is highest, followed by conditions 4 and 3. As for conditions 1 and 2, this pattern isn’t as clear. Recall from the univariate barplot of <code>condition</code> in Figure <a href="#fig:house-prices-viz"><strong>??</strong></a>, there are only a few houses of condition 1 or 2.</p>
<p>Let’s also show a faceted version of just the interaction model in Figure <a href="#fig:house-price-interaction-2"><strong>??</strong></a>. It is now much more apparent just how few houses are of condition 1 or 2.</p>
<div class="sourceCode" id="cb873"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb873-1"><a href="continuous-response.html#cb873-1"></a>house_prices <span class="op">%&gt;%</span></span>
<span id="cb873-2"><a href="continuous-response.html#cb873-2"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> log10_size, <span class="dt">y =</span> log10_price, <span class="dt">col =</span> condition)) <span class="op">+</span></span>
<span id="cb873-3"><a href="continuous-response.html#cb873-3"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.4</span>) <span class="op">+</span></span>
<span id="cb873-4"><a href="continuous-response.html#cb873-4"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">"lm"</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb873-5"><a href="continuous-response.html#cb873-5"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">"log10 price"</span>, </span>
<span id="cb873-6"><a href="continuous-response.html#cb873-6"></a>       <span class="dt">x =</span> <span class="st">"log10 size"</span>, </span>
<span id="cb873-7"><a href="continuous-response.html#cb873-7"></a>       <span class="dt">title =</span> <span class="st">"House prices in Seattle"</span>) <span class="op">+</span></span>
<span id="cb873-8"><a href="continuous-response.html#cb873-8"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>condition)</span></code></pre></div>
<div class="figure">
<span id="fig:unnamed-chunk-675"></span>
<p class="caption marginnote shownote">
FIGURE 10.11: Faceted plot of interaction model.
</p>
<img src="book_temp_files/figure-html/unnamed-chunk-675-1.png" alt="Faceted plot of interaction model." width="672">
</div>
</div>
<div id="house-prices-regression" class="section level3">
<h3>
<span class="header-section-number">10.3.3</span> Regression modeling</h3>
<p>What are the five different slopes and five different intercepts for the interaction model? We can obtain these values from the regression table. Recall our two-step process for getting the regression table:</p>
<div class="sourceCode" id="cb874"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb874-1"><a href="continuous-response.html#cb874-1"></a><span class="co"># Fit regression model:</span></span>
<span id="cb874-2"><a href="continuous-response.html#cb874-2"></a></span>
<span id="cb874-3"><a href="continuous-response.html#cb874-3"></a>price_interaction &lt;-<span class="st"> </span><span class="kw">lm</span>(log10_price <span class="op">~</span><span class="st"> </span>log10_size <span class="op">*</span><span class="st"> </span>condition, </span>
<span id="cb874-4"><a href="continuous-response.html#cb874-4"></a>                        <span class="dt">data =</span> house_prices)</span>
<span id="cb874-5"><a href="continuous-response.html#cb874-5"></a></span>
<span id="cb874-6"><a href="continuous-response.html#cb874-6"></a><span class="co"># Get regression table:</span></span>
<span id="cb874-7"><a href="continuous-response.html#cb874-7"></a></span>
<span id="cb874-8"><a href="continuous-response.html#cb874-8"></a>price_interaction <span class="op">%&gt;%</span></span>
<span id="cb874-9"><a href="continuous-response.html#cb874-9"></a><span class="st">  </span><span class="kw">tidy</span>(<span class="dt">conf.int =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb874-10"><a href="continuous-response.html#cb874-10"></a><span class="st">  </span><span class="kw">select</span>(term, estimate, conf.low, conf.high)</span></code></pre></div>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#hlywxfzgsj .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#hlywxfzgsj .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hlywxfzgsj .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#hlywxfzgsj .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#hlywxfzgsj .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hlywxfzgsj .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hlywxfzgsj .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#hlywxfzgsj .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#hlywxfzgsj .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#hlywxfzgsj .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#hlywxfzgsj .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#hlywxfzgsj .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#hlywxfzgsj .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#hlywxfzgsj .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#hlywxfzgsj .gt_from_md > :first-child {
  margin-top: 0;
}

#hlywxfzgsj .gt_from_md > :last-child {
  margin-bottom: 0;
}

#hlywxfzgsj .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#hlywxfzgsj .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#hlywxfzgsj .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hlywxfzgsj .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#hlywxfzgsj .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hlywxfzgsj .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#hlywxfzgsj .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hlywxfzgsj .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hlywxfzgsj .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#hlywxfzgsj .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hlywxfzgsj .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#hlywxfzgsj .gt_left {
  text-align: left;
}

#hlywxfzgsj .gt_center {
  text-align: center;
}

#hlywxfzgsj .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#hlywxfzgsj .gt_font_normal {
  font-weight: normal;
}

#hlywxfzgsj .gt_font_bold {
  font-weight: bold;
}

#hlywxfzgsj .gt_font_italic {
  font-style: italic;
}

#hlywxfzgsj .gt_super {
  font-size: 65%;
}

#hlywxfzgsj .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="hlywxfzgsj" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
<thead class="gt_header">
<tr>
<th colspan="4" class="gt_heading gt_title gt_font_normal" style>Regression table for interaction model</th>
    </tr>
<tr>
<th colspan="4" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
</thead>
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">term</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">estimate</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">conf.low</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">conf.high</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_left">(Intercept)</td>
      <td class="gt_row gt_right">3.33046</td>
      <td class="gt_row gt_right">2.44593</td>
      <td class="gt_row gt_right">4.2150</td>
    </tr>
<tr>
<td class="gt_row gt_left">log10_size</td>
      <td class="gt_row gt_right">0.68953</td>
      <td class="gt_row gt_right">0.39899</td>
      <td class="gt_row gt_right">0.9801</td>
    </tr>
<tr>
<td class="gt_row gt_left">condition2</td>
      <td class="gt_row gt_right">0.04696</td>
      <td class="gt_row gt_right">-0.92978</td>
      <td class="gt_row gt_right">1.0237</td>
    </tr>
<tr>
<td class="gt_row gt_left">condition3</td>
      <td class="gt_row gt_right">-0.36701</td>
      <td class="gt_row gt_right">-1.25290</td>
      <td class="gt_row gt_right">0.5189</td>
    </tr>
<tr>
<td class="gt_row gt_left">condition4</td>
      <td class="gt_row gt_right">-0.39817</td>
      <td class="gt_row gt_right">-1.28647</td>
      <td class="gt_row gt_right">0.4901</td>
    </tr>
<tr>
<td class="gt_row gt_left">condition5</td>
      <td class="gt_row gt_right">-0.88304</td>
      <td class="gt_row gt_right">-1.77927</td>
      <td class="gt_row gt_right">0.0132</td>
    </tr>
<tr>
<td class="gt_row gt_left">log10_size:condition2</td>
      <td class="gt_row gt_right">-0.02416</td>
      <td class="gt_row gt_right">-0.34373</td>
      <td class="gt_row gt_right">0.2954</td>
    </tr>
<tr>
<td class="gt_row gt_left">log10_size:condition3</td>
      <td class="gt_row gt_right">0.13259</td>
      <td class="gt_row gt_right">-0.15833</td>
      <td class="gt_row gt_right">0.4235</td>
    </tr>
<tr>
<td class="gt_row gt_left">log10_size:condition4</td>
      <td class="gt_row gt_right">0.14563</td>
      <td class="gt_row gt_right">-0.14599</td>
      <td class="gt_row gt_right">0.4373</td>
    </tr>
<tr>
<td class="gt_row gt_left">log10_size:condition5</td>
      <td class="gt_row gt_right">0.30987</td>
      <td class="gt_row gt_right">0.01599</td>
      <td class="gt_row gt_right">0.6037</td>
    </tr>
</tbody>
</table></div>
<p>Recall we saw in Subsection <a href="continuous-response.html#model4interactiontable">10.1.2</a> how to interpret a regression table when there are both numerical and categorical explanatory variables. Let’s now do the same for all 10 values in the <code>estimate</code> column of Table <a href="#tab:seattle-interaction"><strong>??</strong></a>.</p>
<p>In this case, the “baseline for comparison” group for the categorical variable <code>condition</code> are the condition 1 houses, since “1” comes first alphanumerically. Thus, the <code>intercept</code> and <code>log10_size</code> values are the intercept and slope for <code>log10_size</code> for this baseline group. Next, the <code>condition2</code> through <code>condition5</code> terms are the <em>offsets</em> in intercepts relative to the condition 1 intercept. Finally, the <code>log10_size:condition2</code> through <code>log10_size:condition5</code> are the <em>offsets</em> in slopes for <code>log10_size</code> relative to the condition 1 slope for <code>log10_size</code>.</p>
<p>Let’s simplify this by writing out the equation of each of the five regression lines using these 10 <code>estimate</code> values. We’ll write out each line in the following format:</p>
<p><span class="math display">\[
\widehat{\log10(\text{price})} = \hat{\beta}_0 + \hat{\beta}_{\text{size}} \cdot \log10(\text{size})
\]</span></p>
<ol style="list-style-type: decimal">
<li>Condition 1:</li>
</ol>
<p><span class="math display">\[\widehat{\log10(\text{price})} = 3.33 + 0.69 \cdot \log10(\text{size})\]</span></p>
<ol start="2" style="list-style-type: decimal">
<li>Condition 2:</li>
</ol>
<p><span class="math display">\[
\begin{aligned} 
\widehat{\log10(\text{price})} &amp;= (3.33 + 0.047) + (0.69 - 0.024) \cdot \log10(\text{size}) \\ 
                               &amp;= 3.377 + 0.666 \cdot \log10(\text{size})
\end{aligned}
\]</span></p>
<ol start="3" style="list-style-type: decimal">
<li>Condition 3:</li>
</ol>
<p><span class="math display">\[
\begin{aligned} 
\widehat{\log10(\text{price})} &amp;= (3.33 - 0.367) + (0.69 + 0.133) \cdot \log10(\text{size}) \\
                               &amp;= 2.963 + 0.823 \cdot \log10(\text{size})
\end{aligned}
\]</span></p>
<ol start="4" style="list-style-type: decimal">
<li>Condition 4:</li>
</ol>
<p><span class="math display">\[
\begin{aligned}
\widehat{\log10(\text{price})} &amp;= (3.33 - 0.398) + (0.69 + 0.146) \cdot \log10(\text{size}) \\
                               &amp;= 2.932 + 0.836 \cdot \log10(\text{size})
\end{aligned}
\]</span></p>
<ol start="5" style="list-style-type: decimal">
<li>Condition 5:</li>
</ol>
<p><span class="math display">\[
\begin{aligned}
\widehat{\log10(\text{price})} &amp;= (3.33 - 0.883) + (0.69 + 0.31) \cdot \log10(\text{size}) \\
                               &amp;= 2.447 + 1 \cdot \log10(\text{size})
\end{aligned}
\]</span></p>
<p>These correspond to the regression lines in the left-hand plot of Figure <a href="#fig:house-price-parallel-slopes"><strong>??</strong></a> and the faceted plot in Figure <a href="#fig:house-price-interaction-2"><strong>??</strong></a>. For homes of all five condition types, as the size of the house increases, the price increases. This is what most would expect. However, the rate of increase of price with size is fastest for the homes with conditions 3, 4, and 5 of 0.823, 0.836, and 1, respectively. These are the three largest slopes out of the five.</p>
</div>
<div id="house-prices-making-predictions" class="section level3">
<h3>
<span class="header-section-number">10.3.4</span> Making predictions</h3>
<p>Say you’re a realtor and someone calls you asking you how much their home will sell for. They tell you that it’s in condition = 5 and is sized 1900 square feet. What do you tell them? Let’s use the interaction model we fit to make predictions!</p>
<p>We first make this prediction visually in Figure <a href="#fig:house-price-interaction-3"><strong>??</strong></a>. The predicted <code>log10_price</code> of this house is marked with a black dot. This is where the following two lines intersect:</p>
<ul>
<li>The regression line for the condition = 5 homes and</li>
<li>The vertical dashed black line at <code>log10_size</code> equals 3.28, since our predictor variable is the log10 transformed square feet of living space of <span class="math inline">\(\log10(1900) = 3.28\)</span>.</li>
</ul>
<div class="figure">
<span id="fig:unnamed-chunk-678"></span>
<p class="caption marginnote shownote">
FIGURE 10.12: Interaction model with prediction.
</p>
<img src="book_temp_files/figure-html/unnamed-chunk-678-1.png" alt="Interaction model with prediction." width="672">
</div>
<p>Eyeballing it, it seems the predicted <code>log10_price</code> seems to be around 5.75. Let’s now obtain the exact numerical value for the prediction using the equation of the regression line for the condition = 5 houses, being sure to <code>log10()</code> the square footage first.</p>
<div class="sourceCode" id="cb875"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb875-1"><a href="continuous-response.html#cb875-1"></a><span class="fl">2.45</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">*</span><span class="st"> </span><span class="kw">log10</span>(<span class="dv">1900</span>)</span></code></pre></div>
<pre><code>## [1] 5.729</code></pre>
<p>This value is very close to our earlier visually made prediction of 5.75. But wait! Is our prediction for the price of this house $5.75? No! Remember that we are using <code>log10_price</code> as our outcome variable! So, if we want a prediction in dollar units of <code>price</code>, we need to unlog this by taking a power of 10.</p>
<div class="sourceCode" id="cb877"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb877-1"><a href="continuous-response.html#cb877-1"></a><span class="dv">10</span><span class="op">^</span>(<span class="fl">2.45</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">*</span><span class="st"> </span><span class="kw">log10</span>(<span class="dv">1900</span>))</span></code></pre></div>
<pre><code>## [1] 535493</code></pre>
<p>So our predicted price for this home of condition 5 and of size 1900 square feet is $535,493.</p>
</div>
<div id="fitting-many-models-using-map" class="section level3">
<h3>
<span class="header-section-number">10.3.5</span> Fitting many models using <code>map()</code>
</h3>
<p>Much like we did with the gubernatorial forecasts in the last chapter, we can now use <code>map_*</code> functions to estimate many models using our house prices data.</p>
<p>How well do size and condition predict house prices for older houses versus newer ones? That’s difficult to visualize without using <code>map_*</code> functions. But by using <code>map()</code> and list columns, we can learn a lot we couldn’t otherwise.</p>
<p>Let’s start by <code>filter</code>ing our data to houses built before 2000 (since there is little variation in <code>condition</code> for more recently built houses) and <code>nest()</code> by <code>yr_built</code>:</p>
<div class="sourceCode" id="cb879"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb879-1"><a href="continuous-response.html#cb879-1"></a>house_prices <span class="op">%&gt;%</span></span>
<span id="cb879-2"><a href="continuous-response.html#cb879-2"></a><span class="st">  </span><span class="kw">filter</span>(yr_built <span class="op">&lt;</span><span class="st"> </span><span class="dv">2000</span>) <span class="op">%&gt;%</span></span>
<span id="cb879-3"><a href="continuous-response.html#cb879-3"></a><span class="st">  </span><span class="kw">group_by</span>(yr_built) <span class="op">%&gt;%</span></span>
<span id="cb879-4"><a href="continuous-response.html#cb879-4"></a><span class="st">  </span><span class="kw">nest</span>()</span></code></pre></div>
<pre><code>## # A tibble: 100 x 2
## # Groups:   yr_built [100]
##    yr_built data               
##       &lt;int&gt; &lt;list&gt;             
##  1     1955 &lt;tibble [271 × 22]&gt;
##  2     1951 &lt;tibble [229 × 22]&gt;
##  3     1933 &lt;tibble [30 × 22]&gt; 
##  4     1965 &lt;tibble [187 × 22]&gt;
##  5     1987 &lt;tibble [294 × 22]&gt;
##  6     1995 &lt;tibble [169 × 22]&gt;
##  7     1963 &lt;tibble [256 × 22]&gt;
##  8     1960 &lt;tibble [248 × 22]&gt;
##  9     1942 &lt;tibble [223 × 22]&gt;
## 10     1927 &lt;tibble [115 × 22]&gt;
## # … with 90 more rows</code></pre>
<p>Now that we have a list column <code>data</code> consisting of our data for each <code>yr_built</code>, we can use some familiar code to run a model for each year. Let’s simplify the model to the parallel slopes model, which we can implement with the formula <code>log10_price ~ log10_size + condition.</code> This simpler model may be a better choice since we have far fewer observations per model. (In general, the smaller your data, the greater concern you should have that you are “overfitting” by including too many predictors.)</p>
<p>Let’s start by saving our model object in the list column <code>mod</code> and the <code>tid</code>ied version of that in the list column <code>reg_results</code>:</p>
<div class="sourceCode" id="cb881"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb881-1"><a href="continuous-response.html#cb881-1"></a>house_prices <span class="op">%&gt;%</span></span>
<span id="cb881-2"><a href="continuous-response.html#cb881-2"></a><span class="st">  </span><span class="kw">filter</span>(yr_built <span class="op">&lt;</span><span class="st"> </span><span class="dv">2000</span>) <span class="op">%&gt;%</span></span>
<span id="cb881-3"><a href="continuous-response.html#cb881-3"></a><span class="st">  </span><span class="kw">group_by</span>(yr_built) <span class="op">%&gt;%</span></span>
<span id="cb881-4"><a href="continuous-response.html#cb881-4"></a><span class="st">  </span><span class="kw">nest</span>() <span class="op">%&gt;%</span></span>
<span id="cb881-5"><a href="continuous-response.html#cb881-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mod =</span> <span class="kw">map</span>(data, <span class="op">~</span><span class="st"> </span><span class="kw">lm</span>(log10_price <span class="op">~</span><span class="st"> </span>log10_size <span class="op">+</span><span class="st"> </span>condition, </span>
<span id="cb881-6"><a href="continuous-response.html#cb881-6"></a>                        <span class="dt">data =</span> .)),</span>
<span id="cb881-7"><a href="continuous-response.html#cb881-7"></a>         <span class="dt">reg_results =</span> <span class="kw">map</span>(mod, <span class="op">~</span><span class="st"> </span><span class="kw">tidy</span>(., <span class="dt">conf.int =</span> <span class="ot">TRUE</span>)))</span></code></pre></div>
<pre><code>## # A tibble: 100 x 4
## # Groups:   yr_built [100]
##    yr_built data                mod    reg_results     
##       &lt;int&gt; &lt;list&gt;              &lt;list&gt; &lt;list&gt;          
##  1     1955 &lt;tibble [271 × 22]&gt; &lt;lm&gt;   &lt;tibble [6 × 7]&gt;
##  2     1951 &lt;tibble [229 × 22]&gt; &lt;lm&gt;   &lt;tibble [5 × 7]&gt;
##  3     1933 &lt;tibble [30 × 22]&gt;  &lt;lm&gt;   &lt;tibble [6 × 7]&gt;
##  4     1965 &lt;tibble [187 × 22]&gt; &lt;lm&gt;   &lt;tibble [4 × 7]&gt;
##  5     1987 &lt;tibble [294 × 22]&gt; &lt;lm&gt;   &lt;tibble [5 × 7]&gt;
##  6     1995 &lt;tibble [169 × 22]&gt; &lt;lm&gt;   &lt;tibble [5 × 7]&gt;
##  7     1963 &lt;tibble [256 × 22]&gt; &lt;lm&gt;   &lt;tibble [5 × 7]&gt;
##  8     1960 &lt;tibble [248 × 22]&gt; &lt;lm&gt;   &lt;tibble [5 × 7]&gt;
##  9     1942 &lt;tibble [223 × 22]&gt; &lt;lm&gt;   &lt;tibble [6 × 7]&gt;
## 10     1927 &lt;tibble [115 × 22]&gt; &lt;lm&gt;   &lt;tibble [4 × 7]&gt;
## # … with 90 more rows</code></pre>
<p>Now let’s take a look at the effect of <code>log10_size_coef</code>. Note that when interpreting this coefficient that these models also include <code>condition</code>, and thus we are looking at the effect of size on price while <em>also</em> allowing the intercept to be offset by different levels of <code>condition</code>. <!-- AR: I don't love this talk of "offsets" -- conceptually, you are just estimating different intercepts for different levels of "condition" and the regression output *expresses* it in terms of offsets -- but this is how the book discusses it throughout and it would take considerable editing to change it. --></p>
<p>Here is the code to extract the coefficient on <code>log10_size_coef</code> as well as the confidence interval bounds:</p>
<div class="sourceCode" id="cb883"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb883-1"><a href="continuous-response.html#cb883-1"></a>house_year_model &lt;-<span class="st"> </span>house_prices <span class="op">%&gt;%</span></span>
<span id="cb883-2"><a href="continuous-response.html#cb883-2"></a><span class="st">  </span><span class="kw">filter</span>(yr_built <span class="op">&lt;</span><span class="st"> </span><span class="dv">2000</span>) <span class="op">%&gt;%</span></span>
<span id="cb883-3"><a href="continuous-response.html#cb883-3"></a><span class="st">  </span><span class="kw">group_by</span>(yr_built) <span class="op">%&gt;%</span></span>
<span id="cb883-4"><a href="continuous-response.html#cb883-4"></a><span class="st">  </span><span class="kw">nest</span>() <span class="op">%&gt;%</span></span>
<span id="cb883-5"><a href="continuous-response.html#cb883-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mod =</span> <span class="kw">map</span>(data, <span class="op">~</span><span class="st"> </span><span class="kw">lm</span>(log10_price <span class="op">~</span><span class="st"> </span>log10_size <span class="op">+</span><span class="st"> </span>condition, </span>
<span id="cb883-6"><a href="continuous-response.html#cb883-6"></a>                        <span class="dt">data =</span> .)),</span>
<span id="cb883-7"><a href="continuous-response.html#cb883-7"></a>         <span class="dt">reg_results =</span> <span class="kw">map</span>(mod, <span class="op">~</span><span class="st"> </span><span class="kw">tidy</span>(., <span class="dt">conf.int =</span> <span class="ot">TRUE</span>)),</span>
<span id="cb883-8"><a href="continuous-response.html#cb883-8"></a>         <span class="dt">log10_size_coef =</span> <span class="kw">map_dbl</span>(reg_results, <span class="op">~</span><span class="st"> </span><span class="kw">filter</span>(., term <span class="op">==</span><span class="st"> "log10_size"</span>) <span class="op">%&gt;%</span></span>
<span id="cb883-9"><a href="continuous-response.html#cb883-9"></a><span class="st">                                     </span><span class="kw">pull</span>(estimate)),</span>
<span id="cb883-10"><a href="continuous-response.html#cb883-10"></a>         <span class="dt">log10_size_low =</span> <span class="kw">map_dbl</span>(reg_results, <span class="op">~</span><span class="st"> </span><span class="kw">filter</span>(., term <span class="op">==</span><span class="st"> "log10_size"</span>) <span class="op">%&gt;%</span></span>
<span id="cb883-11"><a href="continuous-response.html#cb883-11"></a><span class="st">                                     </span><span class="kw">pull</span>(conf.low)),</span>
<span id="cb883-12"><a href="continuous-response.html#cb883-12"></a>         <span class="dt">log10_size_high =</span> <span class="kw">map_dbl</span>(reg_results, <span class="op">~</span><span class="st"> </span><span class="kw">filter</span>(., term <span class="op">==</span><span class="st"> "log10_size"</span>) <span class="op">%&gt;%</span></span>
<span id="cb883-13"><a href="continuous-response.html#cb883-13"></a><span class="st">                                     </span><span class="kw">pull</span>(conf.high)))</span>
<span id="cb883-14"><a href="continuous-response.html#cb883-14"></a></span>
<span id="cb883-15"><a href="continuous-response.html#cb883-15"></a>house_year_model</span></code></pre></div>
<pre><code>## # A tibble: 100 x 7
## # Groups:   yr_built [100]
##    yr_built data  mod   reg_results log10_size_coef log10_size_low
##       &lt;int&gt; &lt;lis&gt; &lt;lis&gt; &lt;list&gt;                &lt;dbl&gt;          &lt;dbl&gt;
##  1     1955 &lt;tib… &lt;lm&gt;  &lt;tibble [6…           0.745          0.621
##  2     1951 &lt;tib… &lt;lm&gt;  &lt;tibble [5…           0.912          0.785
##  3     1933 &lt;tib… &lt;lm&gt;  &lt;tibble [6…           1.34           1.08 
##  4     1965 &lt;tib… &lt;lm&gt;  &lt;tibble [4…           0.847          0.702
##  5     1987 &lt;tib… &lt;lm&gt;  &lt;tibble [5…           1.02           0.900
##  6     1995 &lt;tib… &lt;lm&gt;  &lt;tibble [5…           1.14           1.01 
##  7     1963 &lt;tib… &lt;lm&gt;  &lt;tibble [5…           0.986          0.837
##  8     1960 &lt;tib… &lt;lm&gt;  &lt;tibble [5…           0.919          0.789
##  9     1942 &lt;tib… &lt;lm&gt;  &lt;tibble [6…           0.622          0.483
## 10     1927 &lt;tib… &lt;lm&gt;  &lt;tibble [4…           0.818          0.657
## # … with 90 more rows, and 1 more variable: log10_size_high &lt;dbl&gt;</code></pre>
<p>The easiest way to see the results of these models is to plot the coefficients:</p>
<div class="sourceCode" id="cb885"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb885-1"><a href="continuous-response.html#cb885-1"></a>house_year_model <span class="op">%&gt;%</span></span>
<span id="cb885-2"><a href="continuous-response.html#cb885-2"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> yr_built, <span class="dt">y =</span> log10_size_coef, <span class="dt">ymin =</span> log10_size_low, <span class="dt">ymax =</span> log10_size_high)) <span class="op">+</span></span>
<span id="cb885-3"><a href="continuous-response.html#cb885-3"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb885-4"><a href="continuous-response.html#cb885-4"></a><span class="st">  </span><span class="kw">geom_errorbar</span>() <span class="op">+</span></span>
<span id="cb885-5"><a href="continuous-response.html#cb885-5"></a><span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span></span>
<span id="cb885-6"><a href="continuous-response.html#cb885-6"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">"Year built"</span>,</span>
<span id="cb885-7"><a href="continuous-response.html#cb885-7"></a>       <span class="dt">y =</span> <span class="st">"Effect of log 10 size on log 10 price"</span>,</span>
<span id="cb885-8"><a href="continuous-response.html#cb885-8"></a>       <span class="dt">title =</span> <span class="st">"Predicting house price with house size and condition"</span>,</span>
<span id="cb885-9"><a href="continuous-response.html#cb885-9"></a>       <span class="dt">subtitle =</span> <span class="st">"Regression coefficients for house size plotted by year"</span>)</span></code></pre></div>
<p><img src="book_temp_files/figure-html/unnamed-chunk-684-1.png" width="672"></p>
<p>We can learn a lot from this figure that would be hard to do if we just ran a single regression. For example, we see that the effect of house size (taking into account condition) follows no clear pattern for the first half of the twentieth century, but appears to increase throughout the second half of the twentieth century. The size of a house in Seattle is a much better predictor of its price in these models if the house was built in the 1990s than if the house was built in the 1940s.</p>
</div>
<div id="model-selection" class="section level3">
<h3>
<span class="header-section-number">10.3.6</span> Model selection</h3>
<p>Let’s go back to the two regression models above. Which of the two models - the interaction plot or the parallel slopes model - is “better”? You need to make a choice depending on what you want to convey, and own that choice, with including and discussing both also as an option as needed.</p>
<p>We should only favor more complex models if the additional complexity is <em>warranted</em>. In this case, the more complex model is the interaction model since it considers five intercepts and five slopes total. This is in contrast to the parallel slopes model which considers five intercepts but only one common slope.</p>
<p>Is the additional complexity of the interaction model warranted? Looking at the parallel slopes model, we’re of the opinion that it is, as evidenced by the slight x-like pattern to some of the lines, therefore focusing our analysis in the previous sections on the interaction model. This visual approach is somewhat subjective, however, so feel free to disagree!</p>
<p>When should we use an interaction model versus a parallel slopes model? Recall in Sections <a href="continuous-response.html#model4interactiontable">10.1.2</a> and <a href="continuous-response.html#model4table">10.1.4</a> we fit both interaction and parallel slopes models for the outcome variable <span class="math inline">\(y\)</span> (teaching score) using a numerical explanatory variable <span class="math inline">\(x_1\)</span> (age) and a categorical explanatory variable <span class="math inline">\(x_2\)</span> (gender recorded as a binary variable). We compared these models in Figure <a href="#fig:numxcatx-comparison"><strong>??</strong></a>, which we display again now.</p>
<pre><code>## `geom_smooth()` using formula 'y ~ x'</code></pre>
<div class="figure">
<span id="fig:unnamed-chunk-685"></span>
<p class="caption marginnote shownote">
FIGURE 10.13: Previously seen comparison of interaction and parallel slopes models.
</p>
<img src="book_temp_files/figure-html/unnamed-chunk-685-1.png" alt="Previously seen comparison of interaction and parallel slopes models." width="672">
</div>
<p>A lot of you might have asked yourselves: “Why would I force the lines to have parallel slopes (as seen in the right-hand plot) when they clearly have different slopes (as seen in the left-hand plot)?”.</p>
<p>The answer lies in a philosophical principle known as “Occam’s Razor.” It states that, “all other things being equal, simpler solutions are more likely to be correct than complex ones.” When viewed in a modeling framework, Occam’s Razor can be restated as, “all other things being equal, simpler models are to be preferred over complex ones.” In other words, we should only favor the more complex model if the additional complexity is <em>warranted</em>.</p>
<p>Let’s revisit the equations for the regression line for both the interaction and parallel slopes model:</p>
<p><span class="math display">\[
\begin{aligned}
\text{Interaction} &amp;: \hat{y} = \widehat{\text{income}} = b_0 + b_{\text{age}} \cdot \text{age} + b_{\text{male}} \cdot \mathbb{1}_{\text{is male}}(x) + \\
&amp; \qquad b_{\text{age,male}} \cdot \text{age} \cdot \mathbb{1}_{\text{is male}}\\
\text{Parallel slopes} &amp;: \hat{y} = \widehat{\text{income}} = b_0 + b_{\text{age}} \cdot \text{age} + b_{\text{male}} \cdot \mathbb{1}_{\text{is male}}(x)
\end{aligned}
\]</span></p>
<p>The interaction model is “more complex” in that there is an additional <span class="math inline">\(b_{\text{age,male}} \cdot \text{age} \cdot \mathbb{1}_{\text{is male}}\)</span> interaction term in the equation not present for the parallel slopes model. Or viewed alternatively, the regression table for the interaction model in Table <a href="#tab:regtable-interaction"><strong>??</strong></a> has <em>four</em> rows, whereas the regression table for the parallel slopes model in Table <a href="#tab:regtable-parallel-slopes"><strong>??</strong></a> has <em>three</em> rows. The question becomes: “Is this additional complexity warranted?”. In this case, it can be argued that this additional complexity is warranted, as evidenced by the clear x-shaped pattern of the two regression lines in the left-hand plot of Figure <a href="#fig:recall-parallel-vs-interaction"><strong>??</strong></a>.</p>
<!-- EC: Remove moderndive package -->
<p>However, let’s consider an example where the additional complexity might <em>not</em> be warranted. Let’s consider the <code>MA_schools</code> data included in the <strong>moderndive</strong> package which contains 2017 data on Massachusetts public high schools provided by the Massachusetts Department of Education. For more details, read the help file for this data by running <code>?MA_schools</code> in the console.</p>
<p>Let’s model the numerical outcome variable <span class="math inline">\(y\)</span>, average SAT math score for a given high school, as a function of two explanatory variables:</p>
<ol style="list-style-type: decimal">
<li>A numerical explanatory variable <span class="math inline">\(x_1\)</span>, the percentage of that high school’s student body that are economically disadvantaged and</li>
<li>A categorical explanatory variable <span class="math inline">\(x_2\)</span>, the school size as measured by enrollment: small (13-341 students), medium (342-541 students), and large (542-4264 students).</li>
</ol>
<p>Let’s create visualizations of both the interaction and parallel slopes model once again and display the output in Figure <a href="#fig:numxcatx-comparison-2"><strong>??</strong></a>. Recall from Subsection <a href="continuous-response.html#model4table">10.1.4</a> that the <code>geom_parallel_slopes()</code> function is a special purpose function included in the <strong>moderndive</strong> package, since the <code>geom_smooth()</code> method in the <code>ggplot2</code> package does not have a convenient way to plot parallel slopes models.</p>
<div class="sourceCode" id="cb887"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb887-1"><a href="continuous-response.html#cb887-1"></a><span class="co"># Interaction model</span></span>
<span id="cb887-2"><a href="continuous-response.html#cb887-2"></a></span>
<span id="cb887-3"><a href="continuous-response.html#cb887-3"></a>MA_schools <span class="op">%&gt;%</span></span>
<span id="cb887-4"><a href="continuous-response.html#cb887-4"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> perc_disadvan, <span class="dt">y =</span> average_sat_math, <span class="dt">color =</span> size)) <span class="op">+</span></span>
<span id="cb887-5"><a href="continuous-response.html#cb887-5"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.25</span>) <span class="op">+</span></span>
<span id="cb887-6"><a href="continuous-response.html#cb887-6"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">"lm"</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb887-7"><a href="continuous-response.html#cb887-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">"Percent economically disadvantaged"</span>, <span class="dt">y =</span> <span class="st">"Math SAT Score"</span>, </span>
<span id="cb887-8"><a href="continuous-response.html#cb887-8"></a>       <span class="dt">color =</span> <span class="st">"School size"</span>, <span class="dt">title =</span> <span class="st">"Interaction model"</span>)</span></code></pre></div>
<div class="sourceCode" id="cb888"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb888-1"><a href="continuous-response.html#cb888-1"></a><span class="co"># Parallel slopes model</span></span>
<span id="cb888-2"><a href="continuous-response.html#cb888-2"></a></span>
<span id="cb888-3"><a href="continuous-response.html#cb888-3"></a><span class="kw">ggplot</span>(MA_schools, </span>
<span id="cb888-4"><a href="continuous-response.html#cb888-4"></a>       <span class="kw">aes</span>(<span class="dt">x =</span> perc_disadvan, <span class="dt">y =</span> average_sat_math, <span class="dt">color =</span> size)) <span class="op">+</span></span>
<span id="cb888-5"><a href="continuous-response.html#cb888-5"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.25</span>) <span class="op">+</span></span>
<span id="cb888-6"><a href="continuous-response.html#cb888-6"></a><span class="st">  </span><span class="kw">geom_parallel_slopes</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb888-7"><a href="continuous-response.html#cb888-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">"Percent economically disadvantaged"</span>, <span class="dt">y =</span> <span class="st">"Math SAT Score"</span>, </span>
<span id="cb888-8"><a href="continuous-response.html#cb888-8"></a>       <span class="dt">color =</span> <span class="st">"School size"</span>, <span class="dt">title =</span> <span class="st">"Parallel slopes model"</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula 'y ~ x'</code></pre>
<div class="figure">
<span id="fig:unnamed-chunk-688"></span>
<p class="caption marginnote shownote">
FIGURE 10.14: Comparison of interaction and parallel slopes models for Massachusetts schools.
</p>
<img src="book_temp_files/figure-html/unnamed-chunk-688-1.png" alt="Comparison of interaction and parallel slopes models for Massachusetts schools." width="672">
</div>
<p>Look closely at the left-hand plot of Figure <a href="#fig:numxcatx-comparison-2"><strong>??</strong></a> corresponding to an interaction model. While the slopes are indeed different, they do not differ <em>by much</em> and are nearly identical. Now compare the left-hand plot with the right-hand plot corresponding to a parallel slopes model. The two models don’t appear all that different. So in this case, it can be argued that the additional complexity of the interaction model is <em>not warranted</em>. Thus following Occam’s Razor, we should prefer the “simpler” parallel slopes model. Let’s explicitly define what “simpler” means in this case. Let’s compare the regression tables for the interaction and parallel slopes models in Tables <a href="#tab:model2-interaction"><strong>??</strong></a> and <a href="#tab:model2-parallel-slopes"><strong>??</strong></a>.</p>
<div class="sourceCode" id="cb890"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb890-1"><a href="continuous-response.html#cb890-1"></a>model_<span class="dv">2</span>_interaction &lt;-<span class="st"> </span><span class="kw">lm</span>(average_sat_math <span class="op">~</span><span class="st"> </span>perc_disadvan <span class="op">*</span><span class="st"> </span>size, </span>
<span id="cb890-2"><a href="continuous-response.html#cb890-2"></a>                          <span class="dt">data =</span> MA_schools)</span>
<span id="cb890-3"><a href="continuous-response.html#cb890-3"></a>model_<span class="dv">2</span>_interaction <span class="op">%&gt;%</span></span>
<span id="cb890-4"><a href="continuous-response.html#cb890-4"></a><span class="st">  </span><span class="kw">tidy</span>(<span class="dt">conf.int =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb890-5"><a href="continuous-response.html#cb890-5"></a><span class="st">  </span><span class="kw">select</span>(term, estimate, conf.low, conf.high)</span></code></pre></div>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#fxnbmrvnfa .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#fxnbmrvnfa .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fxnbmrvnfa .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#fxnbmrvnfa .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#fxnbmrvnfa .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fxnbmrvnfa .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fxnbmrvnfa .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#fxnbmrvnfa .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#fxnbmrvnfa .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#fxnbmrvnfa .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#fxnbmrvnfa .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#fxnbmrvnfa .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#fxnbmrvnfa .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#fxnbmrvnfa .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#fxnbmrvnfa .gt_from_md > :first-child {
  margin-top: 0;
}

#fxnbmrvnfa .gt_from_md > :last-child {
  margin-bottom: 0;
}

#fxnbmrvnfa .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#fxnbmrvnfa .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#fxnbmrvnfa .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fxnbmrvnfa .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#fxnbmrvnfa .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fxnbmrvnfa .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#fxnbmrvnfa .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fxnbmrvnfa .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fxnbmrvnfa .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#fxnbmrvnfa .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fxnbmrvnfa .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#fxnbmrvnfa .gt_left {
  text-align: left;
}

#fxnbmrvnfa .gt_center {
  text-align: center;
}

#fxnbmrvnfa .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#fxnbmrvnfa .gt_font_normal {
  font-weight: normal;
}

#fxnbmrvnfa .gt_font_bold {
  font-weight: bold;
}

#fxnbmrvnfa .gt_font_italic {
  font-style: italic;
}

#fxnbmrvnfa .gt_super {
  font-size: 65%;
}

#fxnbmrvnfa .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="fxnbmrvnfa" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
<thead class="gt_header">
<tr>
<th colspan="4" class="gt_heading gt_title gt_font_normal" style>Interaction model regression table</th>
    </tr>
<tr>
<th colspan="4" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
</thead>
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">term</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">estimate</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">conf.low</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">conf.high</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_left">(Intercept)</td>
      <td class="gt_row gt_right">594.3274</td>
      <td class="gt_row gt_right">568.1860</td>
      <td class="gt_row gt_right">620.4688</td>
    </tr>
<tr>
<td class="gt_row gt_left">perc_disadvan</td>
      <td class="gt_row gt_right">-2.9319</td>
      <td class="gt_row gt_right">-3.5109</td>
      <td class="gt_row gt_right">-2.3529</td>
    </tr>
<tr>
<td class="gt_row gt_left">sizemedium</td>
      <td class="gt_row gt_right">-17.7637</td>
      <td class="gt_row gt_right">-48.8987</td>
      <td class="gt_row gt_right">13.3714</td>
    </tr>
<tr>
<td class="gt_row gt_left">sizelarge</td>
      <td class="gt_row gt_right">-13.2930</td>
      <td class="gt_row gt_right">-40.4661</td>
      <td class="gt_row gt_right">13.8801</td>
    </tr>
<tr>
<td class="gt_row gt_left">perc_disadvan:sizemedium</td>
      <td class="gt_row gt_right">0.1462</td>
      <td class="gt_row gt_right">-0.5846</td>
      <td class="gt_row gt_right">0.8769</td>
    </tr>
<tr>
<td class="gt_row gt_left">perc_disadvan:sizelarge</td>
      <td class="gt_row gt_right">0.1890</td>
      <td class="gt_row gt_right">-0.4460</td>
      <td class="gt_row gt_right">0.8240</td>
    </tr>
</tbody>
</table></div>
<div class="sourceCode" id="cb891"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb891-1"><a href="continuous-response.html#cb891-1"></a>model_<span class="dv">2</span>_parallel_slopes &lt;-<span class="st"> </span><span class="kw">lm</span>(average_sat_math <span class="op">~</span><span class="st"> </span>perc_disadvan <span class="op">+</span><span class="st"> </span>size, </span>
<span id="cb891-2"><a href="continuous-response.html#cb891-2"></a>                              <span class="dt">data =</span> MA_schools)</span>
<span id="cb891-3"><a href="continuous-response.html#cb891-3"></a>model_<span class="dv">2</span>_parallel_slopes <span class="op">%&gt;%</span></span>
<span id="cb891-4"><a href="continuous-response.html#cb891-4"></a><span class="st">  </span><span class="kw">tidy</span>(<span class="dt">conf.int =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb891-5"><a href="continuous-response.html#cb891-5"></a><span class="st">  </span><span class="kw">select</span>(term, estimate, conf.low, conf.high)</span></code></pre></div>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#sshfwlfhgk .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#sshfwlfhgk .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#sshfwlfhgk .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#sshfwlfhgk .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#sshfwlfhgk .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#sshfwlfhgk .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#sshfwlfhgk .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#sshfwlfhgk .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#sshfwlfhgk .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#sshfwlfhgk .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#sshfwlfhgk .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#sshfwlfhgk .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#sshfwlfhgk .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#sshfwlfhgk .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#sshfwlfhgk .gt_from_md > :first-child {
  margin-top: 0;
}

#sshfwlfhgk .gt_from_md > :last-child {
  margin-bottom: 0;
}

#sshfwlfhgk .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#sshfwlfhgk .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#sshfwlfhgk .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#sshfwlfhgk .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#sshfwlfhgk .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#sshfwlfhgk .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#sshfwlfhgk .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#sshfwlfhgk .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#sshfwlfhgk .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#sshfwlfhgk .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#sshfwlfhgk .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#sshfwlfhgk .gt_left {
  text-align: left;
}

#sshfwlfhgk .gt_center {
  text-align: center;
}

#sshfwlfhgk .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#sshfwlfhgk .gt_font_normal {
  font-weight: normal;
}

#sshfwlfhgk .gt_font_bold {
  font-weight: bold;
}

#sshfwlfhgk .gt_font_italic {
  font-style: italic;
}

#sshfwlfhgk .gt_super {
  font-size: 65%;
}

#sshfwlfhgk .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="sshfwlfhgk" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
<thead class="gt_header">
<tr>
<th colspan="4" class="gt_heading gt_title gt_font_normal" style>Parallel slopes regression table</th>
    </tr>
<tr>
<th colspan="4" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
</thead>
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">term</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">estimate</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">conf.low</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">conf.high</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_left">(Intercept)</td>
      <td class="gt_row gt_right">588.190</td>
      <td class="gt_row gt_right">573.226</td>
      <td class="gt_row gt_right">603.154</td>
    </tr>
<tr>
<td class="gt_row gt_left">perc_disadvan</td>
      <td class="gt_row gt_right">-2.777</td>
      <td class="gt_row gt_right">-2.986</td>
      <td class="gt_row gt_right">-2.568</td>
    </tr>
<tr>
<td class="gt_row gt_left">sizemedium</td>
      <td class="gt_row gt_right">-11.913</td>
      <td class="gt_row gt_right">-26.736</td>
      <td class="gt_row gt_right">2.909</td>
    </tr>
<tr>
<td class="gt_row gt_left">sizelarge</td>
      <td class="gt_row gt_right">-6.362</td>
      <td class="gt_row gt_right">-19.981</td>
      <td class="gt_row gt_right">7.258</td>
    </tr>
</tbody>
</table></div>
<p>Observe how the regression table for the interaction model has 2 more rows (6 versus 4). This reflects the additional “complexity” of the interaction model over the parallel slopes model.</p>
<p>Furthermore, note in Table <a href="#tab:model2-interaction"><strong>??</strong></a> how the <em>offsets for the slopes</em> <code>perc_disadvan:sizemedium</code> being 0.146 and <code>perc_disadvan:sizelarge</code> being 0.189 are small relative to the <em>slope for the baseline group</em> of small schools of <span class="math inline">\(-2.932\)</span>. In other words, all three slopes are similarly negative: <span class="math inline">\(-2.932\)</span> for small schools, <span class="math inline">\(-2.786\)</span> <span class="math inline">\((=-2.932 + 0.146)\)</span> for medium schools, and <span class="math inline">\(-2.743\)</span> <span class="math inline">\((=-2.932 + 0.189)\)</span> for large schools. These results are suggesting that irrespective of school size, the relationship between average math SAT scores and the percent of the student body that is economically disadvantaged is similar and, alas, quite negative.</p>
<p>What you have just performed is a rudimentary <em>model selection</em>: choosing which model fits data best among a set of candidate models. While the model selection approach we just took was visual in nature and hence somewhat qualitative, more statistically rigorous methods for model selection exist in the fields of multiple regression and statistical/machine learning.</p>
<!--
TODO:
Given that intercepts in the parallel slopes model in the right-hand plot of Figure \@ref(fig:numxcatx-comparison-2) are also similar as well, it can be argued that an even better model is one without the categorical variable school size. 
-->
</div>
<div id="correlationcoefficient2" class="section level3">
<h3>
<span class="header-section-number">10.3.7</span> Correlation coefficient</h3>
<p>Recall from Table <a href="#tab:model3-correlation"><strong>??</strong></a> that the correlation coefficient between <code>income</code> in thousands of dollars and credit card <code>debt</code> was 0.464. What if instead we looked at the correlation coefficient between <code>income</code> and credit card <code>debt</code>, but where <code>income</code> was in dollars and not thousands of dollars? This can be done by multiplying <code>income</code> by 1,000.</p>
<div class="sourceCode" id="cb892"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb892-1"><a href="continuous-response.html#cb892-1"></a>credit_ch12 <span class="op">%&gt;%</span></span>
<span id="cb892-2"><a href="continuous-response.html#cb892-2"></a><span class="st">  </span><span class="kw">select</span>(debt, income) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb892-3"><a href="continuous-response.html#cb892-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">income =</span> income <span class="op">*</span><span class="st"> </span><span class="dv">1000</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb892-4"><a href="continuous-response.html#cb892-4"></a><span class="st">  </span><span class="kw">cor</span>()</span></code></pre></div>
<table class="table" style="font-size: 16px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-694">TABLE 10.5: </span>Correlation between income (in dollars) and credit card debt
</caption>
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
debt
</th>
<th style="text-align:right;">
income
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
debt
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
0.464
</td>
</tr>
<tr>
<td style="text-align:left;">
income
</td>
<td style="text-align:right;">
0.464
</td>
<td style="text-align:right;">
1.000
</td>
</tr>
</tbody>
</table>
<p>We see it is the same! We say that the correlation coefficient is <em>invariant to linear transformations</em>. The correlation between <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> will be the same as the correlation between <span class="math inline">\(a\cdot x + b\)</span> and <span class="math inline">\(y\)</span> for any numerical values <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span>.</p>
</div>
<div id="simpsonsparadox" class="section level3">
<h3>
<span class="header-section-number">10.3.8</span> Simpson’s Paradox</h3>
<p>Recall in Section <a href="continuous-response.html#model3">10.2</a>, we saw the two seemingly contradictory results when studying the relationship between credit card <code>debt</code> and <code>income</code>. On the one hand, the right hand plot of Figure <a href="#fig:2numxplot1"><strong>??</strong></a> suggested that the relationship between credit card <code>debt</code> and <code>income</code> was <em>positive</em>. We re-display this in Figure <a href="#fig:2numxplot1-repeat"><strong>??</strong></a>.</p>
<div class="figure">
<span id="fig:unnamed-chunk-695"></span>
<p class="caption marginnote shownote">
FIGURE 10.15: Relationship between credit card debt and income.
</p>
<img src="book_temp_files/figure-html/unnamed-chunk-695-1.png" alt="Relationship between credit card debt and income." width="672">
</div>
<p>On the other hand, the multiple regression results in Table <a href="#tab:model3-table-output"><strong>??</strong></a> suggested that the relationship between <code>debt</code> and <code>income</code> was <em>negative</em>. We re-display this information in Table <a href="#tab:model3-table-output-repeat"><strong>??</strong></a>.</p>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#qdmhypywnt .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#qdmhypywnt .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qdmhypywnt .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#qdmhypywnt .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#qdmhypywnt .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qdmhypywnt .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qdmhypywnt .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#qdmhypywnt .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#qdmhypywnt .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#qdmhypywnt .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#qdmhypywnt .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#qdmhypywnt .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#qdmhypywnt .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#qdmhypywnt .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#qdmhypywnt .gt_from_md > :first-child {
  margin-top: 0;
}

#qdmhypywnt .gt_from_md > :last-child {
  margin-bottom: 0;
}

#qdmhypywnt .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#qdmhypywnt .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#qdmhypywnt .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qdmhypywnt .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#qdmhypywnt .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qdmhypywnt .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#qdmhypywnt .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qdmhypywnt .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qdmhypywnt .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#qdmhypywnt .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qdmhypywnt .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#qdmhypywnt .gt_left {
  text-align: left;
}

#qdmhypywnt .gt_center {
  text-align: center;
}

#qdmhypywnt .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#qdmhypywnt .gt_font_normal {
  font-weight: normal;
}

#qdmhypywnt .gt_font_bold {
  font-weight: bold;
}

#qdmhypywnt .gt_font_italic {
  font-style: italic;
}

#qdmhypywnt .gt_super {
  font-size: 65%;
}

#qdmhypywnt .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="qdmhypywnt" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
<thead class="gt_header">
<tr>
<th colspan="4" class="gt_heading gt_title gt_font_normal" style>Multiple regression results</th>
    </tr>
<tr>
<th colspan="4" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
</thead>
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">term</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">estimate</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">conf.low</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">conf.high</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_left">(Intercept)</td>
      <td class="gt_row gt_right">-385.1793</td>
      <td class="gt_row gt_right">-423.4462</td>
      <td class="gt_row gt_right">-346.9123</td>
    </tr>
<tr>
<td class="gt_row gt_left">credit_limit</td>
      <td class="gt_row gt_right">0.2643</td>
      <td class="gt_row gt_right">0.2528</td>
      <td class="gt_row gt_right">0.2759</td>
    </tr>
<tr>
<td class="gt_row gt_left">income</td>
      <td class="gt_row gt_right">-7.6633</td>
      <td class="gt_row gt_right">-8.4204</td>
      <td class="gt_row gt_right">-6.9063</td>
    </tr>
</tbody>
</table></div>
<p>Observe how the slope for <code>income</code> is <span class="math inline">\(-7.663\)</span> and, most importantly for now, it is negative. This contradicts our observation in Figure <a href="#fig:2numxplot1-repeat"><strong>??</strong></a> that the relationship is positive. How can this be? Recall the interpretation of the slope for <code>income</code> in the context of a multiple regression model: <em>taking into account all the other explanatory variables in our model</em>, for every increase of one unit in <code>income</code> (i.e., $1,000), there is an associated decrease of on average $7.663 in <code>debt</code>.</p>
<p>In other words, while in <em>isolation</em>, the relationship between <code>debt</code> and <code>income</code> may be positive, when taking into account <code>credit_limit</code> as well, this relationship becomes negative. These seemingly paradoxical results are due to a phenomenon aptly named <a href="https://en.wikipedia.org/wiki/Simpson%27s_paradox"><em>Simpson’s Paradox</em></a>. Simpson’s Paradox occurs when trends that exist for the data in aggregate either disappear or reverse when the data are broken down into groups.</p>
<p>Let’s show how Simpson’s Paradox manifests itself in the <code>credit_ch12</code> data. Let’s first visualize the distribution of the numerical explanatory variable <code>credit_limit</code> with a histogram in Figure <a href="#fig:credit-limit-quartiles"><strong>??</strong></a>.</p>
<div class="figure">
<span id="fig:unnamed-chunk-697"></span>
<p class="caption marginnote shownote">
FIGURE 10.16: Histogram of credit limits and brackets.
</p>
<img src="book_temp_files/figure-html/unnamed-chunk-697-1.png" alt="Histogram of credit limits and brackets." width="672">
</div>
<p>The vertical dashed lines are the <em>quartiles</em> that cut up the variable <code>credit_limit</code> into four equally sized groups. Let’s think of these quartiles as converting our numerical variable <code>credit_limit</code> into a categorical variable “<code>credit_limit</code> bracket” with four levels. This means that</p>
<ol style="list-style-type: decimal">
<li>25% of credit limits were between $0 and $3088. Let’s assign these 100 people to the “low” <code>credit_limit</code> bracket.</li>
<li>25% of credit limits were between $3088 and $4622. Let’s assign these 100 people to the “medium-low” <code>credit_limit</code> bracket.</li>
<li>25% of credit limits were between $4622 and $5873. Let’s assign these 100 people to the “medium-high” <code>credit_limit</code> bracket.</li>
<li>25% of credit limits were over $5873. Let’s assign these 100 people to the “high” <code>credit_limit</code> bracket.</li>
</ol>
<p>Now in Figure <a href="#fig:2numxplot4"><strong>??</strong></a> let’s re-display two versions of the scatterplot of <code>debt</code> and <code>income</code> from Figure <a href="#fig:2numxplot1-repeat"><strong>??</strong></a>, but with a slight twist:</p>
<ol style="list-style-type: decimal">
<li>The left-hand plot shows the regular scatterplot and the single regression line, just as you saw in Figure <a href="#fig:2numxplot1-repeat"><strong>??</strong></a>.</li>
<li>The right-hand plot shows the <em>colored scatterplot</em>, where the color aesthetic is mapped to “<code>credit_limit</code> bracket.” Furthermore, there are now four separate regression lines.</li>
</ol>
<p>In other words, the location of the 400 points are the same in both scatterplots, but the right-hand plot shows an additional variable of information: <code>credit_limit</code> bracket.</p>
<div class="figure">
<span id="fig:unnamed-chunk-698"></span>
<p class="caption marginnote shownote">
FIGURE 10.17: Relationship between credit card debt and income by credit limit bracket.
</p>
<img src="book_temp_files/figure-html/unnamed-chunk-698-1.png" alt="Relationship between credit card debt and income by credit limit bracket." width="672">
</div>
<p>The left-hand plot of Figure <a href="#fig:2numxplot4"><strong>??</strong></a> focuses on the relationship between <code>debt</code> and <code>income</code> in <em>aggregate</em>. It is suggesting that overall there exists a positive relationship between <code>debt</code> and <code>income</code>. However, the right-hand plot of Figure <a href="#fig:2numxplot4"><strong>??</strong></a> focuses on the relationship between <code>debt</code> and <code>income</code> <em>broken down by <code>credit_limit</code> bracket</em>. In other words, we focus on four <em>separate</em> relationships between <code>debt</code> and <code>income</code>: one for the “low” <code>credit_limit</code> bracket, one for the “medium-low” <code>credit_limit</code> bracket, and so on.</p>
<p>Observe in the right-hand plot that the relationship between <code>debt</code> and <code>income</code> is clearly negative for the “medium-low” and “medium-high” <code>credit_limit</code> brackets, while the relationship is somewhat flat for the “low” <code>credit_limit</code> bracket. The only <code>credit_limit</code> bracket where the relationship remains positive is for the “high” <code>credit_limit</code> bracket. However, this relationship is less positive than in the relationship in aggregate, since the slope is shallower than the slope of the regression line in the left-hand plot.</p>
<p>In this example of Simpson’s Paradox, the <code>credit_limit</code> is a <em>confounding variable</em> of the relationship between credit card <code>debt</code> and <code>income</code>. Thus, <code>credit_limit</code> needs to be accounted for in any appropriate model for the relationship between <code>debt</code> and <code>income</code>.</p>

<!-- Outline: -->
<!-- 1) Preamble: Intro paragraph to classification in general, both 0/1 and multiple categories. Discuss different approaches, all for solving the same problem. -->
<!-- 2) EDA of cces (meaning just the columns we care about). Start with the usual EDA of the subset of cces data which we are using (only 2018 for now), which will be state, age, gender, race, education.   -->
<!-- 3) Logistic Regression. Go through all our themes. -->
<!-- 4) CART -->
<!-- 5) Random Forest -->
<!-- 6) Comparing the models. Advice. -->
<!-- 7) Multi-category question. Deep learning. -->
<!-- Other stuff: -->
<!-- * tidymodels always. stan_glm from the start. Cover the highlights on Gelman. Divide by 4. predictions are all matter. don't bother with posterior_linpred().  -->
<!-- * Then CART using tidymodels on exactly this data and this problem. Maybe we go slowly, showing how CART works with one variable (numeric and categorical) first. Or maybe we just go straight to the full model.  -->
<!-- * Then random forests using tidymodels on exactly this data and this problem. -->
<!-- * Do we have time to explore Gelman's magic trick: Showing the values of key coefficients when the model is refit to each year separately? That is, how much is age associated with being conservative over time? I hope so! But maybe not. -->
<!-- * Do we have time to do a model which predicts a category with more than 0/1 possible values? I am not sure. If we were going to, we would want to pick something that is not an ordered category, I think. In this data, only race would meet that criteria. Let's revisit this later. -->
</div>
</div>
</div></body></html>

<p style="text-align: center;">
<a href="n-parameters.html"><button class="btn btn-default">Previous</button></a>
<a href="discrete-response.html"><button class="btn btn-default">Next</button></a>
</p>
<p class="build-date">Page built: 
2020-07-28
</p>
</div>
</div>



</body>
</html>
